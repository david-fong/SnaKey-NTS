(self.webpackChunksnakey3=self.webpackChunksnakey3||[]).push([[755],{115:(e,t,r)=>{"use strict";r.d(t,{U:()=>l});var i,s=r(632),o=r(532),a=r(903);!function(e){var t;class r{constructor(){Object.defineProperty(this,"seq",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"children",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"carryHits",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.children=[],s.R.propNoWrite(this,"children")}reset(){for(const e of this.children)e.reset();this.carryHits=0}_finalize(){Object.freeze(this.children);for(const e of this.children)e._finalize()}getLeaves(){const e=[];return this._rGetLeaves(e),e}_rGetLeaves(e){if(this.children.length)for(const t of this.children)t._rGetLeaves(e);else e.push(this)}simpleView(){return this.children}static CREATE_TREE_MAP(t,o){var a;const l=e.GET_SCALE_WEIGHT_FUNC(o,t),h=new Map;Object.entries(t).forEach((([e,{seq:t,weight:r}])=>{const i=new n(e,l(r)),s=h.get(t);void 0!==s?s.push(i):h.set(t,[i])}));const c=new r;s.R.propNoWrite(c,"children");let d=c;for(const[e,t]of Array.from(h).sort((([e],[t])=>e<t?-1:1))){for(;!e.startsWith(d.seq);)d=null!==(a=d.parent)&&void 0!==a?a:c;const r=new i(d===c?void 0:d,e,t);d.children.push(r),d=r}return c._finalize(),c}}Object.defineProperty(r,"LEAF_CMP",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>e.carryHits-t.carryHits}),e.ParentNode=r,s.R.protoNoEnum(r,"_finalize","_rGetLeaves"),Object.freeze(r),Object.freeze(r.prototype);class i extends r{constructor(e,r,i){super(),Object.defineProperty(this,"parent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"seq",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t.set(this,void 0),this.seq=r,(0,a.YH)(this,t,i),this.parent=e,s.R.propNoWrite(this,"seq","parent")}_finalize(){Object.freeze((0,a.Q_)(this,t)),super._finalize()}reset(){super.reset();for(const e of(0,a.Q_)(this,t))e.reset(),this.incrHits(e,Math.random()*o.Uo.CHAR_HIT_COUNT_SEED_CEILING)}chooseOnePair(){let e=(0,a.Q_)(this,t)[0];for(const r of(0,a.Q_)(this,t))r.hits<e.hits&&(e=r);const r={char:e.char,seq:this.seq};return this.incrHits(e),r}incrHits(e,t=1){e._incrementNumHits(),this._rIncrHits(e.weightInv*t)}_rIncrHits(e){this.carryHits+=e;for(const t of this.children)t._rIncrHits(e)}get ownHits(){var e,t;return this.carryHits-(null!==(t=null===(e=this.parent)||void 0===e?void 0:e.carryHits)&&void 0!==t?t:0)}simpleView(){let e=(0,a.Q_)(this,t).map((e=>e.simpleView()));return Object.assign(Object.create(null),{seq:this.seq,chars:1===e.length?e[0]:e,kids:this.children.map((e=>e.simpleView()))})}}function l(e,t){if(0===e)return e=>1;if(1===e)return e=>e;const r=Object.values(t),i=r.reduce(((e,t)=>e+t.weight),0)/r.length;return t=>Math.pow(t/i,e)}t=new WeakMap,Object.defineProperty(i,"PATH_CMP",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>e.ownHits-t.ownHits}),e.ChildNode=i,s.R.protoNoEnum(i,"_finalize","_rIncrHits"),Object.freeze(i),Object.freeze(i.prototype),e.GET_SCALE_WEIGHT_FUNC=l,Object.freeze(l)}(i||(i={})),Object.freeze(i);class n{constructor(e,t){Object.defineProperty(this,"char",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"weightInv",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hits",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.char=e,this.weightInv=1/t}reset(){this.hits=0}_incrementNumHits(){this.hits+=this.weightInv}simpleView(){return Object.assign(Object.create(null),{char:this.char})}}Object.defineProperty(n,"CMP",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>e.hits-t.hits}),Object.freeze(n),Object.freeze(n.prototype);class l extends o.Uo{constructor(e,t){super(),Object.defineProperty(this,"frontendDesc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"treeMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"leafNodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.frontendDesc=l.GET_FRONTEND_DESC_BY_ID(e),this.treeMap=i.ParentNode.CREATE_TREE_MAP(Object.getPrototypeOf(this).constructor.BUILD(),t),this.leafNodes=this.treeMap.getLeaves(),s.R.propNoWrite(this,"frontendDesc","treeMap","leafNodes")}get numLeaves(){return this.leafNodes.length}reset(){this.treeMap.reset()}getNonConflictingChar(e){this.leafNodes.sort(i.ParentNode.LEAF_CMP);e:for(const t of this.leafNodes){let r=t;for(let i=t;i;i=i.parent){const t=e.find((e=>e.startsWith(i.seq)));if(t){if(t.length>i.seq.length)break;continue e}i.ownHits<r.ownHits&&(r=i)}return r.chooseOnePair()}throw new Error("never. Invariants guaranteeing that a LangSeq can always be shuffled-in were not met.")}simpleView(){return Object.freeze(Object.assign(Object.create(null),{id:this.frontendDesc.id,displayName:this.frontendDesc.displayName,root:this.treeMap.simpleView(),numLeaves:this.leafNodes.length}))}}!function(e){let t;!function(e){e.WORD_FOR_WORD=function(e){return Object.entries(e).reduce(((e,[t,r])=>(e[t]={seq:t,weight:r},e)),{})}}(t=e.BuildUtils||(e.BuildUtils={}))}(l||(l={})),Object.freeze(l),Object.freeze(l.prototype)},765:(e,t,r)=>{"use strict";r.r(t),r.d(t,{OfflineGame:()=>_});var i=r(242),s=r(903),o=r(632),a=r(115),n=r(825),l=r(157),h=r(477);class c extends h.J5{constructor(e,t){super(e,t),Object.defineProperty(this,"_nextMovementTimerMultiplier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_scheduledMovementCallbackId",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}_notifyGameNowPlaying(){super._notifyGameNowPlaying(),this.delayedMovementContinue()}_notifyGameNowPaused(){this.game.cancelTimeout(this._scheduledMovementCallbackId),this._scheduledMovementCallbackId=void 0}_notifyGameNowOver(){this.game.cancelTimeout(this._scheduledMovementCallbackId),this._scheduledMovementCallbackId=void 0}movementContinue(){const e=this.computeDesiredDest();this._nextMovementTimerMultiplier=this.game.grid.tile.at(e).langSeq.length,this.makeMovementRequest(this.game.grid.getUntToward(e,this.coord),this.getNextMoveType()),this.delayedMovementContinue()}delayedMovementContinue(){this._scheduledMovementCallbackId=this.game.setTimeout(this.movementContinue.bind(this),this.computeNextMovementTimer()*this._nextMovementTimerMultiplier)}}!function(e){e.of=(t,r)=>{const i=r.familyId;return new e._Constructors[i](t,r)}}(c||(c={})),o.R.protoNoEnum(c,"movementContinue");var d=r(532);class u{constructor(e){Object.defineProperty(this,"entries",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=[];for(const r of e)t[r]=new u.Entry;this.entries=t,o.R.propNoWrite(this,"entries")}reset(){for(const e of this.entries)e.reset()}}!function(e){class t{constructor(){Object.defineProperty(this,"moveCounts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"totalHealthPickedUp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.moveCounts={}}reset(){this.totalHealthPickedUp=0,Object.getOwnPropertyNames(d.J5.MoveType).forEach((e=>{this.moveCounts[e]=0}))}}e.Entry=t,Object.freeze(t),Object.freeze(t.prototype)}(u||(u={})),Object.freeze(u),Object.freeze(u.prototype);var f,g,m,b,p=r(688),v=r(110),y=r(692),O=r(254);class w extends c{constructor(e,t){super(e,t),Object.defineProperty(this,"threatProximity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"targetProximity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"behaviour",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"grid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),f.set(this,void 0),this.behaviour=Object.freeze(Object.assign({},w.Behaviour.DEFAULT,t.familyArgs)),this.grid=this.game.grid}_afterAllPlayersConstruction(){super._afterAllPlayersConstruction(),this.threatProximity=this.game.teams.filter((e=>e.id!==this.teamId)).flatMap((e=>e.members)),this.targetProximity=[...this.threatProximity],o.R.propNoWrite(this,"threatProximity","targetProximity","behaviour","grid")}reset(e){super.reset(e),(0,s.YH)(this,f,this.coord)}moveTo(e){(0,s.YH)(this,f,this.coord),super.moveTo(e)}computeDesiredDest(){this.threatProximity.sort(((e,t)=>this.grid.minMovesFromTo(e.coord,this.coord)-this.grid.minMovesFromTo(t.coord,this.coord)));for(const e of this.threatProximity){if(this.grid.minMovesFromTo(e.coord,this.coord)>this.behaviour.fearDistance)break;if(!e.status.isDowned&&e.status.health>this.status.health)return this.grid.getUntAwayFrom(e.coord,this.coord).coord}if(this.targetProximity.sort(((e,t)=>this.grid.minMovesFromTo(this.coord,e.coord)-this.grid.minMovesFromTo(this.coord,t.coord))),this.status.isDowned)for(const e of this.targetProximity){if(this.grid.minMovesFromTo(this.coord,e.coord)>this.behaviour.bloodThirstDistance)break;if(e.status.health<this.status.health-this.behaviour.healthReserve)return e.coord}if(0===this.game.freeHealthTiles.size){if(Math.random()<this.behaviour.wanderingAimlessness)return this.grid.getRandomCoordAround(this.coord,3);{const e=this.grid.getUntAwayFrom.bind(this.grid,(0,s.Q_)(this,f));return this.grid.getRandomCoordAround(e(e(this.coord).coord).coord,1)}}let e,t=1/0;for(const r of this.game.freeHealthTiles){const i=this.grid.minMovesFromTo(this.coord,r.coord);i<t&&(e=r,t=i)}return e.coord}getNextMoveType(){return h.J5.MoveType.NORMAL}computeNextMovementTimer(){return 1e3/this.behaviour.keyPressesPerSecond}}f=new WeakMap,function(e){let t;!function(e){e.DEFAULT=Object.freeze({fearDistance:5,bloodThirstDistance:7,healthReserve:3,keyPressesPerSecond:2,wanderingAimlessness:.2})}(t=e.Behaviour||(e.Behaviour={}))}(w||(w={})),o.R.protoNoEnum(w,"_afterAllPlayersConstruction"),Object.freeze(w),Object.freeze(w.prototype),(()=>{v.r._Constructors=Object.freeze({EUCLID2:y.i.Grid,BEEHIVE:O.v.Grid}),Object.freeze(v.r),Object.freeze(v.r.prototype);{const e=c;e._Constructors=Object.freeze({CHASER:w}),Object.freeze(e),Object.freeze(e.prototype)}})();class P extends p.R{constructor(e,t,i){super(e,t,i),Object.defineProperty(this,"averageFreeHealth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"averageFreeHealthPerTile",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"healthCostOfBoost",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),g.set(this,void 0),m.set(this,void 0),Object.defineProperty(this,"lang",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),b.set(this,void 0),Object.defineProperty(this,"scoreInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.averageFreeHealth=i.averageFreeHealthPerTile*this.grid.area,this.averageFreeHealthPerTile=i.averageFreeHealthPerTile,this.healthCostOfBoost=n.l.K.HEALTH_COST_OF_BOOST(this.averageFreeHealthPerTile,this.grid.static.getDiameterOfLatticePatchHavingArea),(0,s.YH)(this,m,new Set),this.scoreInfo=new u(this.players.map((e=>e.playerId))),o.R.propNoWrite(this,"averageFreeHealth","averageFreeHealthPerTile","healthCostOfBoost","scoreInfo"),(0,s.YH)(this,b,r(59)(`./${this.langFrontend.module}.ts`).then((e=>{const t=this.langFrontend.export.split(".").reduce(((e,t)=>e[t]),e[this.langFrontend.module]);return this.lang=new t(i.langWeightExaggeration),o.R.propNoWrite(this,"lang"),this.grid.static.getAmbiguityThreshold(),this.lang})))}reset(){const e=Object.create(null,{reset:{get:()=>super.reset}});return(0,s.mG)(this,void 0,void 0,(function*(){yield e.reset.call(this),(0,s.YH)(this,g,0),(0,s.Q_)(this,m).clear(),yield(0,s.Q_)(this,b),this.lang.reset(),this.grid.shuffledForEachTile((e=>{e.setLangCharSeqPair(this.dryRunShuffleLangCharSeqAt(e))})),this.teams.forEach((e=>e.reset()));const t=this.grid.static.getSpawnCoords(this.teams.map((e=>e.members.length)),this.grid.dimensions);return this.teams.forEach(((e,r)=>{e.members.forEach(((e,i)=>{e.reset(this.grid.tile.at(t[r][i]))}))})),this.scoreInfo.reset(),Promise.resolve()}))}_createArtifPlayer(e){return c.of(this,e)}dryRunShuffleLangCharSeqAt(e,t=!1){e.setLangCharSeqPair(a.U.CharSeqPair.NULL);let r=this.grid.getDestsFromSourcesTo(e.coord).map((e=>e.langSeq));if(t){const e=a.U.CharSeqPair.NULL.seq;r=r.filter((t=>t!==e))}return Object.freeze(r),this.lang.getNonConflictingChar(r)}get currentFreeHealth(){return(0,s.Q_)(this,g)}get freeHealthTiles(){return(0,s.Q_)(this,m)}dryRunSpawnFreeHealth(e){var t;let r=this.averageFreeHealth-this.currentFreeHealth;if(r<=0)return;const i=[];for(;r>0;){let s;do{s=this.grid.tile.at(this.grid.getRandomCoord())}while(s.isOccupied||i.find((e=>l.u.equals(s.coord,e.coord))));const o=n.l.K.AVERAGE_HEALTH_TO_SPAWN_ON_TILE;if(Math.random()<n.l.K.HEALTH_UPDATE_CHANCE){let r;(r=e.find((e=>l.u.equals(s.coord,e.coord))))?r.newFreeHealth=(null!==(t=r.newFreeHealth)&&void 0!==t?t:0)+o:i.push({coord:s.coord,lastKnownUpdateId:1+s.lastKnownUpdateId,newFreeHealth:s.freeHealth+o})}r-=o}return i}executeTileModEvent(e,t=!0){o.R.deepFreeze(e);const r=this.grid.tile.at(e.coord);return(0,s.YH)(this,g,(0,s.Q_)(this,g)+(e.newFreeHealth-r.freeHealth)),0===e.newFreeHealth?(0,s.Q_)(this,m).delete(r):(0,s.Q_)(this,m).add(r),super.executeTileModEvent(e,t),r}managerCheckGamePlayingRequest(e){if(this.status!==n.l.Status.PLAYING)return;const t=this.players[e.playerId];if(!t)throw new Error("No such player exists.");if(e.playerLastAcceptedRequestId!==t.lastAcceptedRequestId)throw new RangeError(e.playerLastAcceptedRequestId<t.lastAcceptedRequestId?"Clients should not make requests until they have received my response to their last request.":"Client seems to have incremented the request ID counter on their own, which is is illegal.");return t}processMoveRequest(e){const t=this.managerCheckGamePlayingRequest(e);if(void 0===t)return void this.executePlayerMoveEvent(e);const r=this.grid.tile.at(e.destModDesc.coord);if(r.isOccupied||r.lastKnownUpdateId!==e.destModDesc.lastKnownUpdateId)return void this.executePlayerMoveEvent(e);const i=e.moveType===h.J5.MoveType.BOOST,s=t.status.health+r.freeHealth*(t.status.isDowned?n.l.K.HEALTH_EFFECT_FOR_DOWNED_PLAYER:1)-(i?this.healthCostOfBoost:0);if(i&&s<0)return void this.executePlayerMoveEvent(e);const o=this.scoreInfo.entries[t.playerId];o.totalHealthPickedUp+=r.freeHealth,o.moveCounts[e.moveType]+=1,e.playerLastAcceptedRequestId=1+t.lastAcceptedRequestId,e.newPlayerHealth={health:s},e.destModDesc.lastKnownUpdateId=1+r.lastKnownUpdateId,e.destModDesc.newFreeHealth=0,e.destModDesc.newCharSeqPair=this.dryRunShuffleLangCharSeqAt(r),e.tileHealthModDescs=this.dryRunSpawnFreeHealth([e.destModDesc]),e.eventId=this.nextUnusedEventId,this.executePlayerMoveEvent(e)}processPlayerContact(e){}processBubbleRequest(e){const t=this.managerCheckGamePlayingRequest(e);t?(e.playerLastAcceptedRequestId=1+t.lastAcceptedRequestId,e.eventId=this.nextUnusedEventId,this.executePlayerBubbleEvent(e)):this.executePlayerBubbleEvent(e)}}g=new WeakMap,m=new WeakMap,b=new WeakMap,function(e){e.CHECK_VALID_CTOR_ARGS=function(e){const t=[],r=Object.freeze({coordSys:0,gridDimensions:0,averageFreeHealthPerTile:0,langId:0,langWeightExaggeration:0,playerDescs:0}),i=[];for(const t in r){null==e[t]&&i.push(t)}return i.length&&t.push("Missing the following arguments: "+i),void 0===a.U.GET_FRONTEND_DESC_BY_ID(e.langId)&&t.push(`No language with the ID \`${e.langId}\` exists.`),NaN===parseInt(e.langWeightExaggeration)?t.push(`Language Weight Exaggeration expected a number, but\`${e.langWeightExaggeration}\` is not a number.`):e.langWeightExaggeration=Math.max(0,parseFloat(e.langWeightExaggeration)),t}}(P||(P={})),o.R.protoNoEnum(P,"managerCheckGamePlayingRequest"),Object.freeze(P),Object.freeze(P.prototype);class _ extends P{constructor(e,t){super(i.lA.Type.OFFLINE,{onGameBecomeOver:e,tileClass:i.gx,playerStatusCtor:i.Ko},t),this._ctorBrowserGame()}setTimeout(e,t,...r){return setTimeout(e,t,r)}cancelTimeout(e){clearTimeout(e)}}i.RQ.applyMixins(_,[i.qM]),Object.freeze(_),Object.freeze(_.prototype)},59:(e,t,r)=>{var i={"./Chinese.ts":[216,7,330],"./Emote.ts":[655,9,858],"./English.ts":[891,9,184],"./Japanese.ts":[800,9,410],"./Korean.ts":[3,9,227],"./Ngrams.ts":[492,9,273],"./Numpad.ts":[193,9,683],"./Shell.ts":[521,9,159],"./defs/Chinese.ts":[958,7,704],"./defs/English100.ts":[213,9,885]};function s(e){if(!r.o(i,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],s=t[0];return r.e(t[2]).then((()=>r.t(s,16|t[1])))}s.keys=()=>Object.keys(i),s.id=59,e.exports=s}}]);
//# sourceMappingURL=offline.js.map
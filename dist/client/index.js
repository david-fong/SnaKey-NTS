var snakey3=function(e){function t(t){for(var n,s,a=t[0],r=t[1],i=0,c=[];i<a.length;i++)s=a[i],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&c.push(o[s][0]),o[s]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);for(l&&l(t);c.length;)c.shift()()}var n={},s={3:0},o={3:0};function a(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.e=function(e){var t=[];s[e]?t.push(s[e]):0!==s[e]&&{0:1}[e]&&t.push(s[e]=new Promise((function(t,n){for(var o="chunk/"+({0:"game/offline~game/online",1:"game/offline",2:"game/online",4:"lang/Emote-ts",5:"lang/English-ts",6:"lang/Japanese-ts",7:"lang/Korean-ts",8:"lang/Morse-ts"}[e]||e)+".css",r=a.p+o,i=document.getElementsByTagName("link"),c=0;c<i.length;c++){var l=(d=i[c]).getAttribute("data-href")||d.getAttribute("href");if("stylesheet"===d.rel&&(l===o||l===r))return t()}var u=document.getElementsByTagName("style");for(c=0;c<u.length;c++){var d;if((l=(d=u[c]).getAttribute("data-href"))===o||l===r)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var o=t&&t.target&&t.target.src||r,a=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");a.code="CSS_CHUNK_LOAD_FAILED",a.request=o,delete s[e],p.parentNode.removeChild(p),n(a)},p.href=r,document.getElementsByTagName("head")[0].appendChild(p)})).then((function(){s[e]=0})));var n=o[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise((function(t,s){n=o[e]=[t,s]}));t.push(n[2]=r);var i,c=document.createElement("script");c.charset="utf-8",c.timeout=120,a.nc&&c.setAttribute("nonce",a.nc),c.src=function(e){return a.p+"chunk/"+({0:"game/offline~game/online",1:"game/offline",2:"game/online",4:"lang/Emote-ts",5:"lang/English-ts",6:"lang/Japanese-ts",7:"lang/Korean-ts",8:"lang/Morse-ts"}[e]||e)+".js"}(e);var l=new Error;i=function(t){c.onerror=c.onload=null,clearTimeout(u);var n=o[e];if(0!==n){if(n){var s=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+s+": "+a+")",l.name="ChunkLoadError",l.type=s,l.request=a,n[1](l)}o[e]=void 0}};var u=setTimeout((function(){i({type:"timeout",target:c})}),12e4);c.onerror=c.onload=i,document.head.appendChild(c)}return Promise.all(t)},a.m=e,a.c=n,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)a.d(n,s,function(t){return e[t]}.bind(null,s));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="dist/client/",a.oe=function(e){throw console.error(e),e};var r=window.webpackJsonpsnakey3=window.webpackJsonpsnakey3||[],i=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var l=i;return a(a.s=5)}([function(e,t,n){"use strict";var s;n.d(t,"a",(function(){return s})),function(e){let t,n,s,o,a,r;e.GLOBAL_IDS={PUBLIC_GAME_HOST_URLS:"public-game-hosts-list",CURRENT_HOST_GROUPS:"current-host-groups-list"},function(e){e.Class={TEXT_SELECT_DISABLED:"text-select-disabled",FILL_PARENT:"fill-parent",CENTER_CONTENTS:"center-contents",STACK_CONTENTS:"stack-contents",INPUT_GROUP:"sk-input-group",INPUT_GROUP_ITEM:"sk-input-group-item"},e.Dataset={COLOUR_SCHEME:"skColourScheme"}}(t=e.General||(e.General={})),function(e){e.Class={BASE:"tile",POINTER_HB:"tile__pointer-hitbox",LANG_CHAR:"tile__char",LANG_SEQ:"tile__seq"},e.Dataset={HEALTH:"health"}}(n=e.Tile||(e.Tile={})),function(e){e.Class={GRID:"game-grid",IMPL_BODY:"game-grid-impl-body",KBD_DC:"game-grid-kbd-dc",KBD_DC_ICON:"game-grid-kbd-dc__icon",PAUSE_OL:"game-grid-pause-overlay",PAUSE_OL_ICON:"game-grid-pause-overlay__icon"},e.Dataset={IMPL_COORD_SYS:"coordSys",GAME_STATE:{KEY:"gameState",VALUES:{PLAYING:"playing",PAUSED:"paused",OVER:"over"}}}}(s=e.Grid||(e.Grid={})),function(e){e.Class={BASE:"player",FACE:"player__face",DOWNED_OVERLAY:"player__downed-overlay",SHORT_SPOTLIGHT:"player__spotlight-short",LONG_SPOTLIGHT:"player__spotlight-long"},e.Dataset={DOWNED:{KEY:"downed",VALUES:{TEAM:"team",SELF:"self",NO:"no"}},FACE_SWATCH:"face"}}(o=e.Player||(e.Player={})),function(e){let t;e.Id={ALL_SCREENS:"all-screens-container",SCREEN_TINT:"screen-tint"},e.Class={BASE:"sk-screen"},e.Dataset={CURRENT:"current"},function(e){let t,n,s;!function(e){e.Class={BASE:"screen-home",NAV:"screen-home--nav",NAV_PLAY_OFFLINE:"screen-home--nav--play-offline",NAV_PLAY_ONLINE:"screen-home--nav--play-online",NAV_HOW_TO_PLAY:"screen-home--nav--how-to-play",NAV_HOW_TO_HOST:"screen-home--nav--how-to-host",NAV_COLOURS:"screen-home--nav--colour-scheme",NAV_VIEW_REPO:"screen-home--nav--goto-repo",NAV_RPT_ISSUE:"screen-home--nav--report-issue"}}(t=e.Home||(e.Home={})),function(e){e.Class={BASE:"screen-play",GRID_CONTAINER:"screen-play--grid-container",CONTROLS_BAR:"screen-play--controls-bar"}}(n=e.PlayGame||(e.PlayGame={})),function(e){e.Class={BASE:"screen-joiner",CONTENT_WRAPPER:"screen-joiner--content-wrapper",HOST_URL:"screen-joiner--host-url",GROUP_NAME:"screen-joiner--group-name",PASSPHRASE:"screen-joiner--passphrase",NEXT_BUTTON:"screen-joiner--next-button"}}(s=e.GroupJoiner||(e.GroupJoiner={}))}(t=e.Impl||(e.Impl={}))}(a=e.Screen||(e.Screen={})),function(e){e.Class={BASE:"sk-pick-one",OPT_BASE:"sk-pick-one--opt"}}(r=e.SkPickOne||(e.SkPickOne={}))}(s||(s={})),Object.freeze(s.Player.Dataset.DOWNED),function e(t){for(const n of Object.getOwnPropertyNames(t)){const s=t[n];"object"==typeof s&&e(s)}return Object.freeze(t)}(s)},function(e,t,n){"use strict";var s;function o(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(n=>{Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n))})})}n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r})),function(e){e.NEVER="Never happens. See comment in source."}(s||(s={}));class a{}!function(e){let t;e.Family=Object.freeze({HUMAN:"HUMAN",CHASER:"CHASER"}),e.Family,function(e){e.NULL=void 0}(t=e.Id||(e.Id={})),e.MoveType=Object.freeze({NORMAL:"NORMAL",BOOST:"BOOST"}),e.MoveType}(a||(a={})),Object.freeze(a),Object.freeze(a.prototype);class r{}!function(e){let t,n,s;!function(e){e.REGEXP=new RegExp("^[a-zA-Z0-9!@#$%^&*()-_=+;:'\"\\|,.<>/?]+$")}(t=e.Seq||(e.Seq={})),function(e){e.NULL=Object.freeze({char:"",seq:""})}(n=e.CharSeqPair||(e.CharSeqPair={})),function(e){e.SEQ="SEQ",e.CHAR="CHAR",e.WEIGHT="WEIGHT"}(s=e.BalancingScheme||(e.BalancingScheme={})),e.__RemapTemplates=Object.freeze({IDENTITY:e=>e,TO_LOWER:e=>e.toLowerCase()}),e.__RemapTemplates,e.FrontendDescs=Object.freeze([{id:"engl-low",module:"English",export:"Lowercase",numLeaves:26,remapFunc:e.__RemapTemplates.TO_LOWER,display:"English Lowercase (QWERTY)",blurb:""},{id:"engl-mix",module:"English",export:"MixedCase",numLeaves:52,remapFunc:e.__RemapTemplates.IDENTITY,display:"English Mixed-Case (QWERTY)",blurb:""},{id:"japn-hir",module:"Japanese",export:"Hiragana",numLeaves:71,remapFunc:e.__RemapTemplates.TO_LOWER,display:"Japanese Hiragana",blurb:""},{id:"japn-kat",module:"Japanese",export:"Katakana",numLeaves:70,remapFunc:e.__RemapTemplates.TO_LOWER,display:"Japanese Katakana",blurb:""},{id:"kore-dub",module:"Korean",export:"Dubeolsik",numLeaves:9177,remapFunc:e.__RemapTemplates.IDENTITY,display:"Korean Dubeolsik (두벌식 키보드)",blurb:"The most common keyboard layout, and South Korea's only Hangul standard since 1969. Consonants are on the left, and vowels on the right."},{id:"kore-sub",module:"Korean",export:"Sebeolsik",numLeaves:10206,remapFunc:e.__RemapTemplates.IDENTITY,display:"Korean Sebeolsik (세벌식 최종 키보드)",blurb:"Another Hangul keyboard layout used in South Korea, and the final Sebeolsik layout designed by Dr. Kong Byung Woo, hence the name. Syllable-initial consonants are on the right, final consonants on the left, and vowels in the middle. It is more ergonomic than the dubeolsik, but not widely used."},{id:"kore-rom",module:"Korean",export:"Romanization",numLeaves:3990,remapFunc:e.__RemapTemplates.TO_LOWER,display:"Korean Revised Romanization",blurb:"The Revised Romanization of Korean (국어의 로마자 표기법; 國語의 로마字 表記法) is the official South Korean language romanization system. It was developed by the National Academy of the Korean Language from 1995, and was released on 7 July 2000 by South Korea's Ministry of Culture and Tourism"}].map(e=>Object.freeze(e))),e.FrontendDescs,e.GET_FRONTEND_DESC_BY_ID=function(t){const n=e.FrontendDescs.find(e=>e.id===t);if(!n)throw new Error(`Frontend descriptor of language with id "${t}" not found.`);return n}}(r||(r={})),Object.freeze(r),Object.freeze(r.prototype)},function(e,t,n){"use strict";var s;n.d(t,"a",(function(){return s})),function(e){let t,n,s,o;!function(e){e.SERVER="SERVER",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(t=e.Type||(e.Type={})),function(e){e.EVENT_NAME="game-create"}(n=e.CtorArgs||(e.CtorArgs={})),function(e){e.EVENT_NAME="game-reset"}(s=e.Serialization||(e.Serialization={})),function(e){e.PLAYING="PLAYING",e.PAUSED="PAUSED",e.OVER="OVER"}(o=e.Status||(e.Status={})),e.K=Object.freeze({HEALTH_UPDATE_CHANCE:.1,PCT_MOVES_THAT_ARE_BOOST:.05,HEALTH_EFFECT_FOR_DOWNED_PLAYER:.6,EVENT_RECORD_WRAPPING_BUFFER_LENGTH:128,EVENT_RECORD_FORWARD_WINDOW_LENGTH:64})}(s||(s={})),Object.freeze(s)},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t),n.d(t,"OmHooks",(function(){return r.a})),n.d(t,"top",(function(){return se}));var s,o,a,r=n(0),i=function(e,t,n,s){return new(n||(n=Promise))((function(o,a){function r(e){try{c(s.next(e))}catch(e){a(e)}}function i(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}c((s=s.apply(e,t||[])).next())}))},c=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},l=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};class u{constructor(e,t,n,a){s.set(this,void 0),o.set(this,void 0),this.screenId=e,this.toplevel=t,c(this,s,n),this.requestGoToScreen=a,c(this,o,!1)}enter(e){return i(this,void 0,void 0,(function*(){if(!l(this,o)){const e=this.baseElem=document.createElement("div");e.classList.add(r.a.Screen.Class.BASE),this.__lazyLoad(),l(this,s).appendChild(e);const t=this.screenId.replace(/[A-Z]/g,e=>" "+e);{const n=t.toUpperCase();e.insertAdjacentHTML("beforebegin",`\x3c!-- ${n} SCREEN --\x3e`)}{const n=t.split(" ").map(e=>e.charAt(0).toUpperCase()+e.substring(1)).join(" ");e.setAttribute("aria-label",n+" Screen")}c(this,o,!0)}const t=new window.URL(window.location.href);t.hash=this.screenId,history.replaceState(null,"",t.href),yield this.__abstractOnBeforeEnter(e),window.requestAnimationFrame(e=>{this.baseElem.dataset[r.a.Screen.Dataset.CURRENT]="",this.baseElem.setAttribute("aria-hidden","false")})}))}leave(){return!!this.__abstractOnBeforeLeave()&&(delete this.baseElem.dataset[r.a.Screen.Dataset.CURRENT],this.baseElem.setAttribute("aria-hidden","true"),!0)}__abstractOnBeforeEnter(e){return i(this,void 0,void 0,(function*(){}))}__abstractOnBeforeLeave(){return!0}}s=new WeakMap,o=new WeakMap,function(e){let t;!function(e){e.HOME="home",e.HOW_TO_PLAY="howToPlay",e.HOW_TO_HOST="howToHost",e.COLOUR_CTRL="colourControl",e.SETUP_OFFLINE="setupOffline",e.PLAY_OFFLINE="playOffline",e.GROUP_JOINER="groupJoiner",e.SETUP_ONLINE="setupOnline",e.GROUP_LOBBY="groupLobby",e.PLAY_ONLINE="playOnline"}(t=e.Id||(e.Id={}))}(u||(u={})),Object.freeze(u),Object.freeze(u.prototype);class d extends u{constructor(){super(...arguments),this.canBeInitialScreen=!0}__lazyLoad(){const e=r.a.Screen.Impl.Home.Class;this.baseElem.classList.add(r.a.General.Class.CENTER_CONTENTS,e.BASE);const t=this.navElem=document.createElement("div");function n(e,n){e.classList.add(r.a.General.Class.CENTER_CONTENTS,r.a.General.Class.INPUT_GROUP_ITEM,n.cssClass),e.textContent=n.text,e.addEventListener("pointerenter",()=>{e.focus()}),t.appendChild(e)}t.classList.add(r.a.General.Class.TEXT_SELECT_DISABLED,r.a.General.Class.INPUT_GROUP,e.NAV),t.setAttribute("role","navigation"),t.addEventListener("pointerleave",()=>{var e;(null===(e=document.activeElement)||void 0===e?void 0:e.parentElement)===t&&document.activeElement.blur()}),[{text:"Offline Single-player",cssClass:e.NAV_PLAY_OFFLINE,screenId:u.Id.PLAY_OFFLINE},{text:"Online Multi-player",cssClass:e.NAV_PLAY_ONLINE,screenId:u.Id.GROUP_JOINER},{text:"How To Play",cssClass:e.NAV_HOW_TO_PLAY,screenId:u.Id.HOW_TO_PLAY},{text:"How To Host",cssClass:e.NAV_HOW_TO_HOST,screenId:u.Id.HOW_TO_HOST},{text:"Colour Schemes",cssClass:e.NAV_COLOURS,screenId:u.Id.COLOUR_CTRL}].map(e=>Object.freeze(e)).forEach(e=>{const t=document.createElement("button");t.onclick=e.screenId instanceof Function?e.screenId:()=>{this.requestGoToScreen(e.screenId,{})},n(t,e)}),[{text:"Visit\nRepo",cssClass:e.NAV_VIEW_REPO,href:new window.URL("https://github.com/david-fong/SnaKey-NTS")},{text:"Report\nIssue",cssClass:e.NAV_RPT_ISSUE,href:new window.URL("https://github.com/david-fong/SnaKey-NTS/issues")}].map(e=>Object.freeze(e)).forEach(e=>{const t=document.createElement("a");t.href=e.href.toString(),t.referrerPolicy="strict-origin-when-cross-origin",t.rel="noopener",t.target="_blank",n(t,e)}),this.baseElem.appendChild(t)}}Object.freeze(d),Object.freeze(d.prototype);class p extends u{constructor(){super(...arguments),this.canBeInitialScreen=!0}__lazyLoad(){}}Object.freeze(p),Object.freeze(p.prototype);class h extends u{constructor(){super(...arguments),this.canBeInitialScreen=!0}__lazyLoad(){}}(h||(h={})).INSTRUCTIONS_STEPS=Object.freeze(["$ npm install 'https://github.com/david-fong/SnaKey-NTS#gh-pages'","$ npm run start","send the url to your friends"]),Object.freeze(h),Object.freeze(h.prototype),function(e){let t;e.LocalKeys=Object.freeze({MUSIC_VOLUME:"musicVolume",SFX_VOLUME:"sfxVolume",COLOUR_ID:"colourSchemeId",COLOUR_LITERAL:"colourSchemeStyleLiteral",GAME_PRESET:"gamePresetId",USERNAME:"username",AVATAR:"avatarId"}),e.SessionKeys=Object.freeze({}),function(e){let t;e.DB_NAME="snakeyDB",function(e){e.STORE_NAME="userGamePresets"}(t=e.UserGamePresetStore||(e.UserGamePresetStore={})),Object.freeze(t)}(t=e.IDB||(e.IDB={})),Object.freeze(t)}(a||(a={})),Object.freeze(a);var m,E,O,f,_,g,v,T=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},S=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};class b{constructor(){m.set(this,void 0),E.set(this,void 0),O.set(this,void 0);const e=document.createElement("div");e.tabIndex=0,e.classList.add(r.a.SkPickOne.Class.BASE),e.addEventListener("keydown",this.onKeyDown.bind(this)),e.setAttribute("role","listbox"),this.baseElem=e,this.options=[]}addOption(e){this.options.push(e),this.baseElem.appendChild(e.baseElem),e.__registerParent(this.onOptDisabledChange.bind(this))}hoverOpt(e){var t;this.hoveredOpt!==e&&(null===(t=this.hoveredOpt)||void 0===t||t.baseElem.setAttribute("aria-active-descendant","false"),T(this,E,e),this.hoveredOpt.baseElem.setAttribute("aria-active-descendant","true"))}selectOpt(e,t=!0){var n;if(!e)throw new Error("opt must be defined");this.hoverOpt(e),this.confirmedOpt!==e&&(null===(n=this.confirmedOpt)||void 0===n||n.baseElem.setAttribute("aria-selected","false"),T(this,m,e),this.confirmedOpt.baseElem.setAttribute("aria-selected","true"),t&&this.__onSelectOpt(e))}get confirmedOpt(){return S(this,m)}get hoveredOpt(){return S(this,E)}onOptDisabledChange(e){this.confirmedOpt===e&&(this.validity=!e.disabled)}set validity(e){this.validity!==e&&(this.baseElem.setAttribute("aria-invalid",e?"false":"true"),T(this,O,e))}onKeyDown(e){if(" "===e.key||"Enter"===e.key)return this.selectOpt(this.hoveredOpt),e.preventDefault(),!1;{const t=this.options.indexOf(this.hoveredOpt);if("ArrowDown"===e.key||"Down"===e.key){if(t<this.options.length-1)return this.hoverOpt(this.options[t+1]),e.preventDefault(),!1}else if(("ArrowUp"===e.key||"Up"===e.key)&&t>0)return this.hoverOpt(this.options[t-1]),e.preventDefault(),!1}return!0}}m=new WeakMap,E=new WeakMap,O=new WeakMap,f=b||(b={}),_=new WeakMap,g=new WeakMap,f.__Option=class{constructor(){_.set(this,void 0),g.set(this,void 0);const e=this.baseElem=document.createElement("div");e.classList.add(r.a.SkPickOne.Class.OPT_BASE),e.setAttribute("role","option"),T(this,_,!1)}__registerParent(e){T(this,g,e)}get disabled(){return S(this,_)}set disabled(e){this.disabled!==e&&(this.baseElem.setAttribute("aria-disabled",e?"true":"false"),T(this,_,e),S(this,g).call(this,this))}},Object.freeze(f),Object.freeze(f.prototype),Object.freeze(b),Object.freeze(b.prototype),n(4);class y extends u{constructor(){super(...arguments),this.canBeInitialScreen=!0}__lazyLoad(){const e=new y.PickOne;this.baseElem.appendChild(e.baseElem),this.sel=e;const t=localStorage.getItem(a.LocalKeys.COLOUR_ID);t&&this.sel.selectOpt(this.sel.getOptById(t),!1)}}!function(e){class t extends b{constructor(){if(super(),this.garageDoorElem=document.getElementById(r.a.Screen.Id.SCREEN_TINT),!this.garageDoorElem)throw new Error;this.garageDoorElem.style.transitionDuration=v.SMOOTH_CHANGE_DURATION/3+"ms";for(const e of v.Schemes)this.addOption(new t.Option(e));this.selectOpt(this.getOptById("snakey"),!1)}__onHoverOpt(e){}__onSelectOpt(e){localStorage.setItem(a.LocalKeys.COLOUR_ID,e.desc.id),localStorage.setItem(a.LocalKeys.COLOUR_LITERAL,e.cssLiteral);const t=v.SMOOTH_CHANGE_DURATION/3+80;setTimeout(()=>{this.garageDoorElem.style.opacity=1..toString(),setTimeout(()=>{document.documentElement.dataset[r.a.General.Dataset.COLOUR_SCHEME]=e.desc.id,setTimeout(()=>{this.garageDoorElem.style.opacity=(0).toString()},t)},t)},t)}getOptById(e){return this.options.find(t=>t.desc.id===e)}}e.PickOne=t,function(e){class t extends b.__Option{constructor(e){super(),this.desc=e}}e.Option=t,Object.freeze(t),Object.freeze(t.prototype)}(t=e.PickOne||(e.PickOne={})),Object.freeze(t),Object.freeze(t.prototype)}(y||(y={})),Object.freeze(y),Object.freeze(y.prototype),function(e){e.Swatch=Object.freeze(["mainFg","mainBg","tileFg","tileBg","tileBd","healthFg","healthBg","pFaceMe","pFaceTeammate","pFaceImtlTeammate","pFaceOpponent","pFaceImtlOpponent"]),e.Schemes=Object.freeze([{id:"snakey",displayName:"Snakey",author:"N.W."},{id:"smooth-stone",displayName:"Smooth Stone",author:"Dav"}].map(e=>Object.freeze(e))),e.SMOOTH_CHANGE_DURATION=2e3}(v||(v={})),Object.freeze(v);var N=n(1);class I extends u{__lazyLoad(){this.createLangSelector()}createLangSelector(){const e=document.createElement("select");for(const t of Object.values(N.a.FrontendDescs)){const n=document.createElement("option");n.value=t.id,n.textContent=t.display,e.add(n)}e.onchange=()=>{e.blur()},this.langSel=e}}Object.freeze(I),Object.freeze(I.prototype);class L extends I{constructor(){super(...arguments),this.canBeInitialScreen=!0}}Object.freeze(L),Object.freeze(L.prototype);var C,R,A,P,w=function(e,t,n,s){return new(n||(n=Promise))((function(o,a){function r(e){try{c(s.next(e))}catch(e){a(e)}}function i(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}c((s=s.apply(e,t||[])).next())}))},G=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},k=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n};class U extends u{constructor(){super(...arguments),C.set(this,void 0),R.set(this,void 0),A.set(this,void 0),P.set(this,void 0)}__lazyLoad(){this.baseElem.classList.add(r.a.Screen.Impl.PlayGame.Class.BASE);const e=U.createCenterColElem();this.gridElem=e.gridElem,this.baseElem.appendChild(e.baseElem),this.initializeControlsBar(),this.initializeScoresBar(),k(this,R,()=>{this.wantsAutoPause&&(document.hidden?void 0===G(this,P)&&this.statusBecomePaused():"page-hide"===G(this,P)&&this.statusBecomePlaying())}),k(this,A,this.__gridKeyDownCallback.bind(this))}__abstractOnBeforeEnter(e){return w(this,void 0,void 0,(function*(){document.addEventListener("visibilitychange",G(this,R)),this.pauseButton.disabled=!0,this.statusBecomePaused(),k(this,C,yield this.__createNewGame()),this.gridElem.addEventListener("keydown",G(this,A)),yield this.currentGame.reset(),this.gridElem.insertAdjacentElement("afterbegin",this.currentGame.htmlElements.gridImplElem),this.pauseButton.onclick=this.statusBecomePlaying.bind(this),this.pauseButton.disabled=!1,this.wantsAutoPause&&setTimeout(()=>{document.hidden||this.statusBecomePlaying()},500)}))}__abstractOnBeforeLeave(){if(!window.confirm("Are you sure you would like to leave?"))return!1;document.removeEventListener("visibilitychange",G(this,R));for(const e of Object.values(this.currentGame.htmlElements))e.remove();return this.gridElem.removeEventListener("keydown",G(this,A)),k(this,C,void 0),!0}get currentGame(){return G(this,C)}__gridKeyDownCallback(e){if(e.ctrlKey&&" "===e.key){const e=this.currentGame.operators;this.currentGame.currentOperator=e[(e.indexOf(this.currentGame.currentOperator)+1)%e.length]}else this.currentGame.currentOperator.processKeyboardInput(e);return" "!==e.key||(e.preventDefault(),!1)}statusBecomePlaying(){var e;const t=r.a.Grid.Dataset.GAME_STATE;null===(e=this.currentGame)||void 0===e||e.statusBecomePlaying(),this.pauseButton.textContent="Pause",k(this,P,void 0),this.gridElem.dataset[t.KEY]=t.VALUES.PLAYING,window.requestAnimationFrame(e=>{this.pauseButton.onclick=this.statusBecomePaused.bind(this),this.resetButton.disabled=!0,this.gridElem.focus()})}statusBecomePaused(){var e;const t=r.a.Grid.Dataset.GAME_STATE;null===(e=this.currentGame)||void 0===e||e.statusBecomePaused(),this.pauseButton.textContent="Unpause",k(this,P,document.hidden?"page-hide":"other"),this.gridElem.dataset[t.KEY]=t.VALUES.PAUSED,this.pauseButton.onclick=this.statusBecomePlaying.bind(this),this.resetButton.disabled=!1}__onGameBecomeOver(){const e=r.a.Grid.Dataset.GAME_STATE;this.pauseButton.disabled=!0,this.gridElem.dataset[e.KEY]=e.VALUES.OVER}__resetGame(){this.currentGame.reset(),this.pauseButton.disabled=!1,this.wantsAutoPause&&this.statusBecomePlaying()}initializeControlsBar(){const e=document.createElement("div");e.classList.add(r.a.General.Class.INPUT_GROUP,r.a.Screen.Impl.PlayGame.Class.CONTROLS_BAR),e.setAttribute("role","menu");{const t=this.backToHomeButton=document.createElement("button");t.classList.add(r.a.General.Class.INPUT_GROUP_ITEM),t.textContent="Return To Homepage",t.onclick=this.requestGoToScreen.bind(this,u.Id.HOME),e.appendChild(t)}{const t=this.pauseButton=document.createElement("button");t.classList.add(r.a.General.Class.INPUT_GROUP_ITEM),e.appendChild(t)}{const t=this.resetButton=document.createElement("button");t.classList.add(r.a.General.Class.INPUT_GROUP_ITEM),t.textContent="Reset",t.onclick=this.__resetGame.bind(this),e.appendChild(t)}this.baseElem.appendChild(e)}initializeScoresBar(){}}C=new WeakMap,R=new WeakMap,A=new WeakMap,P=new WeakMap,(U||(U={})).createCenterColElem=function(){const e=r.a.General.Class,t=document.createElement("div");t.classList.add(e.CENTER_CONTENTS,r.a.Screen.Impl.PlayGame.Class.GRID_CONTAINER);const n=document.createElement("div");n.tabIndex=0,n.setAttribute("role","textbox"),n.setAttribute("aria-label","Game Grid"),n.classList.add(e.CENTER_CONTENTS,e.STACK_CONTENTS,e.TEXT_SELECT_DISABLED,r.a.Grid.Class.GRID);{const t=document.createElement("div");t.classList.add(e.CENTER_CONTENTS,r.a.Grid.Class.KBD_DC);{const e=document.createElement("div");e.classList.add(r.a.Grid.Class.KBD_DC_ICON),e.textContent="(click here to continue typing)",t.appendChild(e)}n.appendChild(t)}{const t=document.createElement("div");t.classList.add(e.CENTER_CONTENTS,r.a.Grid.Class.PAUSE_OL);{const e=document.createElement("div");e.classList.add(r.a.Grid.Class.PAUSE_OL_ICON),e.textContent="(The Game is Paused)",t.appendChild(e)}n.appendChild(t)}return t.appendChild(n),Object.freeze({baseElem:t,gridElem:n})},Object.freeze(U),Object.freeze(U.prototype);var B=function(e,t,n,s){return new(n||(n=Promise))((function(o,a){function r(e){try{c(s.next(e))}catch(e){a(e)}}function i(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}c((s=s.apply(e,t||[])).next())}))};class H extends U{constructor(){super(...arguments),this.canBeInitialScreen=!0,this.wantsAutoPause=!0}__lazyLoad(){super.__lazyLoad()}__createNewGame(){return B(this,void 0,void 0,(function*(){return new((yield Promise.all([n.e(0),n.e(1)]).then(n.bind(null,29))).OfflineGame)({coordSys:"EUCLID2",gridDimensions:{height:21,width:21},averageFreeHealthPerTile:1/45,langBalancingScheme:N.a.BalancingScheme.WEIGHT,langId:"engl-low",playerDescs:[{isALocalOperator:!0,familyId:"HUMAN",teamId:0,socketId:void 0,username:"hello world 1",noCheckGameOver:!1,familyArgs:{}},{isALocalOperator:!0,familyId:"HUMAN",teamId:0,socketId:void 0,username:"hello world 2",noCheckGameOver:!1,familyArgs:{}},{isALocalOperator:!1,familyId:"CHASER",teamId:1,socketId:void 0,username:"chaser test 1",noCheckGameOver:!0,familyArgs:{fearDistance:5,bloodThirstDistance:7,healthReserve:3,movesPerSecond:2}},{isALocalOperator:!1,familyId:"CHASER",teamId:1,socketId:void 0,username:"chaser test 2",noCheckGameOver:!0,familyArgs:{fearDistance:5,bloodThirstDistance:7,healthReserve:3,movesPerSecond:2}}]})}))}}Object.freeze(H),Object.freeze(H.prototype);class D{}!function(e){let t;e.PROTOCOL="http://",e.DEFAULT_PORT=8080,function(e){e.GROUP_LOBBY_PREFIX="/group-",e.GROUP_JOINER="/joiner"}(t=e.Nsps||(e.Nsps={}))}(D||(D={})),Object.freeze(D),Object.freeze(D.prototype);class x{}!function(e){let t,n,s;!function(e){e.REGEXP=/(?:[a-zA-Z0-9:-]+)/,e.MaxLength=30}(t=e.Name||(e.Name={})),function(e){e.REGEXP=/(?:[a-zA-Z0-9:-]+)/,e.MaxLength=30}(n=e.Passphrase||(e.Passphrase={})),e.JoinerReconnectionAttempts=2,e.DEFAULT_TTL=60,function(e){e.EVENT_NAME="group-exist";class t{constructor(e,t){this.groupName=e,this.passphrase=t}}let n;e.RequestCreate=t,function(e){let t;!function(e){e.OKAY="okay",e.NOPE="nope"}(t=e.Response||(e.Response={}))}(t=e.RequestCreate||(e.RequestCreate={})),function(e){e.IN_LOBBY="in-lobby",e.IN_GAME="in-game",e.DELETE="delete"}(n=e.Status||(e.Status={}))}(s=e.Exist||(e.Exist={}))}(x||(x={})),Object.freeze(x),Object.freeze(x.prototype);var j,z=function(e,t,n,s){return new(n||(n=Promise))((function(o,a){function r(e){try{c(s.next(e))}catch(e){a(e)}}function i(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}c((s=s.apply(e,t||[])).next())}))},M=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},F=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n};class W extends u{constructor(){super(...arguments),this.canBeInitialScreen=!1,j.set(this,void 0)}__lazyLoad(){this.baseElem.classList.add(r.a.General.Class.CENTER_CONTENTS,r.a.Screen.Impl.GroupJoiner.Class.BASE);const e=this.__initializeFormContents(),t=this.__initializeHostUrlHandlers();this.__initializeGroupNameHandlers(t),this.__initializePassphraseHandlers(),e.onsubmit=e=>{this.requestGoToScreen(u.Id.PLAY_ONLINE,{})},this.__setFormState(Y.CHOOSING_HOST),this.baseElem.appendChild(e)}__abstractOnBeforeEnter(e){return z(this,void 0,void 0,(function*(){window.setTimeout(()=>{this.socket&&this.socket.nsp.startsWith(D.Nsps.GROUP_LOBBY_PREFIX)?this.groupNameInput.focus():this.hostUrlInput.focus()},100)}))}get state(){return M(this,j)}__setFormState(e){if(this.state!==e){if(e===Y.IN_GROUP){if(this.state!==Y.CHOOSING_GROUP)throw new Error("never");this.passphraseInput.disabled=!0,this.nextButton.disabled=!1,this.nextButton.focus()}else this.nextButton.disabled=!0,e===Y.CHOOSING_HOST?(this.groupNameInput.disabled=!0,this.groupNameInput.value="",this.groupNameDataList.replaceWith(this.groupNameDataList.cloneNode()),this.passphraseInput.disabled=!0,this.passphraseInput.value="",this.hostUrlInput.focus()):e===Y.CHOOSING_GROUP&&(this.groupNameInput.disabled=!1,this.passphraseInput.disabled=!1,this.groupNameInput.focus());F(this,j,e)}}__initializeHostUrlHandlers(){const e=this.toplevel,t=this.hostUrlInput,n=()=>z(this,void 0,void 0,(function*(){var n;if(t.value.startsWith(D.PROTOCOL)||(t.value=new URL(D.PROTOCOL+t.value).origin),!t.value||!t.validity.valid)return;const s=new URL(t.value+D.Nsps.GROUP_JOINER);if(this.socket&&this.socket.nsp===D.Nsps.GROUP_JOINER&&this.socket.io.opts.hostname===s.hostname)return this.socket.connected?(this.__setFormState(Y.CHOOSING_GROUP),void this.groupNameInput.focus()):void 0;null===(n=this.socket)||void 0===n||n.close(),this.socket=(yield e.socketIo)(s.toString(),{reconnectionAttempts:x.JoinerReconnectionAttempts}),this.socket.on("connect",()=>{this.__setFormState(Y.CHOOSING_GROUP),this.socket.on(x.Exist.EVENT_NAME,this.onNotifyGroupExist.bind(this))}),this.socket.on("connect_error",e=>{this.socket=void 0,this.toplevel.toast("Unable to connected to the specified server.")}),this.socket.on("disconnect",n=>{"io server disconnect"===n&&(this.socket=void 0,this.__setFormState(Y.CHOOSING_HOST),t.value="",e.toast("The server disconnected you from the group joiner."))})}));return t.oninput=e=>this.__setFormState(Y.CHOOSING_HOST),t.onkeydown=e=>{"Enter"===e.key&&n()},t.onpaste=e=>{window.setTimeout(()=>n(),0)},t.onchange=()=>{n()},n}onNotifyGroupExist(e){if(e===x.Exist.RequestCreate.Response.NOPE)return void this.toplevel.toast(`The server rejected your request to create a new group "${this.groupNameInput.value}".`);const t=this.groupNameDataList,n=Array.from(t.children);for(const[s,o]of Object.entries(e)){const e=n.find(e=>e.value===s)||(()=>{const e=document.createElement("option");e.value=s;for(const s of n)if(e.value.localeCompare(s.value)<0){t.insertBefore(e,s);break}return e.parentElement||t.appendChild(e),e})();switch(o){case x.Exist.Status.IN_LOBBY:e.remove();break;case x.Exist.Status.IN_GAME:e.textContent="In Game";break;case x.Exist.Status.DELETE:e.textContent="In Lobby"}}e===x.Exist.RequestCreate.Response.OKAY&&(console.info(`server accepted request to create new group \`${this.groupNameInput.value}\`.`),console.log("connecting to new group..."),this.attemptToJoinExistingGroup())}__initializeGroupNameHandlers(e){const t=this.groupNameInput,n=()=>{t.value&&t.validity.valid&&(this.state===Y.IN_GROUP?this.nextButton.focus():this.passphraseInput.focus())};this.groupNameInput.oninput=t=>z(this,void 0,void 0,(function*(){this.state===Y.IN_GROUP&&(yield e()),this.passphraseInput.value=""})),t.onkeydown=e=>{"Enter"===e.key&&n()},t.onchange=e=>{n()}}__initializePassphraseHandlers(){const e=()=>z(this,void 0,void 0,(function*(){if(!this.passphraseInput.validity.valid)return;if(this.socket.nsp===D.Nsps.GROUP_LOBBY_PREFIX+this.groupNameInput.value)return this.socket.connected?(this.__setFormState(Y.IN_GROUP),void this.nextButton.focus()):void 0;Array.from(this.groupNameDataList.children).some(e=>e.value===this.groupNameInput.value)?yield this.attemptToJoinExistingGroup():this.socket.emit(x.Exist.EVENT_NAME,new x.Exist.RequestCreate(this.groupNameInput.value,this.passphraseInput.value))}));this.passphraseInput.onkeydown=t=>{"Enter"===t.key&&e()}}attemptToJoinExistingGroup(){var e;return z(this,void 0,void 0,(function*(){const t=(()=>{const e=new URL(this.hostUrlInput.value);return e.pathname=D.Nsps.GROUP_LOBBY_PREFIX+this.groupNameInput.value,e.toString()})();null===(e=this.socket)||void 0===e||e.close();const n=this.toplevel;this.socket=(yield n.socketIo)(t,{query:{passphrase:this.passphraseInput.value}}),this.socket.on("connect",()=>{this.__setFormState(Y.IN_GROUP)}),this.socket.on("connect_error",e=>{this.socket=void 0,n.toast("Unable to connect to the specified group.")}),this.socket.on("disconnect",e=>{"io server disconnect"===e&&(this.socket=void 0,n.toast("The server disconnected you from your group."))})}))}get socket(){return this.toplevel.socket}set socket(e){this.toplevel.socket=e}__initializeFormContents(){const e=r.a.Screen.Impl.GroupJoiner.Class,t=document.createElement("form");function n(e){const n=document.createElement("input");n.classList.add(r.a.General.Class.INPUT_GROUP_ITEM),n.type="text",n.autocomplete="off",n.spellcheck=!1;const s=document.createElement("label");return s.textContent=e,s.appendChild(n),t.appendChild(s),n}t.classList.add(r.a.General.Class.INPUT_GROUP,e.CONTENT_WRAPPER);{const t=this.hostUrlInput=n("Host URL");t.type="url",t.classList.add(e.HOST_URL),t.autocomplete="on";const s=W.SUGGEST_HOST(this.toplevel.webpageHostType);if(s){const e=document.createElement("option");e.value=s.value,e.textContent=s.description,document.getElementById(r.a.GLOBAL_IDS.PUBLIC_GAME_HOST_URLS).insertAdjacentElement("afterbegin",e)}t.setAttribute("list",r.a.GLOBAL_IDS.PUBLIC_GAME_HOST_URLS),t.maxLength=128}{const t=this.groupNameInput=n("Group Name");t.classList.add(e.GROUP_NAME),t.pattern=x.Name.REGEXP.source,t.maxLength=x.Name.MaxLength;const s=this.groupNameDataList=document.createElement("datalist");s.id=r.a.GLOBAL_IDS.CURRENT_HOST_GROUPS,this.baseElem.appendChild(s),t.setAttribute("list",s.id)}{const t=this.passphraseInput=n("Group Passphrase");t.classList.add(e.PASSPHRASE),t.pattern=x.Passphrase.REGEXP.source,t.maxLength=x.Passphrase.MaxLength}{const n=this.nextButton=document.createElement("input");n.type="submit",n.classList.add(r.a.General.Class.INPUT_GROUP_ITEM,e.NEXT_BUTTON),n.textContent=n.value="Next",t.appendChild(n)}return t}}j=new WeakMap,function(e){let t;!function(e){e.CHOOSING_HOST="choosing-host",e.CHOOSING_GROUP="choosing-group",e.IN_GROUP="in-group"}(t=e.State||(e.State={})),e.SUGGEST_HOST=function(e){switch(e){case"github":return;case"filesystem":return{value:"localhost:"+D.DEFAULT_PORT,description:"dev shortcut :)"};case"lan-server":return{value:window.location.origin,description:"this page's server"};default:return}}}(W||(W={}));const Y=W.State;Object.freeze(W),Object.freeze(W.prototype);class V extends I{constructor(){super(...arguments),this.canBeInitialScreen=!1}}Object.freeze(V),Object.freeze(V.prototype);class K extends u{constructor(){super(...arguments),this.canBeInitialScreen=!1}__lazyLoad(){}}Object.freeze(K),Object.freeze(K.prototype);var J=n(2),q=function(e,t,n,s){return new(n||(n=Promise))((function(o,a){function r(e){try{c(s.next(e))}catch(e){a(e)}}function i(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}c((s=s.apply(e,t||[])).next())}))};class X extends U{constructor(){super(...arguments),this.canBeInitialScreen=!1,this.wantsAutoPause=!1}__lazyLoad(){super.__lazyLoad()}__createNewGame(){return q(this,void 0,void 0,(function*(){return new Promise((e,t)=>{this.toplevel.socket.on(J.a.CtorArgs.EVENT_NAME,t=>q(this,void 0,void 0,(function*(){const s=new((yield Promise.all([n.e(0),n.e(2)]).then(n.bind(null,28))).OnlineGame)(this.toplevel.socket,t);e(s)})))})}))}}Object.freeze(X),Object.freeze(X.prototype);var $,Q,Z=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},ee=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};class te{constructor(e,t){$.set(this,void 0),t.setAttribute("role","presentation"),t.insertAdjacentHTML("beforebegin","\x3c!-- ALL SCREENS CONTAINER --\x3e");const n=u.Id,s=e,o=t,a=this.goToScreen.bind(this);this.dict=Object.freeze({[n.HOME]:new d(n.HOME,s,o,a),[n.HOW_TO_PLAY]:new p(n.HOW_TO_PLAY,s,o,a),[n.HOW_TO_HOST]:new h(n.HOW_TO_HOST,s,o,a),[n.COLOUR_CTRL]:new y(n.COLOUR_CTRL,s,o,a),[n.SETUP_OFFLINE]:new L(n.SETUP_OFFLINE,s,o,a),[n.PLAY_OFFLINE]:new H(n.PLAY_OFFLINE,s,o,a),[n.GROUP_JOINER]:new W(n.GROUP_JOINER,s,o,a),[n.SETUP_ONLINE]:new V(n.SETUP_ONLINE,s,o,a),[n.GROUP_LOBBY]:new K(n.GROUP_LOBBY,s,o,a),[n.PLAY_ONLINE]:new X(n.PLAY_ONLINE,s,o,a)});const r=window.location.hash.slice(1),i=this.dict[r];i&&i.canBeInitialScreen?this.goToScreen(i.screenId,{}):this.goToScreen(u.Id.HOME,{})}goToScreen(e,t){const n=this.dict[e];if(this.currentScreen===n)throw new Error("never happens. see comment in source.");this.currentScreen&&!this.currentScreen.leave()||(n.enter(t),Z(this,$,n))}get currentScreen(){return ee(this,$)}}$=new WeakMap,Object.freeze(te),Object.freeze(te.prototype);class ne{constructor(){Q.set(this,void 0);const e=document.getElementById(r.a.Screen.Id.ALL_SCREENS);if(!e)throw new Error;this.allScreens=new te(this,e),this.webpageHostType=window.location.origin.match(/github\.io/)?ne.WebpageHostType.GITHUB:window.location.protocol.startsWith("file")?ne.WebpageHostType.FILESYSTEM:ne.WebpageHostType.LAN_SERVER,console.log("%c🩺 welcome! 🐍","font:700 2.3em /1.5 monospace; margin:0.4em; border:0.3em solid black;padding:0.4em; color:white; background-color:#3f5e77; border-radius:0.7em; ")}toast(e){console.info(e)}get socketIo(){return new Promise((e,t)=>{const n=document.getElementById("socket.io");if(io)return e(io);n.onload=()=>{e(io)}})}}Q=new WeakMap,function(e){let t;!function(e){e.GITHUB="github",e.FILESYSTEM="filesystem",e.LAN_SERVER="lan-server"}(t=e.WebpageHostType||(e.WebpageHostType={}))}(ne||(ne={})),Object.freeze(ne),Object.freeze(ne.prototype),n(3);const se=new ne;se.webpageHostType===ne.WebpageHostType.GITHUB&&"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/ServiceWorker.js").then(e=>{console.log("ServiceWorker registration successful with scope: ",e.scope)},e=>{console.log("ServiceWorker registration failed: ",e)})}))}]);
//# sourceMappingURL=index.js.map
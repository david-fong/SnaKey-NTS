var snakey3=function(e){function t(t){for(var s,n,r=t[0],i=t[1],o=0,c=[];o<r.length;o++)n=r[o],Object.prototype.hasOwnProperty.call(a,n)&&a[n]&&c.push(a[n][0]),a[n]=0;for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s]);for(l&&l(t);c.length;)c.shift()()}var s={},n={3:0},a={3:0};function r(t){if(s[t])return s[t].exports;var n=s[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.e=function(e){var t=[];n[e]?t.push(n[e]):0!==n[e]&&{0:1}[e]&&t.push(n[e]=new Promise((function(t,s){for(var a="chunk/"+({0:"game/offline~game/online",1:"game/offline",2:"game/online",4:"lang/Cellphone-ts",5:"lang/Emote-ts",6:"lang/English-ts",7:"lang/Japanese-ts",8:"lang/Korean-ts",9:"lang/Morse-ts"}[e]||e)+".css",i=r.p+a,o=document.getElementsByTagName("link"),c=0;c<o.length;c++){var l=(u=o[c]).getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===a||l===i))return t()}var d=document.getElementsByTagName("style");for(c=0;c<d.length;c++){var u;if((l=(u=d[c]).getAttribute("data-href"))===a||l===i)return t()}var h=document.createElement("link");h.rel="stylesheet",h.type="text/css",h.onload=t,h.onerror=function(t){var a=t&&t.target&&t.target.src||i,r=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");r.code="CSS_CHUNK_LOAD_FAILED",r.request=a,delete n[e],h.parentNode.removeChild(h),s(r)},h.href=i,document.getElementsByTagName("head")[0].appendChild(h)})).then((function(){n[e]=0})));var s=a[e];if(0!==s)if(s)t.push(s[2]);else{var i=new Promise((function(t,n){s=a[e]=[t,n]}));t.push(s[2]=i);var o,c=document.createElement("script");c.charset="utf-8",c.timeout=120,r.nc&&c.setAttribute("nonce",r.nc),c.src=function(e){return r.p+"chunk/"+({0:"game/offline~game/online",1:"game/offline",2:"game/online",4:"lang/Cellphone-ts",5:"lang/Emote-ts",6:"lang/English-ts",7:"lang/Japanese-ts",8:"lang/Korean-ts",9:"lang/Morse-ts"}[e]||e)+".js"}(e);var l=new Error;o=function(t){c.onerror=c.onload=null,clearTimeout(d);var s=a[e];if(0!==s){if(s){var n=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+n+": "+r+")",l.name="ChunkLoadError",l.type=n,l.request=r,s[1](l)}a[e]=void 0}};var d=setTimeout((function(){o({type:"timeout",target:c})}),12e4);c.onerror=c.onload=o,document.head.appendChild(c)}return Promise.all(t)},r.m=e,r.c=s,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="dist/client/",r.oe=function(e){throw console.error(e),e};var i=window.webpackJsonpsnakey3=window.webpackJsonpsnakey3||[],o=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var l=o;return r(r.s=7)}([function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"b",(function(){return a})),s.d(t,"c",(function(){return r}));function n(e,t,s,n){return new(s||(s=Promise))((function(a,r){function i(e){try{c(n.next(e))}catch(e){r(e)}}function o(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}c((n=n.apply(e,t||[])).next())}))}Object.create;Object.create;function a(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function r(e,t,s){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,s),s}},function(e,t,s){"use strict";s.d(t,"c",(function(){return n})),s.d(t,"d",(function(){return a})),s.d(t,"e",(function(){return r})),s.d(t,"b",(function(){return i})),s.d(t,"a",(function(){return o}));const n=Object.freeze({behavior:"smooth",block:"center",inline:"center"});function a(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(s=>{Object.defineProperty(e.prototype,s,Object.getOwnPropertyDescriptor(t.prototype,s))})})}function r(e){for(const t of Object.getOwnPropertyNames(e)){const s=e[t];"object"==typeof s&&r(s)}return Object.freeze(e)}class i{}!function(e){let t,s,n;e.Family=Object.freeze({HUMAN:"HUMAN",CHASER:"CHASER"}),e.Family,function(e){e.NULL=void 0}(t=e.Id||(e.Id={})),function(e){e.REGEXP=/[ a-zA-Z0-9:-]+/,e.MAX_LENGTH=15}(s=e.Username||(e.Username={})),function(e){e.LOREM_IPSUM="lorem-ipsum"}(n=e.Avatar||(e.Avatar={})),function(e){const t=Object.values(e).filter(e=>"string"==typeof e);e.GET_RANDOM=function(){return t[Math.random()*t.length]}}(n=e.Avatar||(e.Avatar={})),e.MoveType=Object.freeze({NORMAL:"NORMAL",BOOST:"BOOST"}),e.MoveType}(i||(i={})),Object.freeze(i),Object.freeze(i.prototype);class o{}!function(e){let t,s,n;!function(e){e.REGEXP=new RegExp("^[a-zA-Z0-9!@#$%^&*()-_=+;:'\"\\|,.<>/?]+$")}(t=e.Seq||(e.Seq={})),function(e){e.NULL=Object.freeze({char:"",seq:""})}(s=e.CharSeqPair||(e.CharSeqPair={})),function(e){e.MAX=4}(n=e.WeightExaggeration||(e.WeightExaggeration={})),e.CHAR_HIT_COUNT_SEED_CEILING=5,e._RemapTemplates=Object.freeze({IDENTITY:e=>e,TO_LOWER:e=>e.toLowerCase()}),e._RemapTemplates,e.FrontendDescs=Object.freeze([{id:"engl-low",module:"English",export:"Lowercase",numLeaves:26,remapFunc:e._RemapTemplates.TO_LOWER,displayName:"English Lowercase (qwerty)",blurb:""},{id:"engl-mix",module:"English",export:"MixedCase",numLeaves:52,remapFunc:e._RemapTemplates.IDENTITY,displayName:"English Mixed-Case (Querty)",blurb:""},{id:"japn-hir",module:"Japanese",export:"Hiragana",numLeaves:71,remapFunc:e._RemapTemplates.TO_LOWER,displayName:"Japanese Hiragana",blurb:""},{id:"japn-kat",module:"Japanese",export:"Katakana",numLeaves:70,remapFunc:e._RemapTemplates.TO_LOWER,displayName:"Japanese Katakana",blurb:""},{id:"kore-dub",module:"Korean",export:"Dubeolsik",numLeaves:9177,remapFunc:e._RemapTemplates.IDENTITY,displayName:"Korean Dubeolsik (두벌식 키보드)",blurb:"The most common keyboard layout, and South Korea's only Hangul standard since 1969. Consonants are on the left, and vowels on the right."},{id:"kore-sub",module:"Korean",export:"Sebeolsik",numLeaves:10206,remapFunc:e._RemapTemplates.IDENTITY,displayName:"Korean Sebeolsik (세벌식 최종 키보드)",blurb:"Another Hangul keyboard layout used in South Korea, and the final Sebeolsik layout designed by Dr. Kong Byung Woo, hence the name. Syllable-initial consonants are on the right, final consonants on the left, and vowels in the middle. It is more ergonomic than the dubeolsik, but not widely used."},{id:"kore-rom",module:"Korean",export:"Romanization",numLeaves:3990,remapFunc:e._RemapTemplates.TO_LOWER,displayName:"Korean Revised Romanization",blurb:"The Revised Romanization of Korean (국어의 로마자 표기법; 國語의 로마字 表記法) is the official South Korean language romanization system. It was developed by the National Academy of the Korean Language from 1995, and was released on 7 July 2000 by South Korea's Ministry of Culture and Tourism"},{id:"engl-cell-enc",module:"English",export:"OldCellphone.Encode",numLeaves:8,remapFunc:e._RemapTemplates.IDENTITY,displayName:"Old Cellphone Keyboard",blurb:""}].map(e=>Object.freeze(e))),e.FrontendDescs,e.GET_FRONTEND_DESC_BY_ID=function(t){return e.FrontendDescs.find(e=>e.id===t)}}(o||(o={})),Object.freeze(o),Object.freeze(o.prototype)},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var n,a=s(1);!function(e){let t,s,n,a,r,i;e.GLOBAL_IDS={PUBLIC_GAME_HOST_URLS:"public-game-hosts-list",CURRENT_HOST_GROUPS:"current-host-groups-list"},function(e){e.Class={TEXT_SELECT_DISABLED:"text-select-disabled",FILL_PARENT:"fill-parent",CENTER_CONTENTS:"center-contents",STACK_CONTENTS:"stack-contents",INPUT_GROUP:"sk-input-group",INPUT_GROUP_ITEM:"sk-input-group-item"},e.Dataset={COLOUR_SCHEME:"skColourScheme"}}(t=e.General||(e.General={})),function(e){e.Class={BASE:"tile",POINTER_HB:"tile__pointer-hitbox",LANG_CHAR_WRAP:"tile__char",LANG_SEQ:"tile__seq"},e.Dataset={HEALTH:"health"}}(s=e.Tile||(e.Tile={})),function(e){e.Class={GRID:"game-grid",SCROLL_OUTER:"game-grid-scroll-outer",SCROLL_INNER:"game-grid-scroll-inner",IMPL_BODY:"game-grid-impl-body",KBD_DC:"game-grid-kbd-dc",KBD_DC_ICON:"game-grid-kbd-dc__icon",PAUSE_OL:"game-grid-pause-overlay",PAUSE_OL_ICON:"game-grid-pause-overlay__icon",PLAYER_IOB_ROOT:"grid-player-intersection-root"},e.Dataset={IMPL_COORD_SYS:"coordSys",GAME_STATE:{KEY:"gameState",VALUES:{PLAYING:"playing",PAUSED:"paused",OVER:"over"}}}}(n=e.Grid||(e.Grid={})),function(e){e.Class={BASE:"player",FACE:"player__face",DOWNED_OVERLAY:"player__downed-overlay",SHORT_SPOTLIGHT:"player__spotlight-short",LONG_SPOTLIGHT:"player__spotlight-long"},e.Dataset={DOWNED:{KEY:"downed",VALUES:{TEAM:"team",SELF:"self",NO:"no"}},FACE_SWATCH:"face"}}(a=e.Player||(e.Player={})),function(e){let t;e.Id={ALL_SCREENS:"all-screens-container",SCREEN_TINT:"screen-tint"},e.Class={BASE:"sk-screen",NAV_NEXT:"screen--next-button",NAV_PREV:"screen--back-button"},e.Dataset={CURRENT:"current"},function(e){let t,s,n,a,r,i;!function(e){e.Class={BASE:"screen-home",NAV:"screen-home--nav",NAV_PLAY_OFFLINE:"screen-home--nav--play-offline",NAV_PLAY_ONLINE:"screen-home--nav--play-online",NAV_HOW_TO_PLAY:"screen-home--nav--how-to-play",NAV_HOW_TO_HOST:"screen-home--nav--how-to-host",NAV_COLOURS:"screen-home--nav--colour-scheme",NAV_VIEW_REPO:"screen-home--nav--goto-repo",NAV_RPT_ISSUE:"screen-home--nav--report-issue"}}(t=e.Home||(e.Home={})),function(e){e.Class={BASE:"screen-colour",OPTION:"screen-colour--opt",OPTION_LABEL:"screen-colour--opt-label",OPTION_PREVIEW:"screen-colour--opt-preview"}}(s=e.ColourCtrl||(e.ColourCtrl={})),function(e){e.Class={BASE:"screen-play",GRID_WRAPPER:"screen-play--grid-wrapper",CONTROLS_BAR:"screen-play--controls-bar",PLAYERS_BAR:"screen-play--players-bar"}}(n=e.Play||(e.Play={})),function(e){e.Class={BASE:"screen-setup",LANG_SEL:"screen-setup--lang-sel",LANG_WEIGHT_EXAGG:"screen-setup--lang-weight-exagg"},e.Id={LANG_WEIGHT_EXAGGERATION_LIST:"screen-setup--lang-weight-exaggeration-list"}}(a=e.Setup||(e.Setup={})),function(e){e.Class={BASE:"screen-joiner",CONTENT_WRAPPER:"screen-joiner--content-wrapper",HOST_URL:"screen-joiner--host-url",GROUP_NAME:"screen-joiner--group-name",PASSPHRASE:"screen-joiner--passphrase"}}(r=e.GroupJoiner||(e.GroupJoiner={})),function(e){e.Class={BASE:"screen-lobby",SEC_CLIENT_INFO:"screen-lobby--client-info-section",SEC_TEAMS:"screen-lobby--teams-section",TEAM:"screen-lobby--team",PLAYER:"screen-lobby--player",PLAYER_NAME:"screen-lobby--player__name"}}(i=e.GroupLobby||(e.GroupLobby={}))}(t=e.Impl||(e.Impl={}))}(r=e.Screen||(e.Screen={})),function(e){e.Class={BASE:"sk-pick-one",OPT_BASE:"sk-pick-one--opt"}}(i=e.SkPickOne||(e.SkPickOne={}))}(n||(n={})),Object.freeze(n.Player.Dataset.DOWNED),Object(a.e)(n)},function(e,t,s){"use strict";var n;s.d(t,"a",(function(){return n})),function(e){let t,s,n,a;!function(e){e.SERVER="SERVER",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(t=e.Type||(e.Type={})),function(e){let t;!function(e){e.NAME="game-create",e.RETURN_TO_LOBBY_INDICATOR="return-to-lobby"}(t=e.Event||(e.Event={})),e.EVENT_NAME_CLIENT_READY_RESET="client-ready-for-reset",e.EVENT_NAME_CLIENT_READY_UNPAUSE="client-ready-for-unpause",e.EVENT_NAME_SERVER_APPROVE_UNPAUSE="server-approve-unpause",e.EVENT_NAME_SERVER_APPROVE_PAUSE="server-approve-pause"}(s=e.CtorArgs||(e.CtorArgs={})),function(e){e.EVENT_NAME="game-reset"}(n=e.Serialization||(e.Serialization={})),function(e){e.PLAYING="PLAYING",e.PAUSED="PAUSED",e.OVER="OVER"}(a=e.Status||(e.Status={})),e.K=Object.freeze({HEALTH_UPDATE_CHANCE:.1,PCT_MOVES_THAT_ARE_BOOST:.05,HEALTH_EFFECT_FOR_DOWNED_PLAYER:.6,EVENT_RECORD_WRAPPING_BUFFER_LENGTH:128,EVENT_RECORD_FORWARD_WINDOW_LENGTH:64})}(n||(n={})),Object.freeze(n)},function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"b",(function(){return d}));var n,a,r,i,o,c=s(0),l=s(1);!function(e){let t;!function(e){e.EUCLID2="EUCLID2",e.BEEHIVE="BEEHIVE"}(t=e.System||(e.System={})),e.equals=function(e,t){return e._equals(t)}}(n||(n={})),Object.freeze(n);class d{constructor(e){a.set(this,void 0),r.set(this,void 0),i.set(this,void 0),o.set(this,void 0),this.coord=e,Object(c.c)(this,a,l.b.Id.NULL)}reset(){this.evictOccupant(),this.lastKnownUpdateId=0,this.freeHealth=0,this.setLangCharSeqPair(l.a.CharSeqPair.NULL)}_setOccupant(e,t){Object(c.c)(this,a,e)}get isOccupied(){return this.occupantId!==l.b.Id.NULL}evictOccupant(){Object(c.c)(this,a,l.b.Id.NULL)}get occupantId(){return Object(c.b)(this,a)}get freeHealth(){return Object(c.b)(this,r)}set freeHealth(e){Object(c.c)(this,r,e)}setLangCharSeqPair(e){Object(c.c)(this,i,e.char),Object(c.c)(this,o,e.seq)}get langChar(){return Object(c.b)(this,i)}get langSeq(){return Object(c.b)(this,o)}}a=new WeakMap,r=new WeakMap,i=new WeakMap,o=new WeakMap,Object.freeze(d),Object.freeze(d.prototype)},function(e,t,s){},function(e,t,s){},function(e,t,s){"use strict";s.r(t),s.d(t,"OmHooks",(function(){return o.a})),s.d(t,"_top",(function(){return ee})),s.d(t,"screen",(function(){return te})),s.d(t,"game",(function(){return se}));var n,a,r,i=s(0),o=s(2),c=s(1);!function(e){let t;e.LocalKeys=Object.freeze({MUSIC_VOLUME:"musicVolume",SFX_VOLUME:"sfxVolume",COLOUR_ID:"colourSchemeId",COLOUR_LITERAL:"colourSchemeStyleLiteral",GAME_PRESET:"gamePresetId",USERNAME:"username",AVATAR:"avatarId"}),e.getLastUserInfo=function(){var t,s;return Object.freeze({username:null!==(t=localStorage.getItem(e.LocalKeys.USERNAME))&&void 0!==t?t:"unnamed player",teamId:0,avatar:null!==(s=localStorage.getItem(e.LocalKeys.AVATAR))&&void 0!==s?s:c.b.Avatar.GET_RANDOM()})},e.SessionKeys=Object.freeze({}),function(e){let t;e.DB_NAME="snakeyDB",function(e){e.STORE_NAME="userGamePresets"}(t=e.UserGamePresetStore||(e.UserGamePresetStore={})),Object.freeze(t)}(t=e.IDB||(e.IDB={})),Object.freeze(t)}(n||(n={})),Object.freeze(n);const l=o.a.Screen.Class;class d{constructor(e,t,s,n){a.set(this,void 0),r.set(this,void 0),this.screenId=e,this.top=t,Object(i.c)(this,a,s),this.requestGoToScreen=n,Object(i.c)(this,r,!1),this.nav=Object.freeze({prev:document.createElement("button"),next:document.createElement("button")}),this.nav.prev.classList.add(l.NAV_PREV),this.nav.next.classList.add(l.NAV_NEXT),this.nav.prev.textContent="Back",this.nav.next.textContent="Next",this.nav.prev.onclick=e=>{this.requestGoToScreen(...this.getNavPrevArgs())}}get initialScreen(){return this.screenId}getNavPrevArgs(){const e=d.NavPrevDest[this.screenId];if(e)return[e,{},d.NavDir.BACKWARD];throw"never"}_enter(e,t){return Object(i.a)(this,void 0,void 0,(function*(){if(!Object(i.b)(this,r)){const e=this.baseElem=document.createElement("div");e.classList.add(o.a.Screen.Class.BASE),this._lazyLoad(),Object(i.b)(this,a).appendChild(e);const t=this.screenId.replace(/[A-Z]/g,e=>" "+e);{const s=t.toUpperCase();this.top.prependComment(e,s+" SCREEN")}{const s=t.split(" ").map(e=>e.charAt(0).toUpperCase()+e.substring(1)).join(" ");e.setAttribute("aria-label",s+" Screen")}Object(i.c)(this,r,!0)}{const t=new window.URL(window.location.href);t.hash=this.screenId;const s=[{screenId:this.screenId},"",t.href];switch(e){case d.NavDir.BACKWARD:history.replaceState(...s);break;case d.NavDir.FORWARD:history.pushState(...s);break;default:throw"never"}}yield this._abstractOnBeforeEnter(e,t),window.requestAnimationFrame(e=>{this.baseElem.dataset[o.a.Screen.Dataset.CURRENT]="",this.baseElem.setAttribute("aria-hidden","false")})}))}_leave(e){return!!this._abstractOnBeforeLeave(e)&&(delete this.baseElem.dataset[o.a.Screen.Dataset.CURRENT],this.baseElem.setAttribute("aria-hidden","true"),!0)}_abstractOnBeforeEnter(e,t){return Object(i.a)(this,void 0,void 0,(function*(){}))}_abstractOnBeforeLeave(e){return!0}}a=new WeakMap,r=new WeakMap,function(e){let t,s;!function(e){e.HOME="home",e.HOW_TO_PLAY="howToPlay",e.HOW_TO_HOST="howToHost",e.COLOUR_CTRL="colourControl",e.SETUP_OFFLINE="setupOffline",e.PLAY_OFFLINE="playOffline",e.GROUP_JOINER="groupJoiner",e.SETUP_ONLINE="setupOnline",e.GROUP_LOBBY="groupLobby",e.PLAY_ONLINE="playOnline"}(t=e.Id||(e.Id={})),e.NavPrevDest=Object.freeze({[t.HOME]:t.HOME,[t.HOW_TO_PLAY]:t.HOME,[t.HOW_TO_HOST]:t.HOME,[t.COLOUR_CTRL]:t.HOME,[t.SETUP_OFFLINE]:t.HOME,[t.PLAY_OFFLINE]:t.SETUP_OFFLINE,[t.GROUP_JOINER]:t.HOME,[t.GROUP_LOBBY]:t.GROUP_JOINER,[t.SETUP_ONLINE]:t.GROUP_LOBBY,[t.PLAY_ONLINE]:t.SETUP_ONLINE}),function(e){e.FORWARD="forward",e.BACKWARD="backward"}(s=e.NavDir||(e.NavDir={}))}(d||(d={})),Object.freeze(d),Object.freeze(d.prototype);class u extends d{_lazyLoad(){const e=o.a.Screen.Impl.Home.Class;this.baseElem.classList.add(o.a.General.Class.CENTER_CONTENTS,e.BASE);const t=this.navElem=document.createElement("div");t.classList.add(o.a.General.Class.TEXT_SELECT_DISABLED,o.a.General.Class.INPUT_GROUP,e.NAV),t.setAttribute("role","navigation"),t.addEventListener("pointerleave",()=>{var e;(null===(e=document.activeElement)||void 0===e?void 0:e.parentElement)===t&&document.activeElement.blur()});const s=(e,s)=>{e.classList.add(o.a.General.Class.CENTER_CONTENTS,o.a.General.Class.INPUT_GROUP_ITEM,s.cssClass),e.textContent=s.text,e.addEventListener("pointerenter",()=>{window.requestAnimationFrame(t=>{e.focus()})}),t.appendChild(e)};[{text:"Offline Single-player",cssClass:e.NAV_PLAY_OFFLINE,screenId:d.Id.SETUP_OFFLINE},{text:"Online Multi-player",cssClass:e.NAV_PLAY_ONLINE,screenId:d.Id.GROUP_JOINER},{text:"How To Play",cssClass:e.NAV_HOW_TO_PLAY,screenId:d.Id.HOW_TO_PLAY},{text:"How To Host",cssClass:e.NAV_HOW_TO_HOST,screenId:d.Id.HOW_TO_HOST},{text:"Colour Schemes",cssClass:e.NAV_COLOURS,screenId:d.Id.COLOUR_CTRL}].map(e=>Object.freeze(e)).forEach(e=>{const t=document.createElement("button");t.onclick=e.screenId instanceof Function?e.screenId:()=>{this.requestGoToScreen(e.screenId,{})},s(t,e)}),[{text:"Visit\nRepo",cssClass:e.NAV_VIEW_REPO,href:new window.URL("https://github.com/david-fong/SnaKey-NTS")},{text:"Report\nIssue",cssClass:e.NAV_RPT_ISSUE,href:new window.URL("https://github.com/david-fong/SnaKey-NTS/issues")}].map(e=>Object.freeze(e)).forEach(e=>{const t=document.createElement("a");t.href=e.href.toString(),t.referrerPolicy="strict-origin-when-cross-origin",t.rel="noopener",t.target="_blank",s(t,e)}),this.baseElem.appendChild(t)}}Object.freeze(u),Object.freeze(u.prototype);class h extends d{_lazyLoad(){}}Object.freeze(h),Object.freeze(h.prototype);class p extends d{_lazyLoad(){}}var E,m,O,_,b,f;(p||(p={})).INSTRUCTIONS_STEPS=Object.freeze(["$ npm install 'https://github.com/david-fong/SnaKey-NTS#gh-pages'","$ npm run start","send the url to your friends"]),Object.freeze(p),Object.freeze(p.prototype);class v{constructor(){E.set(this,void 0),m.set(this,void 0),O.set(this,void 0);const e=document.createElement("div");e.tabIndex=0,e.classList.add(o.a.SkPickOne.Class.BASE),e.addEventListener("keydown",this._onKeyDown.bind(this)),e.setAttribute("role","listbox"),e.addEventListener("pointerenter",t=>{window.requestAnimationFrame(t=>{e.focus()})}),this.baseElem=e,this.options=[]}addOption(e){this.options.push(e),this.baseElem.appendChild(e.baseElem),e.baseElem.addEventListener("pointerenter",this.hoverOpt.bind(this,e)),e.baseElem.addEventListener("click",this.selectOpt.bind(this,e,!0)),e._registerParent(this._onOptDisabledChange.bind(this))}hoverOpt(e){var t;this.hoveredOpt!==e&&(null===(t=this.hoveredOpt)||void 0===t||t.baseElem.setAttribute("aria-active-descendant","false"),Object(i.c)(this,m,e),this.hoveredOpt.baseElem.setAttribute("aria-active-descendant","true"))}selectOpt(e,t=!0){var s;if(!e)throw Error("opt must be defined");this.hoverOpt(e),this.confirmedOpt!==e&&(null===(s=this.confirmedOpt)||void 0===s||s.baseElem.setAttribute("aria-selected","false"),Object(i.c)(this,E,e),this.confirmedOpt.baseElem.setAttribute("aria-selected","true"),t&&this._onSelectOpt(e))}get confirmedOpt(){return Object(i.b)(this,E)}get hoveredOpt(){return Object(i.b)(this,m)}_onOptDisabledChange(e){this.confirmedOpt===e&&(this._isValid=!e.disabled)}set _isValid(e){this._isValid!==e&&(this.baseElem.setAttribute("aria-invalid",e?"false":"true"),Object(i.c)(this,O,e))}get _isValid(){return Object(i.b)(this,O)}_onKeyDown(e){if(" "===e.key||"Enter"===e.key)return this.selectOpt(this.hoveredOpt),e.preventDefault(),!1;{const t=this.options.indexOf(this.hoveredOpt);if("ArrowDown"===e.key||"Down"===e.key)for(let s=t+1;s<this.options.length;s++){const t=this.options[s];if(!t.disabled)return this.hoverOpt(t),e.preventDefault(),!1}else if("ArrowUp"===e.key||"Up"===e.key)for(let s=t-1;s>=0;s--){const t=this.options[s];if(!t.disabled)return this.hoverOpt(t),e.preventDefault(),!1}}return!0}}E=new WeakMap,m=new WeakMap,O=new WeakMap,_=v||(v={}),b=new WeakMap,f=new WeakMap,_._Option=class{constructor(){b.set(this,void 0),f.set(this,void 0);const e=this.baseElem=document.createElement("div");e.classList.add(o.a.SkPickOne.Class.OPT_BASE),e.setAttribute("role","option"),Object(i.c)(this,b,!1)}_registerParent(e){Object(i.c)(this,f,e)}get disabled(){return Object(i.b)(this,b)}set disabled(e){this.disabled!==e&&(this.baseElem.setAttribute("aria-disabled",e?"true":"false"),Object(i.c)(this,b,e),Object(i.b)(this,f).call(this,this))}},Object.freeze(_),Object.freeze(_.prototype),Object.freeze(v),Object.freeze(v.prototype),s(6);const g=o.a.Screen.Impl.ColourCtrl.Class;o.a.General.Class;class S extends d{constructor(){super(...arguments),this.canBeInitialScreen=!0}_lazyLoad(){const e=new S.PickOne;this.baseElem.appendChild(e.baseElem),this.sel=e;const t=localStorage.getItem(n.LocalKeys.COLOUR_ID);t&&this.sel.selectOpt(this.sel.getOptById(t),!1)}}var L;!function(e){class t extends v{constructor(){var e;super(),this.baseElem.classList.add(g.BASE),this.garageDoorElem=document.getElementById(o.a.Screen.Id.SCREEN_TINT),this.garageDoorElem.style.transitionDuration=L.SMOOTH_CHANGE_DURATION/3+"ms",L.Schemes.forEach(e=>{this.addOption(new t.Option(e))}),this.selectOpt(this.getOptById(null!==(e=localStorage.getItem(n.LocalKeys.COLOUR_ID))&&void 0!==e?e:"snakey"),!1)}_onHoverOpt(e){}_onSelectOpt(e){{const e=document.documentElement.style;for(const t of L.Swatch){const s="--colour-"+t;e.setProperty(s,"")}}localStorage.setItem(n.LocalKeys.COLOUR_ID,e.desc.id),localStorage.setItem(n.LocalKeys.COLOUR_LITERAL,e.cssLiteral);const t=L.SMOOTH_CHANGE_DURATION/3,s=this.garageDoorElem.style;s.opacity="1.0",s.pointerEvents="all",this.baseElem.style.pointerEvents="none",setTimeout(()=>{document.documentElement.dataset[o.a.General.Dataset.COLOUR_SCHEME]=e.desc.id,setTimeout(()=>{s.opacity="0.0",s.pointerEvents="",this.baseElem.style.pointerEvents=""},t)},t)}getOptById(e){return this.options.find(t=>t.desc.id===e)}}e.PickOne=t,function(e){class t extends v._Option{constructor(e){super(),this.desc=e,this.baseElem.classList.add(g.OPTION);const s=document.createElement("span");s.classList.add(g.OPTION_LABEL),s.textContent=e.displayName,this.baseElem.appendChild(s);const n=document.createElement("span");n.classList.add(g.OPTION_PREVIEW),n.dataset[o.a.General.Dataset.COLOUR_SCHEME]=e.id;for(let e=0;e<t.NUM_PREVIEW_SLOTS;e++)n.appendChild(document.createElement("span"));document.body.appendChild(n);let a="";const r=window.getComputedStyle(n);for(const e of L.Swatch){const t="--colour-"+e;a+=t+":"+r.getPropertyValue(t)+";"}this.cssLiteral=a,this.baseElem.appendChild(n)}}e.Option=t,function(e){e.NUM_PREVIEW_SLOTS=5}(t=e.Option||(e.Option={})),Object.freeze(t),Object.freeze(t.prototype)}(t=e.PickOne||(e.PickOne={})),Object.freeze(t),Object.freeze(t.prototype)}(S||(S={})),Object.freeze(S),Object.freeze(S.prototype),function(e){e.Swatch=Object.freeze(["mainFg","mainBg","tileFg","tileBg","tileBd","healthFg","healthBg","pFaceMe","pFaceMeOppo","pFaceTeammate","pFaceImtlTeammate","pFaceOpponent","pFaceImtlOpponent"]),e.Schemes=Object.freeze([{id:"snakey",displayName:"Snakey",author:"N.W."},{id:"smooth-stone",displayName:"Smooth Stone",author:"Dav"},{id:"murky-dive",displayName:"Murky Dive",author:"Stressed Dav"}].map(e=>Object.freeze(e))),e.SMOOTH_CHANGE_DURATION=2e3}(L||(L={})),Object.freeze(L);var N=s(4);const I=o.a.Screen.Impl.Setup.Class;class T extends d{_lazyLoad(){this.baseElem.classList.add(I.BASE),this.baseElem.appendChild(this.nav.prev),this.langSel=new T.LangPickOne,this.baseElem.appendChild(this.langSel.baseElem),this._createLangWeightExaggerationInput(),this.baseElem.appendChild(this.nav.next),this._loadLastUsedPreset()}_createLangWeightExaggerationInput(){const e=this.langWeightExaggeration=document.createElement("input");e.classList.add(I.LANG_WEIGHT_EXAGG),e.type="range",e.min="0",e.max=c.a.WeightExaggeration.MAX.toString(),e.step="any",e.value="1";{const e=document.createElement("datalist");e.id=o.a.Screen.Impl.Setup.Id.LANG_WEIGHT_EXAGGERATION_LIST,[{val:0,label:"0"},{val:1,label:"1"}].forEach(t=>{const s=document.createElement("option");s.value=t.val.toString(),s.label=t.label,e.appendChild(s)}),this.baseElem.appendChild(e)}e.setAttribute("list",o.a.Screen.Impl.Setup.Id.LANG_WEIGHT_EXAGGERATION_LIST),this.baseElem.appendChild(e)}_abstractOnBeforeEnter(e,t){return Object(i.a)(this,void 0,void 0,(function*(){window.setTimeout(()=>{this.nav.next.focus()},100)}))}_loadLastUsedPreset(){localStorage.getItem(n.LocalKeys.GAME_PRESET)}_parseArgsFromGui(){const e=Object.assign({},T.DEFAULT_PRESET);return e.langId=this.langSel.confirmedOpt.desc.id,e.langWeightExaggeration=parseFloat(this.langWeightExaggeration.value),e}}!function(e){e.DEFAULT_PRESET={coordSys:N.a.System.EUCLID2,gridDimensions:{height:21,width:21},averageFreeHealthPerTile:1/45,langWeightExaggeration:1,langId:"engl-low",playerDescs:[{isALocalOperator:!1,familyId:"CHASER",teamId:1,socketId:void 0,username:"chaser1",avatar:void 0,noCheckGameOver:!0,familyArgs:{}},{isALocalOperator:!1,familyId:"CHASER",teamId:1,socketId:void 0,username:"chaser2",avatar:void 0,noCheckGameOver:!0,familyArgs:{fearDistance:6,bloodThirstDistance:5,healthReserve:5,keyPressesPerSecond:1.8}}]};class t extends v{constructor(){super(),this.baseElem.classList.add(I.LANG_SEL),c.a.FrontendDescs.forEach(e=>{this.addOption(new t.Option(e))}),this.selectOpt(this.options[0])}_onHoverOpt(e){}_onSelectOpt(e){}}e.LangPickOne=t,function(e){class t extends v._Option{constructor(e){super(),this.desc=e,this.baseElem.textContent=e.displayName}}e.Option=t,Object.freeze(t),Object.freeze(t.prototype)}(t=e.LangPickOne||(e.LangPickOne={}))}(T||(T={})),Object.freeze(T),Object.freeze(T.prototype);class A extends T{_lazyLoad(){super._lazyLoad(),this.nav.next.onclick=e=>{const t=this._parseArgsFromGui();this.requestGoToScreen(d.Id.PLAY_OFFLINE,t)}}_abstractOnBeforeEnter(e,t){return super._abstractOnBeforeEnter(e,t)}_parseArgsFromGui(){const e=super._parseArgsFromGui();return e.playerDescs.splice(e.playerDescs.length,0,{isALocalOperator:!0,familyId:"HUMAN",teamId:0,socketId:void 0,username:"hello1",avatar:void 0,noCheckGameOver:!1,familyArgs:{}},{isALocalOperator:!0,familyId:"HUMAN",teamId:1,socketId:void 0,username:"hello2",avatar:void 0,noCheckGameOver:!1,familyArgs:{}}),e}}Object.freeze(A),Object.freeze(A.prototype);var C,y,R,P,G,U,k=s(3);class j extends d{constructor(){super(...arguments),C.set(this,void 0),y.set(this,void 0),R.set(this,void 0),P.set(this,void 0)}_lazyLoad(){this.baseElem.classList.add(o.a.General.Class.CENTER_CONTENTS,o.a.Screen.Impl.Play.Class.BASE);const e=j.createCenterColElem();this._gridBaseElem=e.grid,this._gridImplHost=e.implHost,this._gridImplHost.appendChild(document.createComment("grid impl host")),this.baseElem.appendChild(e.top),e.pauseOl.addEventListener("click",e=>{const t=this.currentGame;t&&t.status===k.a.Status.PAUSED&&this._statusBecomePlaying()}),this._initializeControlsBar(),this._initializePlayersBar(),Object(i.c)(this,y,()=>{if(this.wantsAutoPause)if(document.hidden){if(void 0===Object(i.b)(this,P)){const e=this.currentGame;(!e||e&&e.status!==k.a.Status.OVER)&&this._statusBecomePaused()}}else"page-hide"===Object(i.b)(this,P)&&this._statusBecomePlaying()}),Object(i.c)(this,R,this._gridKeyDownCallback.bind(this))}_abstractOnBeforeEnter(e,t){return Object(i.a)(this,void 0,void 0,(function*(){document.addEventListener("visibilitychange",Object(i.b)(this,y)),this.pauseButton.disabled=!0,this._statusBecomePaused(),Object(i.c)(this,C,yield this._createNewGame(t)),this._gridBaseElem.addEventListener("keydown",Object(i.b)(this,R),{capture:!0}),yield this.currentGame.reset();const e=this.currentGame.htmlElements;this._gridImplHost.appendChild(e.gridImpl),this.playersBar.appendChild(e.playersBar),this.pauseButton.onclick=this._statusBecomePlaying.bind(this),this.pauseButton.disabled=!1,this.wantsAutoPause&&setTimeout(()=>{document.hidden||this._statusBecomePlaying()},500)}))}_abstractOnBeforeLeave(e){if(this.askConfirmBeforeLeave&&!window.confirm("Are you sure you would like to leave?"))return!1;document.removeEventListener("visibilitychange",Object(i.b)(this,y));const t=this.currentGame;t.statusBecomePaused();for(const e of Object.values(t.htmlElements))e.textContent="",e.remove();return this._gridBaseElem.removeEventListener("keydown",Object(i.b)(this,R)),Object(i.c)(this,C,void 0),!0}get currentGame(){return Object(i.b)(this,C)}_gridKeyDownCallback(e){e.stopPropagation();const t=this.currentGame;if(e.ctrlKey&&" "===e.key&&!e.repeat){const e=t.operators;t.setCurrentOperator((1+e.indexOf(t.currentOperator))%e.length)}else t.currentOperator.processKeyboardInput(e);return" "!==e.key||(e.preventDefault(),!1)}_statusBecomePlaying(){var e;const t=o.a.Grid.Dataset.GAME_STATE;null===(e=this.currentGame)||void 0===e||e.statusBecomePlaying(),this.pauseButton.textContent="Pause",Object(i.c)(this,P,void 0),this._gridBaseElem.dataset[t.KEY]=t.VALUES.PLAYING,this.pauseButton.onclick=this._statusBecomePaused.bind(this),this.resetButton.disabled=!0,window.requestAnimationFrame(e=>{this._gridBaseElem.focus()})}_statusBecomePaused(){var e;const t=o.a.Grid.Dataset.GAME_STATE;null===(e=this.currentGame)||void 0===e||e.statusBecomePaused(),this.pauseButton.textContent="Unpause",Object(i.c)(this,P,document.hidden?"page-hide":"other"),this._gridBaseElem.dataset[t.KEY]=t.VALUES.PAUSED,this.pauseButton.onclick=this._statusBecomePlaying.bind(this),this.resetButton.disabled=!1}_onGameBecomeOver(){const e=o.a.Grid.Dataset.GAME_STATE;this.pauseButton.disabled=!0,this.resetButton.disabled=!1,this._gridBaseElem.dataset[e.KEY]=e.VALUES.OVER}_resetGame(){this.currentGame.reset(),this.pauseButton.disabled=!1,this.wantsAutoPause&&this._statusBecomePlaying()}_initializeControlsBar(){const e=document.createElement("div");function t(t,s){return(s=null!=s?s:document.createElement("button")).textContent=t,s.classList.add(o.a.General.Class.INPUT_GROUP_ITEM),s.addEventListener("pointerenter",e=>{window.requestAnimationFrame(e=>{s.focus()})}),e.appendChild(s),s}e.classList.add(o.a.General.Class.CENTER_CONTENTS,o.a.General.Class.INPUT_GROUP,o.a.Screen.Impl.Play.Class.CONTROLS_BAR),e.setAttribute("role","menu"),e.addEventListener("pointerleave",e=>{window.requestAnimationFrame(e=>{this._gridBaseElem.focus()})});t("<Back Button Text>",this.nav.prev);this.pauseButton=t("");(this.resetButton=t("Reset")).onclick=this._resetGame.bind(this);this.baseElem.appendChild(e)}_initializePlayersBar(){const e=this.playersBar=document.createElement("div");e.classList.add(o.a.Screen.Impl.Play.Class.PLAYERS_BAR),this.baseElem.appendChild(e)}}C=new WeakMap,y=new WeakMap,R=new WeakMap,P=new WeakMap,(j||(j={})).createCenterColElem=function(){const e=o.a.Grid.Class,t=o.a.General.Class,s=document.createElement("div");s.classList.add(o.a.Screen.Impl.Play.Class.GRID_WRAPPER);const n=document.createElement("div");n.tabIndex=0,n.setAttribute("role","textbox"),n.setAttribute("aria-label","Game Grid"),n.classList.add(t.STACK_CONTENTS,t.TEXT_SELECT_DISABLED,e.GRID);const a=document.createElement("div");a.setAttribute("role","presentation"),a.classList.add(e.SCROLL_OUTER);{const s=document.createElement("div");s.classList.add(t.FILL_PARENT,t.CENTER_CONTENTS,e.KBD_DC);{const t=document.createElement("div");t.classList.add(e.KBD_DC_ICON),t.textContent="(click here to continue typing)",s.appendChild(t)}a.appendChild(s)}const r=document.createElement("div");r.classList.add(t.FILL_PARENT,t.CENTER_CONTENTS,e.PAUSE_OL);{const t=document.createElement("div");t.classList.add(e.PAUSE_OL_ICON),t.textContent="(Click to Unpause)",r.appendChild(t)}return a.appendChild(r),n.appendChild(a),s.appendChild(n),Object.freeze({top:s,grid:n,intersectionRoot:a,implHost:a,pauseOl:r})},Object.freeze(j),Object.freeze(j.prototype);class w extends j{constructor(){super(...arguments),this.wantsAutoPause=!0,this.askConfirmBeforeLeave=!0}get initialScreen(){return d.Id.SETUP_OFFLINE}_lazyLoad(){super._lazyLoad(),this.nav.prev.innerHTML="Return To&nbsp;Setup"}_createNewGame(e){return Object(i.a)(this,void 0,void 0,(function*(){return new((yield Promise.all([s.e(0),s.e(1)]).then(s.bind(null,27))).OfflineGame)(this._onGameBecomeOver.bind(this),e)}))}}Object.freeze(w),Object.freeze(w.prototype);class B{}!function(e){let t;e.PROTOCOL="http://",e.DEFAULT_PORT=8080,function(e){e.GROUP_LOBBY_PREFIX="/group-",e.GROUP_JOINER="/joiner"}(t=e.Nsps||(e.Nsps={}))}(B||(B={})),Object.freeze(B),Object.freeze(B.prototype);class H{}!function(e){let t,s,n,a;!function(e){let t;!function(e){e.EVENT_NAME="group-lobby-user-info-change"}(t=e.UserInfoChange||(e.UserInfoChange={}))}(t=e.Socket||(e.Socket={})),function(e){e.REGEXP=/(?:[a-zA-Z0-9:-]+)/,e.MaxLength=30}(s=e.Name||(e.Name={})),function(e){e.REGEXP=/(?:[a-zA-Z0-9:-]+)/,e.MaxLength=30}(n=e.Passphrase||(e.Passphrase={})),e.JoinerReconnectionAttempts=2,e.DEFAULT_TTL=20,function(e){e.EVENT_NAME="group-exist";class t{constructor(e,t){this.groupName=e,this.passphrase=t}}let s;e.RequestCreate=t,function(e){let t;!function(e){e.OKAY="okay",e.NOPE="nope"}(t=e.Response||(e.Response={}))}(t=e.RequestCreate||(e.RequestCreate={})),function(e){e.IN_LOBBY="in-lobby",e.IN_GAME="in-game",e.DELETE="delete"}(s=e.Status||(e.Status={}))}(a=e.Exist||(e.Exist={}))}(H||(H={})),Object.freeze(H),Object.freeze(H.prototype);class D extends d{constructor(){super(...arguments),G.set(this,void 0),U.set(this,!1)}get clientIsGroupHost(){return Object(i.b)(this,U)}_lazyLoad(){this.baseElem.classList.add(o.a.General.Class.CENTER_CONTENTS,o.a.Screen.Impl.GroupJoiner.Class.BASE);const e=this._initializeFormContents(),t=this._initializeHostUrlHandlers();this._initializeGroupNameHandlers(t),this._initializePassphraseHandlers(),this.nav.next.onclick=e=>{s()};const s=()=>{this.requestGoToScreen(d.Id.GROUP_LOBBY,{})};this._setFormState(M.CHOOSING_HOST),this.baseElem.appendChild(e)}_abstractOnBeforeEnter(e,t){return Object(i.a)(this,void 0,void 0,(function*(){window.setTimeout(()=>{this.socket&&this.socket.nsp.startsWith(B.Nsps.GROUP_LOBBY_PREFIX)?this.in.groupName.focus():this.in.hostUrl.focus()},100)}))}get state(){return Object(i.b)(this,G)}_setFormState(e){if(this.state!==e){if(e===M.IN_GROUP){if(this.state!==M.CHOOSING_GROUP)throw"never";this.in.passphrase.disabled=!0,this.nav.next.disabled=!1,this.nav.next.focus()}else this.nav.next.disabled=!0,e===M.CHOOSING_HOST?(this.in.groupName.disabled=!0,this.in.groupName.value="",this.groupNameDataList.innerText="",this.in.passphrase.disabled=!0,this.in.passphrase.value="",this.in.hostUrl.focus()):e===M.CHOOSING_GROUP&&(this.in.groupName.disabled=!1,this.in.passphrase.disabled=!1,this.in.groupName.focus());Object(i.c)(this,G,e)}}_initializeHostUrlHandlers(){const e=this.top,t=this.in.hostUrl,s=()=>Object(i.a)(this,void 0,void 0,(function*(){var s;if(!t.value||!t.validity.valid)return;t.value.startsWith(B.PROTOCOL)||(t.value=new window.URL(B.PROTOCOL+t.value).origin);const n=new window.URL(t.value+B.Nsps.GROUP_JOINER);if(this.socket&&this.socket.nsp===B.Nsps.GROUP_JOINER&&this.socket.io.opts.hostname===n.hostname)return this.socket.connected?(this._setFormState(M.CHOOSING_GROUP),void this.in.groupName.focus()):void 0;null===(s=this.socket)||void 0===s||s.close(),this.socket=(yield e.socketIo)(n.toString(),{reconnectionAttempts:H.JoinerReconnectionAttempts}),this.socket.on("connect",()=>{this._setFormState(M.CHOOSING_GROUP),this.socket.on(H.Exist.EVENT_NAME,this._onNotifyGroupExist.bind(this))}),this.socket.on("connect_error",e=>{this.socket=void 0,this.top.toast("Unable to connected to the specified server.")}),this.socket.on("disconnect",s=>{"io server disconnect"===s&&(this.socket=void 0,this._setFormState(M.CHOOSING_HOST),t.value="",e.toast("The server disconnected you from the group joiner."))})}));return t.oninput=e=>this._setFormState(M.CHOOSING_HOST),t.onkeydown=e=>{"Enter"===e.key&&s()},t.onpaste=e=>{window.setTimeout(()=>s(),0)},t.onchange=()=>{s()},s}_onNotifyGroupExist(e){if(e===H.Exist.RequestCreate.Response.NOPE)return void this.top.toast(`The server rejected your request to create a new group "${this.in.groupName.value}".`);if(e===H.Exist.RequestCreate.Response.OKAY)return this.top.toast(`server accepted request to create new group "${this.in.groupName.value}".`),this.top.toast("connecting to new group..."),void this._attemptToJoinExistingGroup();const t=this.groupNameDataList,s=Array.from(t.children);Object.entries(e).forEach(([e,n])=>{const a=s.find(t=>t.value===e)||(e=>{const n=document.createElement("option");n.value=e;for(const e of s)if(n.value.localeCompare(e.value)<0){t.insertBefore(n,e);break}return n.parentElement||t.appendChild(n),n})(e);switch(n){case H.Exist.Status.IN_LOBBY:a.textContent="In Lobby";break;case H.Exist.Status.IN_GAME:a.textContent="In Game";break;case H.Exist.Status.DELETE:a.remove()}})}_initializeGroupNameHandlers(e){const t=this.in.groupName,s=()=>{t.value&&t.validity.valid&&(this.state===M.IN_GROUP?this.nav.next.focus():this.in.passphrase.focus())};this.in.groupName.oninput=t=>Object(i.a)(this,void 0,void 0,(function*(){this.state===M.IN_GROUP&&(yield e()),this.in.passphrase.value="",Object(i.c)(this,U,!1)})),t.onkeydown=e=>{"Enter"===e.key&&s()},t.onchange=e=>{s()}}_initializePassphraseHandlers(){const e=()=>Object(i.a)(this,void 0,void 0,(function*(){if(!this.in.passphrase.validity.valid)return;if(this.socket.nsp===B.Nsps.GROUP_LOBBY_PREFIX+this.in.groupName.value)return this.socket.connected?(this._setFormState(M.IN_GROUP),void this.nav.next.focus()):void 0;Array.from(this.groupNameDataList.children).some(e=>e.value===this.in.groupName.value)?(Object(i.c)(this,U,!1),yield this._attemptToJoinExistingGroup()):(Object(i.c)(this,U,!0),this.socket.emit(H.Exist.EVENT_NAME,new H.Exist.RequestCreate(this.in.groupName.value,this.in.passphrase.value)))}));this.in.passphrase.onkeydown=t=>{"Enter"===t.key&&e()}}_attemptToJoinExistingGroup(){var e;return Object(i.a)(this,void 0,void 0,(function*(){const t=(()=>{const e=new window.URL(this.in.hostUrl.value);return e.pathname=B.Nsps.GROUP_LOBBY_PREFIX+this.in.groupName.value,e.toString()})();null===(e=this.socket)||void 0===e||e.close();const s=this.top,a=n.getLastUserInfo();this.socket=(yield s.socketIo)(t,{query:{passphrase:this.in.passphrase.value,userInfo:a}}),this.socket.on("connect",()=>{this._setFormState(M.IN_GROUP)}),this.socket.on("connect_error",e=>{this.socket=void 0,s.toast("Unable to connect to the specified group.")}),this.socket.on("disconnect",e=>{"io server disconnect"===e&&(this.socket=void 0,s.toast("The server disconnected you from your group."),this.requestGoToScreen(d.Id.GROUP_JOINER,{},d.NavDir.BACKWARD))})}))}get socket(){return this.top.socket}set socket(e){this.top.socket=e}_initializeFormContents(){this.in={};const e=o.a.Screen.Impl.GroupJoiner.Class,t=document.createElement("div");function s(e,s){const n=document.createElement("input");n.classList.add(o.a.General.Class.INPUT_GROUP_ITEM,s),n.type="text",n.autocomplete="off",n.spellcheck=!1;const a=document.createElement("label");return a.textContent=e,a.appendChild(n),t.appendChild(a),n}t.classList.add(o.a.General.Class.INPUT_GROUP,e.CONTENT_WRAPPER),this.nav.prev.classList.add(o.a.General.Class.INPUT_GROUP_ITEM),t.appendChild(this.nav.prev);{const t=this.in.hostUrl=Object.assign(s("Host URL",e.HOST_URL),{type:"url",maxLength:128,autocomplete:"on",required:!0}),n=D.SUGGEST_HOST(this.top.webpageHostType);if(n){const e=document.createElement("option");e.value=n.value,e.textContent=n.description,document.getElementById(o.a.GLOBAL_IDS.PUBLIC_GAME_HOST_URLS).insertAdjacentElement("afterbegin",e)}t.setAttribute("list",o.a.GLOBAL_IDS.PUBLIC_GAME_HOST_URLS)}{const t=this.in.groupName=Object.assign(s("Group Name",e.GROUP_NAME),{pattern:H.Name.REGEXP.source,minLength:1,maxLength:H.Name.MaxLength,autocomplete:"on",required:!0}),n=this.groupNameDataList=document.createElement("datalist");n.id=o.a.GLOBAL_IDS.CURRENT_HOST_GROUPS,this.baseElem.appendChild(n),t.setAttribute("list",n.id)}{const t=this.in.passphrase=s("Group Passphrase",e.PASSPHRASE);t.pattern=H.Passphrase.REGEXP.source,t.maxLength=H.Passphrase.MaxLength}return this.nav.next.classList.add(o.a.General.Class.INPUT_GROUP_ITEM),t.appendChild(this.nav.next),Object.freeze(this.in),t}}G=new WeakMap,U=new WeakMap,function(e){let t;!function(e){e.CHOOSING_HOST="choosing-host",e.CHOOSING_GROUP="choosing-group",e.IN_GROUP="in-group"}(t=e.State||(e.State={})),e.SUGGEST_HOST=function(e){switch(e){case"github":return;case"filesystem":return{value:"localhost:"+B.DEFAULT_PORT,description:"dev shortcut :)"};case"sk-server":return{value:window.location.origin,description:"this page's server"};default:return}}}(D||(D={}));const M=D.State;Object.freeze(D),Object.freeze(D.prototype);class x extends T{get initialScreen(){return d.Id.GROUP_JOINER}_lazyLoad(){super._lazyLoad(),this.nav.next.textContent="Start Game",this.nav.next.onclick=e=>{const t=this._parseArgsFromGui();this.top.clientIsGroupHost&&this.top.socket.emit(k.a.CtorArgs.Event.NAME,t)}}_abstractOnBeforeEnter(e,t){return super._abstractOnBeforeEnter(e,t)}}Object.freeze(x),Object.freeze(x.prototype);const z=o.a.Screen.Impl.GroupLobby.Class;class F extends d{get initialScreen(){return d.Id.GROUP_JOINER}_lazyLoad(){this._players={},this._createInputs(),this.nav.prev.textContent="Return To Joiner",this.teamsElem=document.createElement("div"),this.teamsElem.classList.add(z.SEC_TEAMS),this.baseElem.appendChild(this.teamsElem),this.teamElems={};{const e=this.nav.next;e.textContent="Setup Game",e.onclick=()=>{this.requestGoToScreen(d.Id.SETUP_ONLINE,{})},this.baseElem.appendChild(e)}}_createInputs(){var e;const t=document.createElement("div");t.classList.add(o.a.General.Class.INPUT_GROUP,z.SEC_CLIENT_INFO);const s=Object.assign(document.createElement("input"),{type:"text",minLength:1,maxLength:c.b.Username.MAX_LENGTH,pattern:c.b.Username.REGEXP.source,value:null!==(e=localStorage.getItem(n.LocalKeys.USERNAME))&&void 0!==e?e:"",onchange:this._submitInputs.bind(this)});s.classList.add(o.a.General.Class.INPUT_GROUP_ITEM),t.appendChild(s);const a=Object.assign(document.createElement("input"),{type:"number",min:"0",max:"0",step:"1",value:"0",onchange:this._submitInputs.bind(this)});a.classList.add(o.a.General.Class.INPUT_GROUP_ITEM),t.appendChild(a);const r=document.createElement("select");this.in=Object.freeze({username:s,teamId:a,avatar:r}),this.baseElem.appendChild(t)}_submitInputs(){this.in.username.validity.valid&&this.in.teamId.validity.valid&&(localStorage.setItem(n.LocalKeys.USERNAME,this.in.username.value),localStorage.setItem(n.LocalKeys.AVATAR,this.in.avatar.value),this.top.socket.emit(H.Socket.UserInfoChange.EVENT_NAME,{username:this.in.username.value,teamId:parseInt(this.in.teamId.value),avatar:c.b.Avatar.LOREM_IPSUM}))}_abstractOnBeforeEnter(e,t){return Object(i.a)(this,void 0,void 0,(function*(){"forward"===e&&(this.nav.next.disabled=!this.top.clientIsGroupHost,this.teamsElem.textContent="",this._submitInputs(),this.top.socket.on(H.Socket.UserInfoChange.EVENT_NAME,this._onUserInfoChange.bind(this)),this.top.socket.once(k.a.CtorArgs.Event.NAME,e=>Object(i.a)(this,void 0,void 0,(function*(){this.requestGoToScreen(d.Id.PLAY_ONLINE,e)}))))}))}_abstractOnBeforeLeave(e){return e===d.NavDir.BACKWARD&&this.top.socket.removeListener(k.a.CtorArgs.Event.NAME),!0}_onUserInfoChange(e){Object.entries(e).forEach(([e,t])=>{const s=this._players[e];if(!s||1!==this.teamElems[s.teamId].childElementCount||void 0!==t&&t.teamId===s.teamId||(this.teamElems[s.teamId].remove(),delete this.teamElems[s.teamId]),t&&void 0===this.teamElems[t.teamId]){const e=this.teamElems[t.teamId]=document.createElement("div");e.classList.add(z.TEAM),e.onclick=e=>{this.in.teamId.value=t.teamId.toString()},this.teamsElem.appendChild(e)}if(void 0===t)s.base.remove(),delete this._players[e];else if(void 0===s){const s=this._players[e]=new F.UserInfo(t);this.teamElems[t.teamId].appendChild(s.base)}else s.update(t)}),this.in.teamId.max=Object.keys(this._players).length.toString()}}var W,V,Y,K,q,J,X;W=F||(F={}),V=new WeakMap,Y=new WeakMap,K=new WeakMap,W.UserInfo=class{constructor(e){V.set(this,void 0),Y.set(this,void 0),K.set(this,void 0),this.base=document.createElement("div"),this.base.classList.add(z.PLAYER);const t=()=>{const e=document.createElement("div");return this.base.appendChild(e),e};this.el=Object.freeze({username:t(),teamId:t(),avatar:t()}),this.el.username.classList.add(z.PLAYER_NAME),this.username=e.username,this.teamId=e.teamId}update(e){this.username=e.username,this.teamId=e.teamId,this.avatar=e.avatar}get username(){return Object(i.b)(this,V)}set username(e){this.el.username.textContent=e,Object(i.c)(this,V,e)}get teamId(){return Object(i.b)(this,Y)}set teamId(e){this.el.teamId.textContent=e.toString(),Object(i.c)(this,Y,e)}get avatar(){return Object(i.b)(this,K)}set avatar(e){Object(i.c)(this,K,e),this.el.avatar}},Object.freeze(F),Object.freeze(F.prototype);class $ extends j{constructor(){super(...arguments),this.askConfirmBeforeLeave=!1,this.wantsAutoPause=!1}get initialScreen(){return d.Id.GROUP_JOINER}getNavPrevArgs(){return[d.Id.GROUP_LOBBY,{},d.NavDir.BACKWARD]}_lazyLoad(){super._lazyLoad(),this.nav.prev.innerHTML="Return To&nbsp;Lobby"}_abstractOnBeforeEnter(e,t){const s=Object.create(null,{_abstractOnBeforeEnter:{get:()=>super._abstractOnBeforeEnter}});return Object(i.a)(this,void 0,void 0,(function*(){return this.nav.prev.onclick=e=>{this.top.clientIsGroupHost&&this.top.socket.emit(k.a.CtorArgs.Event.NAME,k.a.CtorArgs.Event.RETURN_TO_LOBBY_INDICATOR)},s._abstractOnBeforeEnter.call(this,e,t)}))}_createNewGame(e){return Object(i.a)(this,void 0,void 0,(function*(){const t=new((yield Promise.all([s.e(0),s.e(2)]).then(s.bind(null,26))).OnlineGame)(this._onGameBecomeOver.bind(this),this.top.socket,e);return this.top.socket.on(k.a.CtorArgs.EVENT_NAME_SERVER_APPROVE_UNPAUSE,()=>{this._statusBecomePlaying()}),this.top.socket.on(k.a.CtorArgs.EVENT_NAME_SERVER_APPROVE_PAUSE,()=>{this._statusBecomePaused}),Promise.resolve(t)}))}}Object.freeze($),Object.freeze($.prototype);class Z{constructor(e,t){q.set(this,void 0),t.setAttribute("role","presentation");const s=d.Id,n=e,a=t,r=this.goToScreen.bind(this);this.dict=Object.freeze({[s.HOME]:new u(s.HOME,n,a,r),[s.HOW_TO_PLAY]:new h(s.HOW_TO_PLAY,n,a,r),[s.HOW_TO_HOST]:new p(s.HOW_TO_HOST,n,a,r),[s.COLOUR_CTRL]:new S(s.COLOUR_CTRL,n,a,r),[s.SETUP_OFFLINE]:new A(s.SETUP_OFFLINE,n,a,r),[s.PLAY_OFFLINE]:new w(s.PLAY_OFFLINE,n,a,r),[s.GROUP_JOINER]:new D(s.GROUP_JOINER,n,a,r),[s.SETUP_ONLINE]:new x(s.SETUP_ONLINE,n,a,r),[s.GROUP_LOBBY]:new F(s.GROUP_LOBBY,n,a,r),[s.PLAY_ONLINE]:new $(s.PLAY_ONLINE,n,a,r)});const i=window.location.hash.slice(1),o=this.dict[i];o&&o.initialScreen?this.goToScreen(o.initialScreen,{}):this.goToScreen(d.Id.HOME,{}),window.addEventListener("popstate",e=>{this.goToScreen(...this.currentScreen.getNavPrevArgs())})}goToScreen(e,t,s=d.NavDir.FORWARD){const n=this.dict[e];if(this.currentScreen===n)throw"never";return void 0!==this.currentScreen&&!this.currentScreen._leave(s)||(n._enter(s,t),Object(i.c)(this,q,n),!0)}get currentScreen(){return Object(i.b)(this,q)}}q=new WeakMap,Object.freeze(Z),Object.freeze(Z.prototype);class Q{constructor(){J.set(this,void 0),X.set(this,void 0),this.webpageHostType=window.location.origin.match(/github\.io/)?Q.WebpageHostType.GITHUB:window.location.protocol.startsWith("file")?Q.WebpageHostType.FILESYSTEM:Q.WebpageHostType.SNAKEY_SERVER,this.storage=n;const e=document.getElementById(o.a.Screen.Id.ALL_SCREENS);if(!e)throw Error();this.prependComment(e,"ALL SCREENS CONTAINER"),Object(i.c)(this,J,new Z(this,e)),console.log("%c🩺 welcome! 🐍","font:700 2.3em /1.5 monospace; margin:0.4em; border:0.3em solid black;padding:0.4em; color:white; background-color:#3f5e77; border-radius:0.7em; ")}get clientIsGroupHost(){return Object(i.b)(this,J).dict.groupJoiner.clientIsGroupHost}toast(e){console.info(e)}prependComment(e,t){e.parentNode.insertBefore(document.createComment(" "+t+" "),e)}get socketIo(){return(()=>{let e;return e||new Promise((e,t)=>{const s=document.createElement("script");s.onload=()=>{e(io)},s.src=document.getElementById("socket.io-preload").href,document.body.appendChild(s)})})()}get game(){var e;return null!==(e=Object(i.b)(this,J).dict.playOffline.currentGame)&&void 0!==e?e:Object(i.b)(this,J).dict.playOnline.currentGame}get currentScreen(){return Object(i.b)(this,J).currentScreen}}J=new WeakMap,X=new WeakMap,function(e){let t;!function(e){e.GITHUB="github",e.FILESYSTEM="filesystem",e.SNAKEY_SERVER="sk-server"}(t=e.WebpageHostType||(e.WebpageHostType={}))}(Q||(Q={})),Object.freeze(Q),Object.freeze(Q.prototype),s(5),Object.freeze(Object.prototype);const ee=new Q;function te(){return ee.currentScreen}function se(){return ee.game}ee.webpageHostType===Q.WebpageHostType.GITHUB&&"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/ServiceWorker.js").then(e=>{console.log("ServiceWorker registration successful with scope: ",e.scope)},e=>{console.log("ServiceWorker registration failed: ",e)})}))}]);
//# sourceMappingURL=index.js.map
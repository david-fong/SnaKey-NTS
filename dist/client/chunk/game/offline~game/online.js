(window.webpackJsonpsnakey3=window.webpackJsonpsnakey3||[]).push([[0],[,,,,,,,,function(e,t,s){"use strict";s.d(t,"b",(function(){return c.a})),s.d(t,"a",(function(){return l}));var r,i=s(10),a=s(0),o=s(1),n=s(16);class h extends o.b{constructor(e,t){if(super(),r.set(this,void 0),Math.trunc(t.playerId)!==t.playerId)throw RangeError("Player ID's must be integer values.");this.playerId=t.playerId,this.isALocalOperator=t.isALocalOperator,this.game=e,this.status=new this.game._playerStatusCtor(this,t.noCheckGameOver),this.tile=new n.a(new h.TileGetterSource(this))}_afterAllPlayersConstruction(){this.status._afterAllPlayersConstruction()}reset(e){Object(a.c)(this,r,e),this.hostTile._setOccupant(this.playerId,this.status.immigrantInfo)}get coord(){return this.hostTile.coord}get hostTile(){return Object(a.b)(this,r)}moveTo(e){if(this.hostTile.occupantId!==this.playerId){if("ONLINE"!==this.game.gameType)throw Error("Linkage between player and occupied tile disagrees.")}else this.hostTile.evictOccupant();if(e.isOccupied){if("ONLINE"!==this.game.gameType)throw Error("Only one player can occupy a tile at a time.")}else Object(a.c)(this,r,e),e._setOccupant(this.playerId,this.status.immigrantInfo)}}r=new WeakMap,function(e){var t,s;class r{constructor(e){t.set(this,void 0),s.set(this,void 0),Object(a.c)(this,t,e),Object(a.c)(this,s,e.game.grid.tile._source)}_getTileAt(){return Object(a.b)(this,s)._getTileAt(Object(a.b)(this,t).coord)}_getTileDestsFrom(){return Object(a.b)(this,s)._getTileDestsFrom(Object(a.b)(this,t).coord)}_getTileSourcesTo(){return Object(a.b)(this,s)._getTileSourcesTo(Object(a.b)(this,t).coord)}}t=new WeakMap,s=new WeakMap,e.TileGetterSource=r,Object.freeze(r),Object.freeze(r.prototype)}(h||(h={})),Object.freeze(h),Object.freeze(h.prototype);s(11);var c=s(12);class l extends h{constructor(e,t){var s;super(e,t),this.familyId=t.familyId,this.teamId=t.teamId,this.username=t.username,this.avatar=null!==(s=t.avatar)&&void 0!==s?s:l.Avatar.GET_RANDOM()}reset(e){super.reset(e),this.status.reset(),this.lastAcceptedRequestId=i.a.INITIAL_REQUEST_ID,this.requestInFlight=!1}_notifyGameNowPlaying(){}_notifyGameNowPaused(){}_notifyGameNowOver(){}makeMovementRequest(e,t){if("PLAYING"!==this.game.status)throw Error("This is not a necessary precondition, but we're doing it anyway.");if(this.requestInFlight)throw Error("Only one request should ever be in flight at a time.");this.requestInFlight=!0,this.game.processMoveRequest(new i.a.Movement(this.playerId,this.lastAcceptedRequestId,e,t))}get team(){return this.game.teams[this.teamId]}isTeamedWith(e){return this.team.members.includes(e)}}!function(e){let t;!function(e){e.finalize=function(e){const t=Array.from(new Set(e.map(e=>e.teamId))).sort((e,t)=>e-t).reduce((e,t,s)=>(e[t]=s,e),[]);return e.slice().sort((e,s)=>t[e.teamId]-t[s.teamId]).map((e,s)=>Object.assign({},e,{playerId:s,teamId:t[e.teamId]}))}}(t=e.CtorArgs||(e.CtorArgs={})),Object.freeze(t)}(l||(l={})),Object.freeze(l),Object.freeze(l.prototype)},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var r,i=s(1),a=s(0);!function(e){var t,s;class r{constructor(){this.children=[]}reset(){this.inheritingWeightedHitCount=0,this.children.forEach(e=>e.reset())}_finalize(){Object.freeze(this.children),this.children.forEach(e=>e._finalize())}_addCharMapping(e,t){if(!i.a.Seq.REGEXP.test(e))throw RangeError(`Mapping-sequence "${e}" did not match the required regular expression "${i.a.Seq.REGEXP.source}".`);if(0===t.length)throw"never";let s=this;{let t=this;for(;t;)s=t,t=t.children.find(t=>e.startsWith(t.sequence))}if(s.sequence===e)throw Error(`Mappings for all written-characters with a commoncorresponding typeable-sequence should be registered together,but an existing mapping for the sequence "${e}" was found.`);s.children.push(new n(s,e,t))}getLeafNodes(){const e=[];return this._recursiveGetLeafNodes(e),e}_recursiveGetLeafNodes(e){this.children.length?this.children.forEach(t=>{t._recursiveGetLeafNodes(e)}):e.push(this)}simpleView(){return this.children}static CREATE_TREE_MAP(e,t){const s=Object.values(e).reduce((e,t)=>e+t.weight,0),i=0===t?e=>1:1===t?e=>e:e=>Math.pow(e/s,t),a=new Map;for(const t in e){const s=e[t].seq,r=new o(t,i(e[t].weight)),n=a.get(s);n?n.push(r):a.set(s,[r])}const n=new r;return Array.from(a).sort((e,t)=>e[0].length-t[0].length).forEach(e=>{n._addCharMapping(...e)}),n._finalize(),n}}r.LEAF_CMP=(e,t)=>e.inheritingWeightedHitCount-t.inheritingWeightedHitCount,e.ParentNode=r,Object.freeze(r),Object.freeze(r.prototype);class n extends r{constructor(e,r,i){super(),t.set(this,void 0),s.set(this,void 0),this.sequence=r,Object(a.c)(this,s,i),Object(a.c)(this,t,e)}_finalize(){Object.freeze(Object(a.b)(this,s)),super._finalize()}reset(){super.reset(),Object(a.b)(this,s).forEach(e=>{e.reset(),this.incrementNumHits(e,Math.random()*i.a.CHAR_HIT_COUNT_SEED_CEILING)})}chooseOnePair(){const e=Object(a.b)(this,s).slice(0).sort(o.CMP).shift(),t={char:e.char,seq:this.sequence};return this.incrementNumHits(e),t}incrementNumHits(e,t=1){e._incrementNumHits(),this._recursiveIncrementNumHits(e.weightInv*t)}_recursiveIncrementNumHits(e){this.inheritingWeightedHitCount+=e,this.children.forEach(t=>t._recursiveIncrementNumHits(e))}get personalWeightedHitCount(){return this.inheritingWeightedHitCount-Object(a.b)(this,t).inheritingWeightedHitCount}andNonRootParents(){const e=[];for(let s=this;s instanceof n;s=Object(a.b)(s,t))e.push(s);return e}simpleView(){let e=Object(a.b)(this,s).map(e=>e.simpleView());return Object.assign(Object.create(null),{seq:this.sequence,chars:1===e.length?e[0]:e,kids:this.children.map(e=>e.simpleView())})}}t=new WeakMap,s=new WeakMap,n.PATH_CMP=(e,t)=>e.personalWeightedHitCount-t.personalWeightedHitCount,e.ChildNode=n,Object.freeze(n),Object.freeze(n.prototype)}(r||(r={})),Object.freeze(r);class o{constructor(e,t){if(t<=0)throw RangeError(`All weights must be positive, but we were passed the value "${t}" for the character "${e}".`);this.char=e,this.weightInv=1/t}reset(){this.hitCount=0,this.weightedHitCount=0}_incrementNumHits(){this.hitCount+=1,this.weightedHitCount+=this.weightInv}simpleView(){return Object.assign(Object.create(null),{char:this.char,hits:this.hitCount})}}o.CMP=(e,t)=>e.weightedHitCount-t.weightedHitCount,Object.freeze(o),Object.freeze(o.prototype);class n extends i.a{constructor(e,t,s){if(super(),this.frontendDesc=n.GET_FRONTEND_DESC_BY_ID(e),this.treeMap=r.ParentNode.CREATE_TREE_MAP(t,s),this.leafNodes=this.treeMap.getLeafNodes(),this.leafNodes.length!==this.frontendDesc.numLeaves)throw Error(`maintenance required: the frontend constant for the language "${this.frontendDesc.id}" needs to be updated to the correct, computed value, which is \`${this.leafNodes.length}\`.`)}get numLeaves(){return this.leafNodes.length}reset(){this.treeMap.reset()}getNonConflictingChar(e){this.leafNodes.sort(r.ParentNode.LEAF_CMP);let t=void 0;for(const s of this.leafNodes){const r=s.andNonRootParents();for(let t=0;t<r.length;t++){const s=e.find(e=>e.startsWith(r[t].sequence));if(s){s===r[t].sequence?r.length=0:r.splice(t);break}}if(r.length){t=r[0];for(const e of r)e.personalWeightedHitCount<t.personalWeightedHitCount&&(t=e);break}}if(!t)throw Error("Invariants guaranteeing that a LangSeq canalways be shuffled-in were not met.");return t.chooseOnePair()}simpleView(){return Object.assign(Object.create(null),{id:this.frontendDesc.id,displayName:this.frontendDesc.displayName,root:this.treeMap.simpleView(),numLeaves:this.leafNodes.length})}}n||(n={}),Object.freeze(n),Object.freeze(n.prototype)},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var r,i=s(15);!function(e){e.INITIAL_REQUEST_ID=-1,e.EVENT_NAME=Object.freeze({Bubble:"player-bubble",Movement:"player-movement"});class t{constructor(e,t){this.eventId=i.a.EVENT_ID_REJECT,this.affectedNeighbours=void 0,this.playerId=e,this.playerLastAcceptedRequestId=t}}e.Bubble=t;e.Movement=class extends t{constructor(e,t,s,r){super(e,t),this.newPlayerHealth=void 0,this.tileHealthModDescs=void 0,this.destModDesc={coord:s.coord,lastKnownUpdateId:s.lastKnownUpdateId,newCharSeqPair:void 0,newFreeHealth:void 0},this.moveType=r}}}(r||(r={})),Object.freeze(r)},function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var r,i=s(0),a=s(12);class o{constructor(e,t){r.set(this,void 0),this.player=e,this.noCheckGameOver=t}reset(){this.health=0}_afterAllPlayersConstruction(){}get immigrantInfo(){}get health(){return Object(i.b)(this,r)}set health(e){const t=this.isDowned;if(Object(i.c)(this,r,e),t||!this.isDowned||this.noCheckGameOver)return;const s=this.player.team,o=this.player.game.teams;if(s.elimOrder===a.a.ElimOrder.STANDING&&s.members.every(e=>e.status.noCheckGameOver||e.status.isDowned)){const e=1+o.filter(e=>e.elimOrder!==a.a.ElimOrder.STANDING).length;s.elimOrder=1+o.filter(e=>e.elimOrder!==a.a.ElimOrder.STANDING&&e.elimOrder!==a.a.ElimOrder.IMMORTAL).length,e===o.length&&this.player.game.statusBecomeOver()}}get isDowned(){return this.health<0}}r=new WeakMap,Object.freeze(o),Object.freeze(o.prototype)},function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var r,i=s(0);class a{constructor(e,t){if(r.set(this,void 0),0===t.length)throw Error("Teams must have at least one member.");this.id=e,this.members=t,Object(i.c)(this,r,this.members.every(e=>e.status.noCheckGameOver)?a.ElimOrder.IMMORTAL:a.ElimOrder.STANDING)}reset(){this.elimOrder!==a.ElimOrder.IMMORTAL&&(this.elimOrder=a.ElimOrder.STANDING)}get elimOrder(){return Object(i.b)(this,r)}set elimOrder(e){if(this.elimOrder===a.ElimOrder.IMMORTAL)throw Error("Cannot change the elimination status of an immortal team.");Object(i.c)(this,r,e)}}r=new WeakMap,function(e){let t;!function(e){e.IMMORTAL=-1,e.STANDING=0}(t=e.ElimOrder||(e.ElimOrder={}))}(a||(a={})),Object.freeze(a),Object.freeze(a.prototype)},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s(8);s.d(t,"b",(function(){return r.a}));class i extends r.a{constructor(e,t){if(super(e,t),"ONLINE"===e.gameType)throw TypeError("OnlineGames should be using regular Players instead.")}_notifyGameNowPlaying(){this.delayedMovementContinue()}_notifyGameNowPaused(){this.game.cancelTimeout(this._scheduledMovementCallbackId),this._scheduledMovementCallbackId=void 0}_notifyGameNowOver(){this.game.cancelTimeout(this._scheduledMovementCallbackId),this._scheduledMovementCallbackId=void 0}movementContinue(){const e=this.computeDesiredDest();this._nextMovementTimerMultiplier=this.game.grid.tile.at(e).langSeq.length,this.makeMovementRequest(this.game.grid.getUntToward(e,this.coord),this.getNextMoveType()),this.delayedMovementContinue()}delayedMovementContinue(){this._scheduledMovementCallbackId=this.game.setTimeout(this.movementContinue.bind(this),this.computeNextMovementTimer()*this._nextMovementTimerMultiplier)}}!function(e){e.of=(t,s)=>{const r=s.familyId;return new e._Constructors[r](t,s)}}(i||(i={}))},function(e,t,s){},function(e,t,s){"use strict";var r;s.d(t,"a",(function(){return r})),function(e){e.EVENT_ID_REJECT=-1}(r||(r={})),Object.freeze(r)},function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var r,i=s(0);class a{constructor(e){r.set(this,void 0),Object(i.c)(this,r,e),Object.freeze(this)}get _source(){return Object(i.b)(this,r)}at(...e){return Object(i.b)(this,r)._getTileAt(...e)}destsFrom(...e){return new o(Object(i.b)(this,r)._getTileDestsFrom(...e))}sourcesTo(...e){return new o(Object(i.b)(this,r)._getTileSourcesTo(...e))}}r=new WeakMap,Object.freeze(a),Object.freeze(a.prototype);class o{constructor(e){this.contents=e}get occupied(){return this.contents=this.contents.filter(e=>e.isOccupied),this}get unoccupied(){return this.contents=this.contents.filter(e=>!e.isOccupied),this}get get(){return this.contents}}Object.freeze(o),Object.freeze(o.prototype)},function(e,t,s){"use strict";s.d(t,"b",(function(){return a.a})),s.d(t,"e",(function(){return c})),s.d(t,"c",(function(){return m.a})),s.d(t,"f",(function(){return O.d})),s.d(t,"d",(function(){return E})),s.d(t,"a",(function(){return N}));var r,i,a=s(3),o=s(0),n=s(2),h=s(4);class c extends h.b{constructor(e){super(e),r.set(this,void 0);{const e=Object(o.c)(this,r,document.createElement("div"));e.setAttribute("aria-label","Tile"),e.classList.add(n.a.General.Class.CENTER_CONTENTS,n.a.General.Class.STACK_CONTENTS,n.a.Tile.Class.BASE)}{const e=document.createElement("div");e.setAttribute("aria-hidden","true"),e.classList.add(n.a.Tile.Class.POINTER_HB),Object(o.b)(this,r).appendChild(e)}{const e=document.createElement("div");e.setAttribute("role","presentation"),e.classList.add(n.a.Tile.Class.LANG_CHAR_WRAP);const t=this.langCharElem=document.createElement("div");e.appendChild(t),Object(o.b)(this,r).appendChild(e)}{const e=this.langSeqElem=document.createElement("div");e.setAttribute("role","tooltip"),e.classList.add(n.a.Tile.Class.LANG_SEQ),Object(o.b)(this,r).appendChild(e)}}_addToDom(e){e.appendChild(Object(o.b)(this,r))}_setOccupant(e,t){super._setOccupant(e,t),this.langCharElem.parentElement.insertAdjacentElement("beforebegin",t.playerElem),this.langSeqElem.textContent=t.username}evictOccupant(){super.evictOccupant(),this.langSeqElem.textContent=this.langSeq}set freeHealth(e){super.freeHealth=e,this.freeHealth>0?Object(o.b)(this,r).dataset[n.a.Tile.Dataset.HEALTH]=this.freeHealth.toString():delete Object(o.b)(this,r).dataset[n.a.Tile.Dataset.HEALTH]}get freeHealth(){return super.freeHealth}setLangCharSeqPair(e){super.setLangCharSeqPair(e),this.langCharElem.textContent=this.langChar,this.langSeqElem.textContent=this.langSeq}}r=new WeakMap,Object.freeze(c),Object.freeze(c.prototype),function(e){e.getImplementation=t=>e._Constructors[t]}(i||(i={}));class l{_superVisibleGrid(e,t){const s=n.a.Grid;t.setAttribute("role","presentation"),t.classList.add(s.Class.IMPL_BODY),t.dataset[s.Dataset.IMPL_COORD_SYS]=e.coordSys,this.baseElem=t;const r=document.createElement("div");r.classList.add(n.a.Player.Class.SHORT_SPOTLIGHT);const i=document.createElement("div");i.classList.add(n.a.Player.Class.LONG_SPOTLIGHT),this.spotlightElems=Object.freeze([r,i])}}Object.freeze(l),Object.freeze(l.prototype);var d,u,m=s(8),f=s(9);class p extends m.a{constructor(e,t){super(e,t),d.set(this,void 0),u.set(this,void 0),Object(o.c)(this,u,this.game.langFrontend.remapFunc)}reset(e){super.reset(e),this.prevCoord=e.coord,Object(o.c)(this,d,"")}processKeyboardInput(e){"PLAYING"===this.game.status&&(this.requestInFlight||(" "===e.key?h.a.equals(this.coord,this.prevCoord)||this.makeMovementRequest(this.game.grid.getUntAwayFrom(this.prevCoord,this.coord),m.a.MoveType.BOOST):1!==e.key.length||e.repeat||this.seqBufferAcceptKey(e.key)))}seqBufferAcceptKey(e){const t=this.tile.destsFrom().unoccupied.get;if(0!==t.length)if(e){if(e=Object(o.b)(this,u).call(this,e),f.a.Seq.REGEXP.test(e)){for(let s=this.seqBuffer+e;s.length;s=s.substring(1)){const e=t.find(e=>e.langSeq.startsWith(s));if(e)return Object(o.c)(this,d,s),void(e.langSeq===s&&this.makeMovementRequest(e,m.a.MoveType.NORMAL))}Object(o.c)(this,d,""),this.status.visualBell()}}else{t.find(e=>e.langSeq.startsWith(this.seqBuffer))||Object(o.c)(this,d,"")}}moveTo(e){Object(o.c)(this,d,""),this.prevCoord=this.coord,super.moveTo(e)}_notifyWillBecomeCurrent(){this.status._notifyWillBecomeCurrent(this.game.grid.spotlightElems)}get seqBuffer(){return Object(o.b)(this,d)}}d=new WeakMap,u=new WeakMap,Object.freeze(p),Object.freeze(p.prototype);var b,g,O=s(1),y=s(11);class E extends y.a{constructor(e,t){super(e,t),b.set(this,void 0),g.set(this,void 0);Object(o.c)(this,b,document.createElement("div")).classList.add(n.a.General.Class.CENTER_CONTENTS,n.a.General.Class.STACK_CONTENTS,n.a.Player.Class.BASE);{const e=document.createElement("div");e.classList.add(n.a.Player.Class.FACE);Object(o.c)(this,g,this.player.isALocalOperator?[e.animate({filter:["brightness(0.7)","brightness(1.0)"]},{duration:300,easing:"ease-in",delay:1}),e.animate({transform:E.makeWiggleAnimation(10,2)},{duration:270,easing:"ease-out",delay:1})]:[]).forEach(e=>e.pause());{const t=document.createElement("div");t.classList.add(n.a.Player.Class.DOWNED_OVERLAY),e.appendChild(t)}Object(o.b)(this,b).appendChild(e)}}_afterAllPlayersConstruction(){this._immigrantInfoCache=Object.freeze({playerElem:Object(o.b)(this,b),username:this.player.username})}reset(){super.reset();const e=n.a.Player.Dataset.DOWNED;Object(o.b)(this,b).dataset[e.KEY]=e.VALUES.NO}get immigrantInfo(){return this._immigrantInfoCache}_notifyWillBecomeCurrent(e){const t=this.player.game.currentOperator,s=this.player;requestAnimationFrame(t=>{e.forEach(e=>{Object(o.b)(this,b).appendChild(e)}),s.status.immigrantInfo.playerElem.scrollIntoView(O.c)}),s.teamId!==(null==t?void 0:t.teamId)&&s.game.players.forEach(e=>{const t=e.teamId===s.teamId;Object(o.b)(e.status,b).dataset[n.a.Player.Dataset.FACE_SWATCH]=e.isALocalOperator?t?"me":"meOppo":t?"teammate":"opponent"})}visualBell(){Object(o.b)(this,g),window.requestAnimationFrame(e=>{Object(o.b)(this,g).forEach(e=>e.play())})}get health(){return super.health}set health(e){const t=this.isDowned;if(super.health=e,t!==this.isDowned){const e=n.a.Player.Dataset.DOWNED;Object(o.b)(this,b).dataset[e.KEY]=this.isDowned?this.player.team.elimOrder?e.VALUES.TEAM:e.VALUES.SELF:e.VALUES.NO}}}b=new WeakMap,g=new WeakMap,function(e){var t,s,r;e.makeWiggleAnimation=function(e,t){const s=Array(2*t).fill(e);return s.unshift(0),s.push(0),s.map((e,t)=>`translate(${t%2?e:-e}%)`)};t=new WeakMap,s=new WeakMap,r=new WeakMap,e.Card=class{constructor(e){t.set(this,void 0),s.set(this,void 0),r.set(this,void 0),this.baseElem=document.createElement("div"),this.baseElem.setAttribute("label","Player"),Object(o.c)(this,t,document.createElement("div"));const i=Object(o.b)(this,t);i.textContent=e,this.baseElem.appendChild(i)}}}(E||(E={})),Object.freeze(E),Object.freeze(E.prototype);var v,T,j,w=s(16);class C{constructor(e){this.static=e.gridClass,this.dimensions=e.dimensions,this.tile=new w.a(this)}get area(){return this.static.getArea(this.dimensions)}reset(){this.forEachTile(e=>e.reset())}getRandomCoord(){return this.static.getRandomCoord(this.dimensions)}}(v=C||(C={})).getImplementation=e=>v._Constructors[e],function(e){class t{constructor(e){this.x=e.x,this.y=e.y,Object.freeze(this)}_equals(e){return this.x===e.x&&this.y===e.y}round(){return new t({x:Math.round(this.x),y:Math.round(this.y)})}oneNorm(e){return this.sub(e).originOneNorm()}originOneNorm(){return Math.abs(this.x)+Math.abs(this.y)}infNorm(e){return this.sub(e).originInfNorm()}originInfNorm(){return Math.max(Math.abs(this.x),Math.abs(this.y))}axialAlignment(e){return this.sub(e).originAxialAlignment()}originAxialAlignment(){return Math.abs(Math.abs(this.x)-Math.abs(this.y))/(Math.abs(this.x)+Math.abs(this.y))}add(e){return new t({x:this.x+e.x,y:this.y+e.y})}sub(e){return new t({x:this.x-e.x,y:this.y-e.y})}mul(e){return new t({x:e*this.x,y:e*this.y})}}e.Coord=t,Object.freeze(t),Object.freeze(t.prototype);class s extends C{constructor(e){super(e);const s=[];for(let r=0;r<this.dimensions.height;r++){const i=[];for(let s=0;s<this.dimensions.width;s++){const a=new e.tileClass(new t({x:s,y:r}));i.push(a)}s.push(Object.freeze(i))}this.grid=Object.freeze(s)}static getAmbiguityThreshold(){return 24}static getSizeLimits(){return this.SIZE_LIMITS}forEachTile(e){let t=0;for(const s of this.grid)for(const r of s)e(r,t++)}shuffledForEachTile(e){this.grid.flat().sort((e,t)=>Math.random()-.5).forEach(t=>e(t))}getUntToward(e,t){const s=this.tile.destsFrom(t).unoccupied.get;if(0===s.length)return this.tile.at(t);if(1===s.length)return s[0];s.sort((t,s)=>t.coord.oneNorm(e)-s.coord.oneNorm(e)).sort((t,s)=>t.coord.infNorm(e)-s.coord.infNorm(e));for(let t=1;t<s.length;t++)if(s[t].coord.infNorm(e)>s[0].coord.infNorm(e)){s.splice(t);break}if(1===s.length)return s[0];if(s[0].coord.x-t.x==0||s[0].coord.y-t.y==0){if(t.axialAlignment(t.sub(e))-.5>0)return s[0];s.shift()}return s[Math.floor(s.length*Math.random())]}getUntAwayFrom(e,t){return this.getUntToward(t.add(t.sub(e)),t)}getRandomCoordAround(e,s){return new t({x:e.x+Math.trunc(2*s*(Math.random()-.5)),y:e.y+Math.trunc(2*s*(Math.random()-.5))})}_getTileAt(e){return this.grid[e.y][e.x]}_getTileDestsFrom(e,t=1){let s=e.y-t,r=e.y+t+1,i=e.x-t,a=e.x+t+1;return s>=this.dimensions.height||r<0||i>=this.dimensions.width||a<0?[]:this.grid.slice(Math.max(0,s),Math.min(this.dimensions.height,r)).flatMap(e=>e.slice(Math.max(0,i),Math.min(this.dimensions.width,a)))}_getTileSourcesTo(e,t=1){return this._getTileDestsFrom(e,t)}minMovesFromTo(e,t){return Math.min(Math.abs(t.x-e.x),Math.abs(t.y-e.y))}static getSpawnCoords(e,t){const r=[];return e.map(e=>{const i=[];for(;e>0;){let a;do{a=s.getRandomCoord(t)}while(r.find(e=>a._equals(e)));i.push(a),r.push(a),e--}return i})}static getArea(e){return e.height*e.width}static getRandomCoord(e){const s=Math.floor(e.width*Math.random()),r=Math.floor(e.height*Math.random());return new t({x:s,y:r})}}s.SIZE_LIMITS=Object.freeze({height:Object.freeze({min:11,max:51}),width:Object.freeze({min:11,max:51})}),e.Grid=s,function(e){class t extends e{constructor(e){super(e);const t=document.createElement("div");t.style.setProperty("--euclid2-grid-width",this.dimensions.width.toString());for(const e of this.grid)for(const s of e)s._addToDom(t);this._superVisibleGrid(e,t)}}e.Visible=t,Object(O.d)(t,[l]),Object.freeze(t),Object.freeze(t.prototype)}(s=e.Grid||(e.Grid={})),Object.freeze(s),Object.freeze(s.prototype)}(T||(T={})),Object.freeze(T),function(e){class t{constructor(e){this.dash=e.dash,this.bash=e.bash,Object.freeze(this)}_equals(e){return this.dash===e.dash&&this.bash===e.bash}round(){const e=Math.floor(this.dash),s=Math.floor(this.bash),r=e-this.dash,i=s-this.bash;return r>2*i?new t({dash:e+1,bash:s}):r<.5*i?new t({dash:e,bash:s+1}):Math.min(r,i)>.5?new t({dash:e+1,bash:s+1}):new t({dash:e,bash:s})}add(e){return new t({dash:this.dash+e.dash,bash:this.bash+e.bash})}sub(e){return new t({dash:this.dash-e.dash,bash:this.bash-e.bash})}mul(e){return new t({dash:e*this.dash,bash:e*this.bash})}}e.Coord=t,Object.freeze(t),Object.freeze(t.prototype);class s extends C{constructor(e){super(e);this.grid=Object.freeze(void 0)}static getAmbiguityThreshold(){return 18}static getSizeLimits(){return this.SIZE_LIMITS}forEachTile(e){let t=0;for(const s of this.grid)for(const r of s)e(r,t++)}shuffledForEachTile(e){this.grid.flat().sort((e,t)=>Math.random()-.5).forEach(t=>e(t))}getUntToward(e,t){}getUntAwayFrom(e,t){return this.getUntToward(t.add(t.sub(e)),t)}getRandomCoordAround(e,t){}_getTileAt(e){}_getTileDestsFrom(e){}_getTileSourcesTo(e){}minMovesFromTo(e,t){}static getSpawnCoords(e,t){}static getArea(e){const t=Math.min(e.fslash,e.bslash),s=Math.max(e.fslash,e.bslash),r=-1+e.dash+t;let i=2*t*(e.dash+r);return i+=(s-t-1)*r,i}static getRandomCoord(e){return new t(void 0)}}s.SIZE_LIMITS=Object.freeze({dash:Object.freeze({min:10,max:50}),bslash:Object.freeze({min:10,max:50}),fslash:Object.freeze({min:10,max:50})}),e.Grid=s,function(e){class t extends e{constructor(e){super(e);this._superVisibleGrid(e,void 0)}}e.Visible=t,Object(O.d)(t,[l]),Object.freeze(t),Object.freeze(t.prototype)}(s=e.Grid||(e.Grid={})),Object.freeze(s),Object.freeze(s.prototype)}(j||(j={})),Object.freeze(j);var _,I,M=s(13);class A extends M.a{constructor(e,t){super(e,t),_.set(this,void 0),this.behaviour=Object.freeze(Object.assign(Object.create(null),A.Behaviour.DEFAULT,t.familyArgs)),this.grid=this.game.grid}_afterAllPlayersConstruction(){super._afterAllPlayersConstruction(),this.threatProximity=this.game.teams.filter(e=>e.id!==this.teamId).flatMap(e=>e.members),this.targetProximity=this.threatProximity.slice()}reset(e){super.reset(e),Object(o.c)(this,_,this.coord)}moveTo(e){Object(o.c)(this,_,this.coord),super.moveTo(e)}computeDesiredDest(){this.threatProximity.sort((e,t)=>this.grid.minMovesFromTo(e.coord,this.coord)-this.grid.minMovesFromTo(t.coord,this.coord));for(const e of this.threatProximity){if(this.grid.minMovesFromTo(e.coord,this.coord)>this.behaviour.fearDistance)break;if(!e.status.isDowned&&e.status.health>this.status.health)return this.grid.getUntAwayFrom(e.coord,this.coord).coord}if(this.targetProximity.sort((e,t)=>this.grid.minMovesFromTo(this.coord,e.coord)-this.grid.minMovesFromTo(this.coord,t.coord)),this.status.isDowned)for(const e of this.targetProximity){if(this.grid.minMovesFromTo(this.coord,e.coord)>this.behaviour.bloodThirstDistance)break;if(e.status.health<this.status.health-this.behaviour.healthReserve)return e.coord}if(0===this.game.freeHealthTiles.size){if(Math.random()<this.behaviour.wanderingAimlessness)return this.grid.getRandomCoordAround(this.coord,3);{const e=this.grid.getUntAwayFrom.bind(this.grid,Object(o.b)(this,_));return this.grid.getRandomCoordAround(e(e(this.coord).coord).coord,1)}}let e=void 0,t=1/0;for(const s of this.game.freeHealthTiles){const r=this.grid.minMovesFromTo(this.coord,s.coord);r<t&&(e=s,t=r)}return e.coord}getNextMoveType(){return M.b.MoveType.NORMAL}computeNextMovementTimer(){return 1e3/this.behaviour.keyPressesPerSecond}}_=new WeakMap,function(e){let t;!function(e){e.DEFAULT=Object.freeze({fearDistance:5,bloodThirstDistance:7,healthReserve:3,keyPressesPerSecond:2,wanderingAimlessness:.2})}(t=e.Behaviour||(e.Behaviour={}))}(A||(A={})),Object.freeze(A),Object.freeze(A.prototype),function(e){function t(){C._Constructors=Object.freeze({EUCLID2:T.Grid,BEEHIVE:j.Grid}),Object.freeze(C),Object.freeze(C.prototype);{const e=i;e._Constructors=Object.freeze({EUCLID2:T.Grid.Visible,BEEHIVE:j.Grid.Visible}),Object.freeze(e)}{const e=M.a;e._Constructors=Object.freeze({CHASER:A}),Object.freeze(e),Object.freeze(e.prototype)}}e.INIT_CLASS_REGISTRIES=t,Object.freeze(t)}(I||(I={})),Object.freeze(I),I.INIT_CLASS_REGISTRIES();class N{_ctorBrowserGame(){this.htmlElements=Object.freeze({gridImpl:this.grid.baseElem,playersBar:document.createElement("div")})}_getGridImplementation(e){return i.getImplementation(e)}_createOperatorPlayer(e){return new p(this,e)}}Object.freeze(N),Object.freeze(N.prototype)},function(e,t,s){"use strict";s.d(t,"a",(function(){return m}));var r,i,a,o,n=s(0),h=s(3),c=s(15),l=(s(10),s(1)),d=s(8);class u{constructor(e,t,s){r.set(this,void 0),i.set(this,void 0),a.set(this,void 0),this.gameType=e;const o=this._getGridImplementation(s.coordSys);this.grid=new o({gridClass:o,tileClass:t.tileClass,coordSys:s.coordSys,dimensions:s.gridDimensions}),Object(n.c)(this,r,t.onGameBecomeOver),this.langFrontend=l.a.GET_FRONTEND_DESC_BY_ID(s.langId),this._playerStatusCtor=t.playerStatusCtor,this.players=this.createPlayers(s),this.operators=Object.freeze(this.players.filter(e=>e.isALocalOperator)),this.setCurrentOperator(0);{const e=[];if(this.players.forEach(t=>{e[t.teamId]||(e[t.teamId]=[]),e[t.teamId].push(t)}),this.teams=e.map((e,t)=>new d.b(t,e)),this.teams.every(e=>e.id===d.b.ElimOrder.IMMORTAL))throw Error("All teams are immortal. The game will never end.")}this.players.forEach(e=>e._afterAllPlayersConstruction())}reset(){return this.grid.reset(),Object(n.c)(this,a,"PAUSED"),Promise.resolve()}createPlayers(e){const t=e.playerDescs="ONLINE"===this.gameType?e.playerDescs:d.a.CtorArgs.finalize(e.playerDescs);return Object.freeze(t.map(e=>e.familyId===d.a.Family.HUMAN?e.isALocalOperator?this._createOperatorPlayer(e):new d.a(this,e):this._createArtifPlayer(e)))}serializeResetState(){const e=[],t=this.players.map(e=>e.coord),s=[];return this.grid.forEachTile(t=>{t.lastKnownUpdateId++,e.push({char:t.langChar,seq:t.langSeq}),t.freeHealth&&s.push({coord:t.coord,health:t.freeHealth})}),{csps:e,playerCoords:t,healthCoords:s}}deserializeResetState(e){this.grid.forEachTile((t,s)=>{t.setLangCharSeqPair(e.csps[s]),t.lastKnownUpdateId++}),e.playerCoords.forEach((e,t)=>{this.players[t].reset(this.grid.tile.at(e))}),e.healthCoords.forEach(e=>{this.grid.tile.at(e.coord).freeHealth=e.health})}get currentOperator(){return Object(n.b)(this,i)}setCurrentOperator(e){const t=this.operators[e];t&&this.currentOperator!==t&&(t._notifyWillBecomeCurrent(),Object(n.c)(this,i,t))}get status(){return Object(n.b)(this,a)}statusBecomePlaying(){if("PLAYING"!==this.status){if("PAUSED"!==this.status)throw Error("Can only resume a game that is currently paused.");this.players.forEach(e=>{e._notifyGameNowPlaying()}),this._abstractStatusBecomePlaying(),Object(n.c)(this,a,"PLAYING")}else console.log("[statusBecomePlaying]: Game is already playing")}statusBecomePaused(){if("PAUSED"!==this.status){if("PLAYING"!==this.status)throw Error("Can only pause a game that is currently playing.");this.players.forEach(e=>{e._notifyGameNowPaused()}),this._abstractStatusBecomePaused(),Object(n.c)(this,a,"PAUSED")}else console.log("[statusBecomePaused]: Game is already paused")}statusBecomeOver(){if("PLAYING"!==this.status)throw Error("Can only end a game that is currently playing.");this.players.forEach(e=>{e._notifyGameNowOver()}),this._abstractStatusBecomeOver(),Object(n.c)(this,a,"OVER"),Object(n.b)(this,r).call(this),console.log("game is over!")}_abstractStatusBecomePlaying(){}_abstractStatusBecomePaused(){}_abstractStatusBecomeOver(){}}r=new WeakMap,i=new WeakMap,a=new WeakMap,Object.freeze(u),Object.freeze(u.prototype);class m extends u{constructor(e,t,s){super(e,t,s),o.set(this,void 0),this.eventRecordBitmap=[]}reset(){const e=super.reset();return this.eventRecordBitmap.fill(!1,0,h.a.K.EVENT_RECORD_WRAPPING_BUFFER_LENGTH),Object(n.c)(this,o,0),e}get nextUnusedEventId(){return Object(n.b)(this,o)}_recordEvent(e){const t=e.eventId,s=t%h.a.K.EVENT_RECORD_WRAPPING_BUFFER_LENGTH;if(t===c.a.EVENT_ID_REJECT)throw TypeError("Do not try to record events for rejected requests.");if(t<0||t!==Math.trunc(t))throw RangeError("Event ID's must only be assigned positive, integer values.");if(this.eventRecordBitmap[s])throw Error("Event ID's must be assigned unique values.");this.eventRecordBitmap[s]=!0,this.eventRecordBitmap[(t+h.a.K.EVENT_RECORD_WRAPPING_BUFFER_LENGTH-h.a.K.EVENT_RECORD_FORWARD_WINDOW_LENGTH)%h.a.K.EVENT_RECORD_WRAPPING_BUFFER_LENGTH]=!1,Object(n.c)(this,o,+Object(n.b)(this,o)+1)}executeTileModEvent(e,t=!0){Object.freeze(e);const s=this.grid.tile.at(e.coord);if(s.lastKnownUpdateId>e.lastKnownUpdateId)return s;if(s.lastKnownUpdateId===e.lastKnownUpdateId)throw"never";return e.newCharSeqPair&&(s.setLangCharSeqPair(e.newCharSeqPair),t&&this.operators.filter(e=>e.tile.destsFrom().get.includes(s)).forEach(e=>e.seqBufferAcceptKey(""))),s.lastKnownUpdateId=e.lastKnownUpdateId,s.freeHealth=e.newFreeHealth,s}executePlayerMoveEvent(e){var t;const s=this.players[e.playerId],r=e.playerLastAcceptedRequestId-s.lastAcceptedRequestId;if(e.eventId===c.a.EVENT_ID_REJECT)return void(0===r&&(s.requestInFlight=!1));this._recordEvent(e);const i=this.executeTileModEvent(e.destModDesc,s!==this.currentOperator);if(null===(t=e.tileHealthModDescs)||void 0===t||t.forEach(e=>{this.executeTileModEvent(e)}),r>1){if(s===this.currentOperator)throw"never"}else{if(s.requestInFlight=!1,!(s===this.currentOperator?1===r:r<=1))throw"never";s.status.health=e.newPlayerHealth.health,s.moveTo(i),s.lastAcceptedRequestId=e.playerLastAcceptedRequestId}}executePlayerBubbleEvent(e){this.players[e.playerId].requestInFlight=!1,e.eventId!==c.a.EVENT_ID_REJECT&&this._recordEvent(e)}}o=new WeakMap,Object.freeze(m),Object.freeze(m.prototype)}]]);
//# sourceMappingURL=online.js.map
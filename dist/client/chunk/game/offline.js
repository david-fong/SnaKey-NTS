(window.webpackJsonpsnakey3=window.webpackJsonpsnakey3||[]).push([[1],{22:function(e,t,r){var s={"./Emote.ts":[23,4],"./English.ts":[24,5],"./Japanese.ts":[25,6],"./Korean.ts":[26,7],"./Morse.ts":[27,8]};function n(e){if(!r.o(s,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],n=t[0];return r.e(t[1]).then((function(){return r(n)}))}n.keys=function(){return Object.keys(s)},n.id=22,e.exports=n},29:function(e,t,r){"use strict";r.r(t),r.d(t,"OfflineGame",(function(){return T}));var s=r(2),n=r(14),a=r(8),o=r(15),i=r(19),h=r(12),c=r(6),l=r(7),d=r(21),u=r(1);class p{constructor(e){const t=[];for(const r of e)t[r]=new p.Entry;this.entries=t}reset(){for(const e of this.entries)e.reset()}}!function(e){class t{constructor(){this.moveCounts={}}reset(){this.totalHealthPickedUp=0,Object.getOwnPropertyNames(u.b.MoveType).forEach(e=>{this.moveCounts[e]=0})}}e.Entry=t,Object.freeze(t),Object.freeze(t.prototype)}(p||(p={})),Object.freeze(p),Object.freeze(p.prototype);var f,g,m,v=function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function o(e){try{h(s.next(e))}catch(e){a(e)}}function i(e){try{h(s.throw(e))}catch(e){a(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}h((s=s.apply(e,t||[])).next())}))},w=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},y=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};class E extends d.a{constructor(e,t,s){super(e,t,s),f.set(this,void 0),g.set(this,void 0),m.set(this,void 0),this.averageFreeHealth=s.averageFreeHealthPerTile*this.grid.area,this.averageFreeHealthPerTile=s.averageFreeHealthPerTile,w(this,g,new Set),w(this,m,r(22)(`./${this.langFrontend.module}.ts`).then(e=>{this.lang=e[this.langFrontend.module][this.langFrontend.export].getInstance();const t=this.grid.static.getAmbiguityThreshold();if(this.lang.numLeaves<t)throw new Error(`Found ${this.lang.numLeaves} leaves, but at least ${t} were required. The provided mappings composing the current Lang-under-construction are not sufficient to ensure that a shuffling operation will always be able to find a safe candidate to use as a replacement. Please see the spec for Lang.getNonConflictingChar.`);return this.lang})),this.langBalancingScheme=s.langBalancingScheme,this.scoreInfo=new p(this.players.map(e=>e.playerId))}reset(){const e=Object.create(null,{reset:{get:()=>super.reset}});return v(this,void 0,void 0,(function*(){yield e.reset.call(this),w(this,f,0),y(this,g).clear(),yield y(this,m),this.lang.reset(),this.grid.forEachTile(e=>{e.setLangCharSeqPair(this.dryRunShuffleLangCharSeqAt(e))}),this.teams.forEach(e=>e.reset());const t=this.grid.static.getSpawnCoords(this.teams.map(e=>e.members.length),this.grid.dimensions);return this.teams.forEach((e,r)=>{e.members.forEach((e,s)=>{e.reset(this.grid.tile.at(t[r][s]))})}),this.scoreInfo.reset(),Promise.resolve()}))}dryRunShuffleLangCharSeqAt(e){e.setLangCharSeqPair(c.a.CharSeqPair.NULL);const t=Array.from(new Set(this.grid.tile.sourcesTo(e.coord).get.flatMap(e=>this.grid.tile.destsFrom(e.coord).get)));return this.lang.getNonConflictingChar(t.map(e=>e.langSeq).filter(e=>e),this.langBalancingScheme)}get currentFreeHealth(){return y(this,f)}get freeHealthTiles(){return y(this,g)}dryRunSpawnFreeHealth(e){let t=this.averageFreeHealth-this.currentFreeHealth;if(t<=0)return;const r=[];for(;t>0;){let n;do{n=this.grid.tile.at(this.grid.getRandomCoord())}while(n.isOccupied||r.find(e=>n.coord.equals(e.coord)));const a=1;if(Math.random()<s.a.K.HEALTH_UPDATE_CHANCE){let t;(t=e.find(e=>n.coord.equals(e.coord)))?t.newFreeHealth=(t.newFreeHealth||0)+a:r.push({coord:n.coord,lastKnownUpdateId:1+n.lastKnownUpdateId,newCharSeqPair:void 0,newFreeHealth:n.freeHealth+a})}t-=a}return r}getHealthCostOfBoost(){return this.averageFreeHealthPerTile/s.a.K.PCT_MOVES_THAT_ARE_BOOST}executeTileModEvent(e,t=!0){Object.freeze(e);const r=this.grid.tile.at(e.coord);if(e.lastKnownUpdateId!==1+r.lastKnownUpdateId)throw new Error("this never happens. see comment in source.");return w(this,f,y(this,f)+(e.newFreeHealth-r.freeHealth)),0===e.newFreeHealth?y(this,g).delete(r):y(this,g).add(r),super.executeTileModEvent(e,t),r}managerCheckGamePlayingRequest(e){if(this.status!==s.a.Status.PLAYING)return;const t=this.players[e.playerId];if(!t)throw new Error("No such player exists.");if(e.playerLastAcceptedRequestId!==t.lastAcceptedRequestId)throw new RangeError(e.playerLastAcceptedRequestId<t.lastAcceptedRequestId?"Clients should not make requests until they have received my response to their last request.":"Client seems to have incremented the request ID counter on their own, which is is illegal.");return t}processMoveRequest(e){const t=this.managerCheckGamePlayingRequest(e);if(!t)return void this.executePlayerMoveEvent(e);const r=this.grid.tile.at(e.destModDesc.coord);if(r.isOccupied||r.lastKnownUpdateId!==e.destModDesc.lastKnownUpdateId)return void this.executePlayerMoveEvent(e);const n=t.status.health+r.freeHealth*(t.status.isDowned?s.a.K.HEALTH_EFFECT_FOR_DOWNED_PLAYER:1)-(e.moveType===l.a.MoveType.BOOST?this.getHealthCostOfBoost():0);if(n<0)return void this.executePlayerMoveEvent(e);const a=this.scoreInfo.entries[t.playerId];a.totalHealthPickedUp+=r.freeHealth,a.moveCounts[e.moveType]+=1,e.playerLastAcceptedRequestId=1+t.lastAcceptedRequestId,e.newPlayerHealth={health:n},e.destModDesc.lastKnownUpdateId=1+r.lastKnownUpdateId,e.destModDesc.newFreeHealth=0,e.destModDesc.newCharSeqPair=this.dryRunShuffleLangCharSeqAt(r),e.tileHealthModDescs=this.dryRunSpawnFreeHealth([e.destModDesc]),e.eventId=this.nextUnusedEventId,this.executePlayerMoveEvent(e)}processPlayerContact(e){}processBubbleRequest(e){const t=this.managerCheckGamePlayingRequest(e);t?(e.playerLastAcceptedRequestId=1+t.lastAcceptedRequestId,e.eventId=this.nextUnusedEventId,this.executePlayerBubbleEvent(e)):this.executePlayerBubbleEvent(e)}}f=new WeakMap,g=new WeakMap,m=new WeakMap,Object.freeze(E),Object.freeze(E.prototype);var I=r(20);r(13),I.a.INIT_CLASS_REGISTRIES();class T extends E{constructor(e){super(s.a.Type.OFFLINE,{tileClass:n.a,playerStatusCtor:i.a},e),this.htmlElements=Object.freeze({gridImplElem:this.grid.baseElem})}__getGridImplementation(e){return a.a.getImplementation(e)}__createOperatorPlayer(e){return new o.a(this,e)}__createArtifPlayer(e){return h.a.of(this,e)}setTimeout(e,t,...r){return setTimeout(e,t,r)}cancelTimeout(e){clearTimeout(e)}}Object.freeze(T),Object.freeze(T.prototype)}}]);
//# sourceMappingURL=offline.js.map
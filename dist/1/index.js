(window.webpackJsonpsnakey3=window.webpackJsonpsnakey3||[]).push([[1],{4:function(e,t,s){},5:function(e,t,s){"use strict";s.r(t),s.d(t,"game",(function(){return he}));var r,i,a=s(1),n=s(0);!function(e){let t,s,r,i;!function(e){e.SERVER="SERVER",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(t=e.Type||(e.Type={})),function(e){e.EVENT_NAME="game-create"}(s=e.CtorArgs||(e.CtorArgs={})),function(e){e.EVENT_NAME="game-reset"}(r=e.Serialization||(e.Serialization={})),function(e){e.PLAYING="PLAYING",e.PAUSED="PAUSED",e.OVER="OVER"}(i=e.Status||(e.Status={}))}(r||(r={})),Object.freeze(r),function(e){let t;!function(e){e.EUCLID2="EUCLID2",e.BEEHIVE="BEEHIVE"}(t=e.System||(e.System={}));class s{constructor(e){}}e.Abstract=s,function(t){class s extends e.Abstract{}t.Mathy=s}(s=e.Abstract||(e.Abstract={})),Object.freeze(s),Object.freeze(s.prototype)}(i||(i={})),Object.freeze(i);var o,h,c,l,d=function(e,t,s){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,s),s},u=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};class m{constructor(e){o.set(this,void 0),h.set(this,void 0),c.set(this,void 0),l.set(this,void 0),this.coord=e,d(this,o,n.b.Id.NULL)}reset(){this.evictOccupant(),this.lastKnownUpdateId=0,this.freeHealth=0,this.setLangCharSeqPair(n.a.CharSeqPair.NULL)}visualBell(){}__setOccupant(e,t){d(this,o,e)}get isOccupied(){return this.occupantId!==n.b.Id.NULL}evictOccupant(){d(this,o,n.b.Id.NULL)}get occupantId(){return u(this,o)}get freeHealth(){return u(this,h)}set freeHealth(e){d(this,h,e)}setLangCharSeqPair(e){d(this,c,e.char),d(this,l,e.seq)}get langChar(){return u(this,c)}get langSeq(){return u(this,l)}}o=new WeakMap,h=new WeakMap,c=new WeakMap,l=new WeakMap,Object.freeze(m),Object.freeze(m.prototype);var p,g,f,E,y,w=function(e,t,s){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,s),s},b=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};class I extends m{constructor(e){super(e),p.set(this,void 0);{const e=document.createElement("div");e.classList.add(a.a.Tile.Class.BASE),w(this,p,e)}{const e=document.createElement("div");e.classList.add(a.a.Tile.Class.POINTER_HB),b(this,p).appendChild(e)}{const e=document.createElement("div");e.classList.add(a.a.Tile.Class.LANG_CHAR,a.a.General.Class.FILL_PARENT),b(this,p).appendChild(e),this.langCharElem=e}{const e=document.createElement("div");e.classList.add(a.a.Tile.Class.LANG_SEQ),b(this,p).appendChild(e),this.langSeqElem=e}}__addToDom(e){e.appendChild(b(this,p))}__setOccupant(e,t){super.__setOccupant(e,t),b(this,p).appendChild(t)}visualBell(){b(this,p)}evictOccupant(){super.evictOccupant()}set freeHealth(e){super.freeHealth=e,this.freeHealth?b(this,p).dataset[a.a.Tile.Dataset.HEALTH]=e.toString():delete b(this,p).dataset[a.a.Tile.Dataset.HEALTH]}setLangCharSeqPair(e){super.setLangCharSeqPair(e),this.langCharElem.innerText=this.langChar,this.langSeqElem.innerText=this.langSeq}}p=new WeakMap,Object.freeze(I),Object.freeze(I.prototype),function(e){e.getImplementation=t=>e.__Constructors[t]}(g||(g={}));class C{constructor(e,t,s){this.sequence=t,this.characters=s,this.parent=e,this.children=[]}static CREATE_TREE_MAP(e){const t=new Map;for(const s in e){const r=e[s].seq,i=new O(s,e[s].weight),a=t.get(r);a?a.push(i):t.set(r,[i])}const s=new C.Root;return Array.from(t).sort((e,t)=>e[0].length-t[0].length).forEach(e=>{s.addCharMapping(...e)}),s.finalize(),s}finalize(){this.validateConstruction(),Object.freeze(this.characters),Object.freeze(this.children),this.children.forEach(e=>e.finalize())}validateConstruction(){if(!this.sequence.startsWith(this.parent.sequence))throw new Error("Child node's sequence must start with that of its parent.")}reset(){this.children.forEach(e=>e.reset()),this.inheritingHitCount=0,this.inheritingWeightedHitCount=0,this.characters.forEach(e=>{e.reset();for(let t=0;t<10*Math.random();t++)this.incrementNumHits(e)})}addCharMapping(e,t){if(!n.a.Seq.REGEXP.test(e))throw new RangeError(`Mapping-sequence "${e}" did not match the required regular expression "${n.a.Seq.REGEXP.source}".`);if(0===t.length)throw new Error("Must not make mapping without written characters.");let s=this;{let t=this;for(;t;)s=t,t=t.children.find(t=>e.startsWith(t.sequence))}if(s.sequence===e)throw new Error(`Mappings for all written-characters with a commoncorresponding typeable-sequence should be registered together,but an existing mapping for the sequence "${e}" was found.`);s.children.push(new C(s,e,t))}chooseOnePair(e){const t=this.characters.slice(0).sort(O.CMP[e]).shift(),s={char:t.char,seq:this.sequence};return this.incrementNumHits(t),s}incrementNumHits(e){e.incrementNumHits(),this.__recursiveIncrementNumHits(e.weightInv)}__recursiveIncrementNumHits(e){this.inheritingHitCount+=1,this.inheritingWeightedHitCount+=e,this.children.forEach(t=>t.__recursiveIncrementNumHits(e))}get personalHitCount(){return this.inheritingHitCount-this.parent.inheritingHitCount}get averageCharHitCount(){return this.characters.reduce((e,t)=>e+t.hitCount,0)/this.characters.length}get personalWeightedHitCount(){return this.inheritingWeightedHitCount-this.parent.inheritingWeightedHitCount}andNonRootParents(){const e=[];let t=this;for(;t.parent;)e.push(t),t=t.parent;return e}getLeafNodes(){const e=[];return this.__recursiveGetLeafNodes(e),e}__recursiveGetLeafNodes(e){this.children.length?this.children.forEach(t=>{t.__recursiveGetLeafNodes(e)}):e.push(this)}simpleView(){let e=this.characters.map(e=>e.simpleView());return Object.assign(Object.create(null),{seq:this.sequence,chars:1===e.length?e[0]:e,hits:this.personalHitCount,kids:this.children.map(e=>e.simpleView()),__proto__:void 0})}}C.LEAF_CMP=Object.freeze({[n.a.BalancingScheme.SEQ]:(e,t)=>e.inheritingHitCount-t.inheritingHitCount,[n.a.BalancingScheme.CHAR]:(e,t)=>e.inheritingHitCount-t.inheritingHitCount,[n.a.BalancingScheme.WEIGHT]:(e,t)=>e.inheritingWeightedHitCount-t.inheritingWeightedHitCount}),C.PATH_CMP=Object.freeze({[n.a.BalancingScheme.SEQ]:(e,t)=>e.personalHitCount-t.personalHitCount,[n.a.BalancingScheme.CHAR]:(e,t)=>e.averageCharHitCount-t.averageCharHitCount,[n.a.BalancingScheme.WEIGHT]:(e,t)=>e.personalWeightedHitCount-t.personalWeightedHitCount}),(f=C||(C={})).Root=class extends f{constructor(){super(void 0,"",[])}validateConstruction(){}chooseOnePair(e){throw new TypeError("Must never hit on the root.")}get personalHitCount(){throw new TypeError("Must never hit on the root.")}get personalWeightedHitCount(){throw new TypeError("Must never hit on the root.")}andNonRootParents(){throw new TypeError}simpleView(){return this.children.map(e=>e.simpleView())}},Object.freeze(C),Object.freeze(C.prototype);class O{constructor(e,t){if(t<=0)throw new RangeError(`All weights must be positive, but we were passed the value "${t}" for the character "${e}".`);this.char=e,this.weightInv=1/t}reset(){this.hitCount=0,this.weightedHitCount=0}incrementNumHits(){this.hitCount+=1,this.weightedHitCount+=this.weightInv}simpleView(){return Object.assign(Object.create(null),{char:this.char,hits:this.hitCount})}}O.CMP=Object.freeze({[n.a.BalancingScheme.SEQ]:(e,t)=>e.hitCount-t.hitCount,[n.a.BalancingScheme.CHAR]:(e,t)=>e.hitCount-t.hitCount,[n.a.BalancingScheme.WEIGHT]:(e,t)=>e.weightedHitCount-t.weightedHitCount}),Object.freeze(O),Object.freeze(O.prototype);class T extends n.a{constructor(e,t){super(),this.static=e,this.treeMap=C.CREATE_TREE_MAP(t),this.leafNodes=this.treeMap.getLeafNodes()}get numLeaves(){return this.leafNodes.length}reset(){this.treeMap.reset()}getNonConflictingChar(e,t){this.leafNodes.sort(C.LEAF_CMP[t]);let s=void 0;for(const r of this.leafNodes){const i=r.andNonRootParents();for(let t=0;t<i.length;t++){const s=e.find(e=>e.startsWith(i[t].sequence));if(s){s===i[t].sequence?i.splice(0):i.splice(t);break}}if(i.length){i.sort(C.PATH_CMP[t]),s=i[0];break}}if(!s)throw new Error("Invariants guaranteeing that a LangSeq canalways be shuffled-in were not met.");return s.chooseOnePair(t)}simpleView(){return Object.assign(Object.create(null),{name:this.static.getName(),desc:this.static.getBlurb(),root:this.treeMap.simpleView()})}}T||(T={}),Object.freeze(T),Object.freeze(T.prototype),function(e){e.EVENT_ID_REJECT=-1}(E||(E={})),Object.freeze(E),function(e){e.INITIAL_REQUEST_ID=-1,e.EVENT_NAME=Object.freeze({Bubble:"player-bubble",Movement:"player-movement"});class t{constructor(e,t){this.eventId=E.EVENT_ID_REJECT,this.affectedNeighbours=void 0,this.playerId=e,this.playerLastAcceptedRequestId=t}}e.Bubble=t;e.Movement=class extends t{constructor(e,t,s){super(e,t),this.newPlayerHealth=void 0,this.tilesWithHealthUpdates=void 0,this.dest={coord:s.coord,lastKnownUpdateId:s.lastKnownUpdateId,newCharSeqPair:void 0,newFreeHealth:void 0}}}}(y||(y={})),Object.freeze(y);class v{constructor(e){this.source=e}at(...e){return this.source.__getTileAt(...e)}destsFrom(...e){return new _(this.source.__getTileDestsFrom(...e))}sourcesTo(...e){return new _(this.source.__getTileSourcesTo(...e))}}Object.freeze(v),Object.freeze(v.prototype);class _{constructor(e){this.contents=e}get occupied(){return this.contents=this.contents.filter(e=>e.isOccupied),this}get unoccupied(){return this.contents=this.contents.filter(e=>!e.isOccupied),this}get get(){return this.contents}}Object.freeze(_),Object.freeze(_.prototype);var S,N=function(e,t,s){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,s),s},L=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};class A extends n.b{constructor(e,t){if(super(),S.set(this,void 0),Math.trunc(t.playerId)!==t.playerId)throw new RangeError("Player ID's must be integer values.");this.playerId=t.playerId,this.game=e,this.status=new this.game.__playerStatusCtor(this,t.noCheckGameOver),this.tile=new v(new A.TileGetterSource(this))}reset(e){N(this,S,e),this.hostTile.__setOccupant(this.playerId,this.status.baseElem)}get coord(){return this.hostTile.coord}get hostTile(){return L(this,S)}onGoBesideOtherPlayer(){}moveTo(e){if(this.hostTile.occupantId!==this.playerId){if(this.game.gameType!==r.Type.ONLINE)throw new Error("Linkage between player and occupied tile disagrees.")}else this.hostTile.evictOccupant();if(e.isOccupied){if(this.game.gameType!==r.Type.ONLINE)throw new Error("Only one player can occupy a tile at a time.")}else N(this,S,e),e.__setOccupant(this.playerId,this.status.baseElem)}}S=new WeakMap,function(e){class t{constructor(e){this.player=e}__getTileAt(){return this.player.game.grid.tile.at(this.player.coord)}__getTileDestsFrom(){return this.player.game.grid.tile.destsFrom(this.player.coord).get}__getTileSourcesTo(){return this.player.game.grid.tile.sourcesTo(this.player.coord).get}}e.TileGetterSource=t,Object.freeze(t),Object.freeze(t.prototype)}(A||(A={})),Object.freeze(A),Object.freeze(A.prototype);var M,H=function(e,t,s){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,s),s},q=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};class R{constructor(e,t){if(M.set(this,void 0),0===t.length)throw new Error("teams must have at least one member.");this.id=e,this.members=t,H(this,M,this.members.every(e=>e.status.noCheckGameOver)?R.ElimOrder.IMMORTAL:R.ElimOrder.STANDING)}reset(){this.elimOrder!==R.ElimOrder.IMMORTAL&&(this.elimOrder=R.ElimOrder.STANDING)}get elimOrder(){return q(this,M)}set elimOrder(e){if(this.elimOrder===R.ElimOrder.IMMORTAL)throw new Error("Cannot change the elimination status of an immortal team.");H(this,M,e)}}M=new WeakMap,function(e){let t;!function(e){e.IMMORTAL=-1,e.STANDING=0}(t=e.ElimOrder||(e.ElimOrder={}))}(R||(R={})),Object.freeze(R),Object.freeze(R.prototype);var z,j,P=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},x=function(e,t,s){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,s),s};class G{constructor(e,t){z.set(this,void 0),j.set(this,void 0),this.player=e,this.noCheckGameOver=t}reset(){this.score=0,this.health=0}get score(){return P(this,z)}set score(e){x(this,z,e)}get health(){return P(this,j)}set health(e){const t=this.isDowned;if(x(this,j,e),t)return;const s=this.player.team,r=this.player.game.teams;if(this.isDowned&&!this.noCheckGameOver&&0===s.elimOrder&&s.members.every(e=>e.status.noCheckGameOver||e.status.isDowned)){const e=1+r.filter(e=>e.elimOrder!==R.ElimOrder.STANDING).length;s.elimOrder=1+r.filter(e=>e.elimOrder!==R.ElimOrder.STANDING&&e.elimOrder!==R.ElimOrder.IMMORTAL).length,e===r.length&&this.player.game.statusBecomeOver()}}get isDowned(){return this.health<0}}z=new WeakMap,j=new WeakMap,Object.freeze(G),Object.freeze(G.prototype);class D extends A{constructor(e,t){if(super(e,t),!D.Username.REGEXP.test(t.username))throw new RangeError(`Username "${t.username}" does not match the required regular expression, "${D.Username.REGEXP.source}".`);this.familyId=t.familyId,this.teamId=t.teamId,this.username=t.username}reset(e){super.reset(e),this.status.reset(),this.lastAcceptedRequestId=y.INITIAL_REQUEST_ID,this.requestInFlight=!1}__abstractNotifyThatGameStatusBecamePlaying(){}__abstractNotifyThatGameStatusBecamePaused(){}__abstractNotifyThatGameStatusBecameOver(){}makeMovementRequest(e){if(this.game.status!==r.Status.PLAYING)throw new Error("This is not a necessary precondition, but we're doing it anyway.");if(this.requestInFlight)throw new Error("Only one request should ever be in flight at a time.");this.requestInFlight=!0,this.game.processMoveRequest(new y.Movement(this.playerId,this.lastAcceptedRequestId,e))}get team(){return this.game.teams[this.teamId]}isTeamedWith(e){return this.team.members.includes(e)}}!function(e){let t,s;!function(e){e.REGEXP=/[a-zA-Z](?:[ ]?[a-zA-Z0-9:-]+?){4,}/}(t=e.Username||(e.Username={})),function(e){e.finalize=(e,t)=>{const s=Array.from(new Set(e.map(e=>e.teamId))).sort((e,t)=>e-t).reduce((e,t,s)=>(e[t]=s,e),[]);return e.sort((e,t)=>s[e.teamId]-s[t.teamId]).map((e,r)=>({playerId:r,familyId:e.familyId,teamId:s[e.teamId],socketId:e.socketId,username:e.username,langName:t,noCheckGameOver:e.noCheckGameOver}))}}(s=e.CtorArgs||(e.CtorArgs={})),Object.freeze(s)}(D||(D={})),Object.freeze(D),Object.freeze(D.prototype);var B,k,F,U=function(e,t,s){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,s),s},W=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};class V extends D{constructor(e,t){super(e,t),B.set(this,void 0),this.langRemappingFunc=T.RemappingFunctions[t.langName]}reset(e){super.reset(e),U(this,B,"")}processKeyboardInput(e){if(this.game.status===r.Status.PLAYING&&!this.requestInFlight){if(1!==e.key.length)return;this.seqBufferAcceptKey(e.key)}}seqBufferAcceptKey(e){const t=this.tile.destsFrom().unoccupied.get;if(0!==t.length)if(e){if(e=this.langRemappingFunc(e),T.Seq.REGEXP.test(e)){for(let s=this.seqBuffer+e;s.length;s=s.substring(1)){const e=t.find(e=>e.langSeq.startsWith(s));if(e)return U(this,B,s),void(e.langSeq===s&&this.makeMovementRequest(e))}U(this,B,""),this.hostTile.visualBell()}}else{t.find(e=>e.langSeq.startsWith(this.seqBuffer))||U(this,B,"")}}moveTo(e){U(this,B,""),super.moveTo(e)}get seqBuffer(){return W(this,B)}}B=new WeakMap,Object.freeze(V),Object.freeze(V.prototype);class K extends G{constructor(e,t){super(e,t);{const e=document.createElement("div");e.classList.add(a.a.Player.Class.BASE,a.a.General.Class.FILL_PARENT),this.baseElem=e}if(this.player instanceof V){const e=document.createElement("div");e.classList.add(a.a.Grid.Class.SPOTLIGHT),this.baseElem.appendChild(e)}{const e=document.createElement("div");e.classList.add(a.a.Player.Class.DOWNED_OVERLAY,a.a.General.Class.FILL_PARENT),this.baseElem.appendChild(e)}}set score(e){super.score=e}set health(e){const t=this.isDowned;if(super.health=e,t!==this.isDowned){const e=a.a.Player.Dataset.DOWNED;this.isDowned?this.player.team.elimOrder?this.baseElem.dataset[e]="team":this.baseElem.dataset[e]="self":this.baseElem.dataset[e]="no"}}}(K||(K={})).colourizeTeamMembers=function(e,t){for(const s of e)for(const e of s.members)e.status.baseElem.dataset[a.a.Player.Dataset.FACE_SWATCH]=e===t?"me":e.teamId===t.teamId?"teammate":"opponent"},Object.freeze(K),Object.freeze(K.prototype);class Y extends D{constructor(e,t){if(super(e,t),e.gameType===r.Type.ONLINE)throw new TypeError("OnlineGames should be using regular Players instead.")}__abstractNotifyThatGameStatusBecamePlaying(){this.movementContinueWithInitialDelay()}__abstractNotifyThatGameStatusBecamePaused(){this.game.cancelTimeout(this.scheduledMovementCallbackId),this.scheduledMovementCallbackId=void 0}__abstractNotifyThatGameStatusBecameOver(){this.game.cancelTimeout(this.scheduledMovementCallbackId),this.scheduledMovementCallbackId=void 0}movementContinue(){this.makeMovementRequest(this.game.grid.getUntToward(this.coord,this.computeDesiredDestination())),this.movementContinueWithInitialDelay()}movementContinueWithInitialDelay(){this.scheduledMovementCallbackId=this.game.setTimeout(this.movementContinue,this.computeNextMovementTimer())}}(k=Y||(Y={})).of=(e,t)=>new k.__Constructors[t.familyId](e,t),function(e){class t extends T{constructor(){super(t,Object.entries(r).reduce((e,t)=>{const s=t[0],r=t[0],i=t[1];return e[s]={seq:r,weight:i},e},{}))}static getName(){return T.Names.ENGLISH__LOWERCASE}static getBlurb(){return""}static getInstance(){return this.SINGLETON||(this.SINGLETON=new t),this.SINGLETON}}t.SINGLETON=void 0,e.Lowercase=t,Object.seal(t),Object.freeze(t.prototype);class s extends T{constructor(){let e={};const t=t=>{e=Object.entries(r).reduce((e,s)=>{const r=t(s[0]),i=t(s[0]),a=s[1];return e[r]={seq:i,weight:a},e},e)};t(e=>e.toLowerCase()),t(e=>e.toUpperCase()),super(s,e)}static getName(){return T.Names.ENGLISH__MIXEDCASE}static getBlurb(){return""}static getInstance(){return this.SINGLETON||(this.SINGLETON=new s),this.SINGLETON}}s.SINGLETON=void 0,e.MixedCase=s,Object.seal(s),Object.freeze(s.prototype);const r=Object.freeze({a:8.167,b:1.492,c:2.202,d:4.253,e:12.702,f:2.228,g:2.015,h:6.094,i:6.966,j:.153,k:1.292,l:4.025,m:2.406,n:6.749,o:7.507,p:1.929,q:.095,r:5.987,s:6.327,t:9.356,u:2.758,v:.978,w:2.56,x:.15,y:1.994,z:.077})}(F||(F={})),Object.seal(F);var $,X,J,Q,Z,ee=function(e,t,s){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,s),s},te=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};class se{constructor(e,t,s){$.set(this,void 0),this.gameType=e;const r=this.__getGridImplementation(s.coordSys);this.grid=new r({gridClass:r,tileClass:t.tileClass,coordSys:s.coordSys,dimensions:s.gridDimensions,domParentHtmlIdHook:s.gridHtmlIdHook||"n/a"}),this.__playerStatusCtor=t.playerStatusCtor,this.players=this.createPlayers(s),void 0!==s.operatorIndex&&(this.operator=this.players[s.operatorIndex]);const i=[];if(this.players.forEach(e=>{i[e.teamId]||(i[e.teamId]=[]),i[e.teamId].push(e)}),this.teams=i.map((e,t)=>new R(t,e)),this.teams.every(e=>e.id===R.ElimOrder.IMMORTAL))throw new Error("All teams are immortal. The game will never end.")}reset(){this.grid.reset(),ee(this,$,r.Status.PAUSED)}createPlayers(e){return(e.playerDescs=this.gameType===r.Type.ONLINE?e.playerDescs:D.CtorArgs.finalize(e.playerDescs,e.languageName)).map((t,s)=>t.familyId===D.Family.HUMAN?s===e.operatorIndex?this.__createOperatorPlayer(t):new D(this,t):this.__createArtifPlayer(t))}serializeResetState(){const e=[],t=this.players.map(e=>e.coord),s=[];return this.grid.forEachTile(t=>{e.push({char:t.langChar,seq:t.langSeq}),t.freeHealth&&s.push({coord:t.coord,health:t.freeHealth})}),{csps:e,playerCoords:t,healthCoords:s}}deserializeResetState(e){{let t=0;this.grid.forEachTile(s=>{s.setLangCharSeqPair(e.csps[t++])})}e.playerCoords.forEach((e,t)=>{this.players[t].moveTo(this.grid.tile.at(e))}),e.healthCoords.forEach(e=>{this.grid.tile.at(e.coord).freeHealth=e.health})}get status(){return te(this,$)}statusBecomePlaying(){if(this.status!==r.Status.PAUSED)throw new Error("Can only resume a game that is currently paused.");this.players.forEach(e=>{e.__abstractNotifyThatGameStatusBecamePlaying()}),this.__abstractStatusBecomePlaying(),ee(this,$,r.Status.PLAYING),this.grid.baseElem&&this.grid.baseElem.focus()}statusBecomePaused(){if(this.status!==r.Status.PLAYING)throw new Error("Can only pause a game that is currently playing.");this.players.forEach(e=>{e.__abstractNotifyThatGameStatusBecamePaused()}),this.__abstractStatusBecomePaused(),ee(this,$,r.Status.PAUSED)}statusBecomeOver(){if(this.status!==r.Status.PLAYING)throw new Error("Can only end a game that is currently playing.");this.players.forEach(e=>{e.__abstractNotifyThatGameStatusBecameOver()}),this.__abstractStatusBecomeOver(),ee(this,$,r.Status.OVER)}__abstractStatusBecomePlaying(){}__abstractStatusBecomePaused(){}__abstractStatusBecomeOver(){}}$=new WeakMap,Object.freeze(se),Object.freeze(se.prototype);class re extends se{constructor(e,t,s){super(e,t,s),this.eventRecord=[]}reset(){this.eventRecord.splice(0),super.reset()}getNextUnusedEventId(){return this.eventRecord.length}recordEvent(e){const t=e.eventId;if(t===E.EVENT_ID_REJECT)throw new TypeError("Do not try to record events for rejected requests.");if(t<0||t!==Math.trunc(t))throw new RangeError("Event ID's must only be assigned positive, integer values.");if(this.eventRecord[t])throw new Error("Event ID's must be assigned unique values.");this.eventRecord[t]=e}executeTileModificationsEvent(e,t=!0){const s=this.grid.tile.at(e.coord);s.lastKnownUpdateId<e.lastKnownUpdateId&&(e.newCharSeqPair&&(s.setLangCharSeqPair(e.newCharSeqPair),t&&void 0!==this.operator&&!this.operator.tile.destsFrom().get.includes(s)&&this.operator.seqBufferAcceptKey("")),s.lastKnownUpdateId=e.lastKnownUpdateId,s.freeHealth=e.newFreeHealth)}processMoveExecute(e){const t=this.players[e.playerId],s=this.grid.tile.at(e.dest.coord),r=e.playerLastAcceptedRequestId-t.lastAcceptedRequestId;if(e.eventId!==E.EVENT_ID_REJECT)if(this.recordEvent(e),this.executeTileModificationsEvent(e.dest,t!==this.operator),e.tilesWithHealthUpdates.forEach(e=>{this.executeTileModificationsEvent(e)}),r>1){if(t===this.operator)throw new Error("This never happens. See comment in source.")}else{if(t.requestInFlight=!1,!(t===this.operator?1===r:r<=1))throw new Error("This never happens. See comment in source");t.status.score=e.newPlayerHealth.score,t.status.health=e.newPlayerHealth.health,t.moveTo(s),t.lastAcceptedRequestId=e.playerLastAcceptedRequestId}else 1===r&&(t.requestInFlight=!1)}processBubbleExecute(e){this.players[e.playerId].requestInFlight=!1,e.eventId!==E.EVENT_ID_REJECT&&this.recordEvent(e)}}Object.freeze(re),Object.freeze(re.prototype);class ie extends re{constructor(e,t,s){super(e,t,s),this.averageFreeHealth=s.averageFreeHealthPerTile*this.grid.area,this.lang=F.Lowercase.getInstance();const r=this.grid.static.getAmbiguityThreshold();if(this.lang.numLeaves<r)throw new Error(`Found ${this.lang.numLeaves} leaves, but at least ${r} were required. The provided mappings composing the current Lang-under-construction are not sufficient to ensure that a shuffling operation will always be able to find a safe candidate to use as a replacement. Please see the spec for Lang.getNonConflictingChar.`);this.langBalancingScheme=s.langBalancingScheme}reset(){super.reset(),this.currentFreeHealth=0,this.lang.reset(),this.grid.forEachTile(e=>{e.setLangCharSeqPair(this.dryRunShuffleLangCharSeqAt(e))}),this.teams.forEach(e=>e.reset());const e=this.grid.static.getSpawnCoords(this.players.length,this.grid.dimensions);this.players.forEach(t=>{t.reset(this.grid.tile.at(e[t.playerId]))})}dryRunShuffleLangCharSeqAt(e){e.setLangCharSeqPair(T.CharSeqPair.NULL);const t=Array.from(new Set(this.grid.tile.sourcesTo(e.coord).get.flatMap(e=>this.grid.tile.destsFrom(e.coord).get)));return this.lang.getNonConflictingChar(t.map(e=>e.langSeq).filter(e=>e),this.langBalancingScheme)}dryRunSpawnFreeHealth(){return[]}managerCheckGamePlayingRequest(e){if(this.status!==r.Status.PLAYING)return;const t=this.players[e.playerId];if(!t)throw new Error("No such player exists.");if(e.playerLastAcceptedRequestId!==t.lastAcceptedRequestId)throw new RangeError(e.playerLastAcceptedRequestId<t.lastAcceptedRequestId?"Clients should not make requests until they have received my response to their last request.":"Client seems to have incremented the request ID counter on their own, which is is illegal.");return t}processMoveRequest(e){const t=this.managerCheckGamePlayingRequest(e);if(!t)return void this.processMoveExecute(e);const s=this.grid.tile.at(e.dest.coord);s.isOccupied||s.lastKnownUpdateId!==e.dest.lastKnownUpdateId||(e.playerLastAcceptedRequestId=1+t.lastAcceptedRequestId,e.newPlayerHealth={score:t.status.score+s.freeHealth,health:t.status.health+s.freeHealth},e.dest.lastKnownUpdateId=1+s.lastKnownUpdateId,this.currentFreeHealth-=s.freeHealth,e.dest.newFreeHealth=0,e.dest.newCharSeqPair=this.dryRunShuffleLangCharSeqAt(s),e.tilesWithHealthUpdates=this.dryRunSpawnFreeHealth(),e.eventId=this.getNextUnusedEventId()),this.processMoveExecute(e)}processBubbleRequest(e){const t=this.managerCheckGamePlayingRequest(e);t?(e.playerLastAcceptedRequestId=1+t.lastAcceptedRequestId,e.eventId=this.getNextUnusedEventId(),this.processBubbleExecute(e)):this.processBubbleExecute(e)}}Object.freeze(ie),Object.freeze(ie.prototype);class ae extends ie{__getGridImplementation(e){return g.getImplementation(e)}constructor(e){if(super(r.Type.OFFLINE,{tileClass:I,playerStatusCtor:K},e),!this.operator)throw new Error("The Operator for an OfflineGame should be defined.");K.colourizeTeamMembers(this.teams,this.operator),this.reset(),this.grid.baseElem.addEventListener("keydown",e=>(this.operator.processKeyboardInput(e),32!==e.keyCode||(e.preventDefault(),!1)))}__createOperatorPlayer(e){return new V(this,e)}__createArtifPlayer(e){return Y.of(this,e)}setTimeout(e,t,...s){return setTimeout(e,t,s)}cancelTimeout(e){clearTimeout(e)}}Object.freeze(ae),Object.freeze(ae.prototype);class ne{constructor(e){this.static=e.gridClass,this.dimensions=e.dimensions,this.tile=new v(this)}get area(){return this.static.getArea(this.dimensions)}reset(){this.forEachTile(e=>e.reset())}check(){}__VisibleGrid_super(e,t){const s=a.a.Grid;t.classList.add(s.Class.IMPL_BODY);const r=document.getElementById(e.domParentHtmlIdHook);if(!r)throw new RangeError(`The ID "${e.domParentHtmlIdHook}" did not refer to an existing html element.`);r.dataset[s.Dataset.COORD_SYS]=e.coordSys,r.classList.add(s.Class.GRID,a.a.General.Class.TEXT_SELECT_DISABLED),r.querySelectorAll("."+s.Class.IMPL_BODY).forEach(e=>e.remove()),r.appendChild(t),t.tabIndex=0,this.baseElem=t;{let e=r.querySelector(":scope > ."+s.Class.KBD_DC_ICON);e||(e=document.createElement("div"),e.classList.add(s.Class.KBD_DC_ICON),e.innerText="(click grid to continue typing)",r.appendChild(e))}}}(X=ne||(ne={})).getImplementation=e=>X.__Constructors[e],function(e){class t extends i.Abstract.Mathy{constructor(e){super(e),this.x=e.x,this.y=e.y,Object.freeze(this)}equals(e){return this.x===e.x&&this.y===e.y}round(){return new t({x:Math.round(this.x),y:Math.round(this.y)})}oneNorm(e){return this.sub(e).originOneNorm()}originOneNorm(){return Math.abs(this.x)+Math.abs(this.y)}infNorm(e){return this.sub(e).originInfNorm()}originInfNorm(){return Math.max(Math.abs(this.x),Math.abs(this.y))}axialAlignment(e){return this.sub(e).originAxialAlignment()}originAxialAlignment(){return Math.abs(Math.abs(this.x)-Math.abs(this.y))/(Math.abs(this.x)+Math.abs(this.y))}add(e){return new t({x:this.x+e.x,y:this.y+e.y})}sub(e){return new t({x:this.x-e.x,y:this.y-e.y})}mul(e){return new t({x:e*this.x,y:e*this.y})}}e.Coord=t,Object.freeze(t),Object.freeze(t.prototype);class s extends ne{constructor(e){super(e);const s=[];for(let r=0;r<this.dimensions.height;r++){const i=[];for(let s=0;s<this.dimensions.width;s++){const a=new e.tileClass(new t({x:s,y:r}));i.push(a)}s.push(i)}this.grid=s}static getAmbiguityThreshold(){return 24}static getSizeLimits(){return this.SIZE_LIMITS}forEachTile(e,t=this){this.grid.forEach(s=>s.forEach(t=>{e(t)},t),t)}getUntToward(e,t){const s=this.tile.destsFrom(e).unoccupied.get;if(!s.some(t=>t.coord.equals(e)))throw new Error("Caller code didn't break the upward occupancy link.");if(1===s.length)return s[0];s.sort((e,s)=>e.coord.oneNorm(t)-s.coord.oneNorm(t)).sort((e,s)=>e.coord.infNorm(t)-s.coord.infNorm(t));for(let e=1;e<s.length;e++)if(s[e].coord.infNorm(t)>s[0].coord.infNorm(t)){s.splice(e);break}if(1===s.length)return s[0];if(s[0].coord.x-e.x==0||s[0].coord.y-e.y==0){if(e.axialAlignment(e.sub(t))-.5>0)return s[0];s.shift()}return s[Math.floor(s.length*Math.random())]}__getTileAt(e){if(e.x<0||e.x>=this.dimensions.width||e.y<0||e.y>=this.dimensions.height)throw new RangeError("Out of bounds. No such tile exists.");return this.grid[e.y][e.x]}__getTileDestsFrom(e,t=1){let s=e.y-t,r=e.y+t+1,i=e.x-t,a=e.x+t+1;return s>=this.dimensions.height||r<0||i>=this.dimensions.width||a<0?[]:this.grid.slice(Math.max(0,s),Math.min(this.dimensions.height,r)).flatMap(e=>e.slice(Math.max(0,i),Math.min(this.dimensions.width,a)))}__getTileSourcesTo(e,t=1){return this.__getTileDestsFrom(e,t)}static getSpawnCoords(e,t){return[{x:0,y:0}]}static getArea(e){return e.height*e.width}static getRandomCoord(e){return new t(void 0)}}s.SIZE_LIMITS=Object.freeze({height:Object.freeze({min:11,max:51}),width:Object.freeze({min:11,max:51})}),e.Grid=s,function(e){e.Visible=class extends e{constructor(e){super(e);const t=document.createElement("div");t.style.setProperty("--euclid2-grid-width",this.dimensions.width.toString());for(const e of this.grid)for(const s of e)s.__addToDom(t);this.__VisibleGrid_super(e,t)}}}(s=e.Grid||(e.Grid={})),Object.freeze(s),Object.freeze(s.prototype)}(J||(J={})),Object.freeze(J),function(e){class t extends i.Abstract.Mathy{constructor(e){super(e),this.dash=e.dash,this.bash=e.bash,Object.freeze(this)}equals(e){return this.dash===e.dash&&this.bash===e.bash}round(){const e=Math.floor(this.dash),s=Math.floor(this.bash),r=e-this.dash,i=s-this.bash;return r>2*i?new t({dash:e+1,bash:s}):r<.5*i?new t({dash:e,bash:s+1}):Math.min(r,i)>.5?new t({dash:e+1,bash:s+1}):new t({dash:e,bash:s})}add(e){return new t({dash:this.dash+e.dash,bash:this.bash+e.bash})}sub(e){return new t({dash:this.dash-e.dash,bash:this.bash-e.bash})}mul(e){return new t({dash:e*this.dash,bash:e*this.bash})}}e.Coord=t,Object.freeze(t),Object.freeze(t.prototype);class s extends ne{constructor(e){super(e)}static getAmbiguityThreshold(){return 18}static getSizeLimits(){return this.SIZE_LIMITS}forEachTile(e,t=this){this.grid.forEach(s=>s.forEach(t=>{e(t)},t),t)}getUntToward(e,t){}__getTileAt(e){}__getTileDestsFrom(e){}__getTileSourcesTo(e){}static getSpawnCoords(e,t){}static getArea(e){const t=Math.min(e.fslash,e.bslash),s=Math.max(e.fslash,e.bslash),r=-1+e.dash+t;let i=2*t*(e.dash+r);return i+=(s-t-1)*r,i}static getRandomCoord(e){return new t(void 0)}}s.SIZE_LIMITS=Object.freeze({dash:Object.freeze({min:10,max:50}),bslash:Object.freeze({min:10,max:50}),fslash:Object.freeze({min:10,max:50})}),e.Grid=s,function(e){e.Visible=class extends e{constructor(e){super(e);this.__VisibleGrid_super(e,void 0)}}}(s=e.Grid||(e.Grid={})),Object.freeze(s),Object.freeze(s.prototype)}(Q||(Q={})),Object.freeze(Q);class oe extends Y{constructor(e,t){super(e,t)}computeDesiredDestination(){}computeNextMovementTimer(){}}Object.freeze(oe),Object.freeze(oe.prototype),function(e){function t(){ne.__Constructors=Object.freeze({EUCLID2:J.Grid,BEEHIVE:Q.Grid}),Object.freeze(ne),Object.freeze(ne.prototype);{const e=g;e.__Constructors=Object.freeze({EUCLID2:J.Grid.Visible,BEEHIVE:Q.Grid.Visible}),Object.freeze(e)}{const e=Y;e.__Constructors=Object.freeze({CHASER:oe}),Object.freeze(e),Object.freeze(e.prototype)}}e.INIT_CLASS_REGISTRIES=t,Object.freeze(t)}(Z||(Z={})),Object.freeze(Z),s(4),Z.INIT_CLASS_REGISTRIES();const he=new ae({coordSys:"EUCLID2",gridDimensions:{height:21,width:21},gridHtmlIdHook:a.a.Grid.Id.GRID,averageFreeHealthPerTile:1/70,langBalancingScheme:n.a.BalancingScheme.WEIGHT,languageName:"engl-low",operatorIndex:0,playerDescs:[{familyId:"HUMAN",teamId:0,socketId:void 0,username:"hello world",noCheckGameOver:!1}]});he.statusBecomePlaying()}}]);
//# sourceMappingURL=index.js.map
(self.webpackChunkcapswalk=self.webpackChunkcapswalk||[]).push([[622],{549:(t,e,s)=>{"use strict";s.d(e,{r:()=>i});var r=s(929);class i{constructor(t){Object.freeze(t),this.static=t.Grid,this.dimensions=t.dimensions,this.area=t.Grid.getArea(t.dimensions),r.R.propNoWrite(this,"static","dimensions")}reset(){this.forEach((t=>{this.write(t.coord,{char:"",seq:""})}))}renderChangeOperatedPlayer(t,e,s){}getAllAltDestsThan(t){const e=new Map;return this.tileSourcesTo(t).flatMap((t=>this.tileDestsFrom(t.coord))).forEach((t=>{e.has(t.coord)||e.set(t.coord,t)})),Array.from(e.values()).freeze()}getRandomCoord(){return this.static.getRandomCoord(this.dimensions)}static getSpawnCoords(t,e){const s=new Set;return t.map((t=>{const r=[];for(;t>0;){let i;do{i=this.getRandomCoord(e)}while(s.has(i));r.push(i),s.add(i),t--}return r.freeze()})).freeze()}}Object.freeze(i),Object.freeze(i.prototype)},817:(t,e,s)=>{"use strict";s.d(e,{v:()=>r});var r,i=s(929),o=s(549);class a{constructor(t){this.dash=t.dash,this.bash=t.bash,Object.freeze(this)}toCoord(){}round(){const t=Math.floor(this.dash),e=Math.floor(this.bash),s=t-this.dash,r=e-this.bash;return s>2*r?new a({dash:t+1,bash:e}):s<.5*r?new a({dash:t,bash:e+1}):Math.min(s,r)>.5?new a({dash:t+1,bash:e+1}):new a({dash:t,bash:e})}add(t){return new a({dash:this.dash+t.dash,bash:this.bash+t.bash})}sub(t){return new a({dash:this.dash-t.dash,bash:this.bash-t.bash})}mul(t){return new a({dash:t*this.dash,bash:t*this.bash})}}Object.freeze(a),Object.freeze(a.prototype),(t=>{const e=class extends o.r{constructor(t){super(t),this.grid=(void 0).freeze(),new.target===e&&Object.seal(this)}write(t,e){}moveEntity(t,e,s){}forEach(t){let e=0;for(const s of this.grid)for(const r of s)t(r,e++)}forEachShuffled(t){}getUntToward(t,e){}getUntAwayFrom(t,e){}getAllAltDestsThan(t){return this.tileDestsFrom(t,2)}getRandomCoordAround(t,e){}dist(t,e){}isOccupied(t){}tileAt(t){}tileDestsFrom(t,e=1){return[].freeze()}tileSourcesTo(t,e=1){return this.tileDestsFrom(t,e)}static getArea(t){const e=Math.min(t.fslash,t.bslash),s=Math.max(t.fslash,t.bslash),r=-1+t.dash+e;let i=2*e*(t.dash+r);return i+=(s-e-1)*r,i}static getLatticePatchDiameter(t){if(t<.25)throw new RangeError("determinant of a radical will be strictly negative.");return 1+(-3+Math.sqrt(9-12*(1-t)))/6*2}static getRandomCoord(t){return new a(void 0).toCoord()}};let s=e;s.ambiguityThreshold=18,s.sizeLimits=i.R.deepFreeze({dash:{min:10,max:50},bslash:{min:10,max:50},fslash:{min:10,max:50}}),t.Grid=s,s.prototype.tileSourcesTo=s.prototype.tileDestsFrom,i.R.protoNoEnum(s,"tileAt","tileDestsFrom","tileSourcesTo"),Object.freeze(s),Object.freeze(s.prototype)})(r||(r={})),Object.freeze(r)},387:(t,e,s)=>{"use strict";s.d(e,{p:()=>h,K:()=>r});var r,i=s(929),o=s(549),a=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},n=(t,e,s)=>(a(t,e,"read from private field"),s?s.call(t):e.get(t));class h{constructor(t,e){this.x=t,this.y=e,Object.freeze(this)}static from(t,e){return new h(e%t.width,e/t.width|0)}toCoord(t){return this.y*t.width+this.x}static distX(t,e,s){const r=Math.abs(e.x-s.x);return r<t.width/2?r:t.width-r}static distY(t,e,s){const r=Math.abs(e.y-s.y);return r<t.height/2?r:t.height-r}static oneNorm(t,e,s){return h.distX(t,e,s)+h.distY(t,e,s)}static infNorm(t,e,s){const r=h.distX(t,e,s),i=h.distY(t,e,s);return Math.max(r,i)}static wrapInfo(t,e,s){return Object.freeze({x:Math.abs(s.x-e.x)<t.width/2?0:s.x<e.x?-1:1,y:Math.abs(s.y-e.y)<t.height/2?0:s.y<e.y?-1:1})}static axialAlignment(t,e,s){const r=h.from(t,e),i=h.from(t,s),o=h.distX(t,r,i),a=h.distY(t,r,i);return Math.abs(o-a)/(o+a)}add(t){return new h(this.x+t.x,this.y+t.y)}sub(t){return new h(this.x-t.x,this.y-t.y)}iSub(t){return this.add(this.sub(t))}mul(t){return new h(t*this.x,t*this.y)}mod(t){let{x:e,y:s}=this;for(;e<0;)e+=t.width;for(;s<0;)s+=t.height;return e%=t.width,s%=t.height,new h(e,s)}}Object.freeze(h),Object.freeze(h.prototype),(t=>{var e;const s=class extends o.r{constructor(t){var r,o,n;super(t),((t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,void 0)})(this,e),r=this,o=e,n=new Uint8Array(this.area),a(r,o,"write to private field"),o.set(r,n);const c=[];for(let t=0;t<this.dimensions.height;t++)for(let e=0;e<this.dimensions.width;e++)c.push({coord:t*this.dimensions.width+e,seq:""});this._grid=c.seal();const d=[];for(let e=0;e<t.dimensions.height;e++)for(let s=0;s<t.dimensions.width;s++)d.push(new h(s,e));this.iacCache=d.freeze(),i.R.instNoEnum(this,"iacCache"),i.R.propNoWrite(this,"_grid","iacCache"),new.target===s&&Object.seal(this)}reset(){super.reset(),n(this,e).fill(0)}write(t,e){this._grid[t]=Object.freeze(Object.assign({},this._grid[t],e))}moveEntity(t,s,r){n(this,e)[s]=0,n(this,e)[r]=1}forEach(t){for(let e=0;e<this.area;e++)t(this._grid[e],e)}forEachShuffled(t){const e=new Uint16Array(this.area);for(let t=0;t<this.area;t++)e[t]=t;e.sort((()=>Math.random()-.5));for(const s of e)t(this._grid[s],s)}getUntToward(t,e){const s=this.tileDestsFrom(e).filter((t=>!this.isOccupied(t.coord))).map((e=>{const s=this.iacCache[e.coord],r=this.iacCache[t];return{tile:e,iac:s,infNorm:h.infNorm(this.dimensions,s,r),oneNorm:h.oneNorm(this.dimensions,s,r)}}));if(0===s.length)return e;s.sort(((t,e)=>t.infNorm-e.infNorm)),s.length=3,s.sort(((t,e)=>t.oneNorm-e.oneNorm));const r=s[0];for(let t=1;t<s.length;t++)if(s[t].infNorm>r.infNorm){s.splice(t);break}if(1===s.length)return r.tile.coord;if(r.infNorm===r.oneNorm){if(h.axialAlignment(this.dimensions,e,t)>.5)return r.tile.coord;s.shift()}return s[s.length*Math.random()|0].tile.coord}getUntAwayFrom(t,e){const s=this.iacCache[t];return this.iacCache[e].iSub(s).mod(this.dimensions).toCoord(this.dimensions)}getAllAltDestsThan(t){return this.tileDestsFrom(t,2)}getRandomCoordAround(t,e){const s=this.iacCache[t];return new h(s.x+(2*e*(Math.random()-.5)|0),s.y+(2*e*(Math.random()-.5)|0)).mod(this.dimensions).toCoord(this.dimensions)}dist(t,e){return h.infNorm(this.dimensions,this.iacCache[t],this.iacCache[e])}isOccupied(t){return 0!==n(this,e)[t]}tileAt(t){return this._grid[t]}tileDestsFrom(t,e=1){const s=this.iacCache[t];let r=!1,i=!1;const o=this.dimensions.width,a=this.dimensions.height;let n=s.y-e;n<0&&(n+=a,i=!0);let h=s.x-e;h<0&&(h+=o,r=!0);let c=s.y+e+1;c>a&&(c-=a,i=!0);let d=s.x+e+1;d>o&&(d-=o,r=!0);const l=[];if(r){const t=n*o;l.push(...this._grid.slice(t,t+d).freeze()),i&&l.push(...this._grid.slice(0,d).freeze())}const p=i?a:c,f=2*e+1;for(let t=n;t<p;t++){const e=t*o+h;l.push(...this._grid.slice(e,e+f).freeze())}if(r&&!i&&c!==a&&(l.length-=d),i){for(let t=0;t<c;t++){const e=t*o+h;l.push(...this._grid.slice(e,e+f).freeze())}r&&(l.length-=d)}return l.freeze()}tileSourcesTo(t,e=1){return this.tileDestsFrom(t,e)}static getArea(t){return t.height*t.width}static getLatticePatchDiameter(t){return Math.sqrt(t)}static getRandomCoord(t){const e=t.width*Math.random()|0;return(t.height*Math.random()|0)*t.width+e}_assertSomeInvariants(){const t=this._grid.map(((t,e)=>({i:e,arr:this.getAllAltDestsThan(t.coord).map((t=>t.coord)).sort().freeze()}))).filter((t=>25!==t.arr.length)).freeze();if(t.length)throw console.error(t),new Error("never")}};let r=s;e=new WeakMap,r.ambiguityThreshold=24,r.sizeLimits=i.R.deepFreeze({height:{min:5,max:51},width:{min:5,max:51},_render:void 0}),t.Grid=r,r.prototype.tileSourcesTo=r.prototype.tileDestsFrom,i.R.protoNoEnum(r,"tileAt","tileDestsFrom","tileSourcesTo"),Object.freeze(r),Object.freeze(r.prototype)})(r||(r={})),Object.freeze(r)},496:(t,e,s)=>{"use strict";s.d(e,{S:()=>y});var r,i,o,a,n,h=s(929),c=s(315),d=s(31),l=s(986),p=s(34),f=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},u=(t,e,s)=>(f(t,e,"read from private field"),s?s.call(t):e.get(t)),m=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},g=(t,e,s,r)=>(f(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s);class y{constructor(t){m(this,a),m(this,r,void 0),m(this,i,void 0),m(this,o,void 0);const{impl:e,desc:s,clientPlayerIds:c}=t;Object.freeze(s),Object.freeze(s.players),s.players.forEach((t=>Object.freeze(t))),Object.freeze(c);const l=d.U.GetDesc(t.desc.langId),u=e.gridClassLookup(s.coordSys);this.grid=new u({Grid:u,system:s.coordSys,dimensions:s.gridDimensions,langCharFontScaling:l.fontZoom,players:s.players}),g(this,r,e.onGameBecomeOver);const y=(this,w=a,b=n,f(this,w,"access private method"),b).call(this,s,e,c,l);var w,b;this.players=y.players,this.clientPlayers=y.client;{const t=[];this.players.forEach((e=>{t[e.teamId]||(t[e.teamId]=[]),t[e.teamId].push(e)})),this.teams=t.map(((t,e)=>new p.S(e,t)))}h.R.propNoWrite(this,"grid","players","clientPlayers","teams"),this.players.forEach((t=>t._onTeamsBootstrapped())),this.setCurrentClientPlayer(0)}reset(){this.grid.reset(),g(this,o,c.l.Status.PAUSED)}deserializeResetState(t){h.R.deepFreeze(t),this.grid.forEach(((e,s)=>{this.grid.write(e.coord,t.csps[s])})),t.playerCoords.forEach(((t,e)=>{this.players[e].reset(t)}))}get currentClientPlayer(){return u(this,i)}setCurrentClientPlayer(t){var e;const s=this.clientPlayers[t];if(void 0===s)throw new Error("never");this.currentClientPlayer!==s&&(this.grid.renderChangeOperatedPlayer(s.playerId,s.coord,null==(e=u(this,i))?void 0:e.coord),g(this,i,s))}get status(){return u(this,o)}statusBecomePlaying(){if(this.status!==c.l.Status.PLAYING){if(this.status!==c.l.Status.PAUSED)throw new Error("Can only resume a game that is currently paused.");this.players.forEach((t=>{t.onGamePlaying()})),g(this,o,c.l.Status.PLAYING)}else console.info("[statusBecomePlaying]: Game is already playing")}statusBecomePaused(){this.status!==c.l.Status.PAUSED?this.status!==c.l.Status.OVER&&(this.players.forEach((t=>{t.onGamePaused()})),g(this,o,c.l.Status.PAUSED)):console.info("[statusBecomePaused]: Game is already paused")}statusBecomeOver(){this.status!==c.l.Status.OVER&&(this.players.forEach((t=>{t.onGameOver()})),g(this,o,c.l.Status.OVER),u(this,r).call(this),console.info("game is over!"))}commitTileMods(t,e){if(void 0!==e.seq){const e=this.grid.tileSourcesTo(t);this.clientPlayers.forEach((t=>{e.some((e=>e.coord===t.coord))&&t.seqBufferAcceptKey(void 0)}))}this.grid.write(t,e)}commitStateChange(t,e){h.R.deepFreeze(t);const s=this.players[t.author];if(void 0===t.rejectId){s.reqBuffer.acceptOldest();for(const[e,s]of Object.entries(t.tiles).freeze())this.commitTileMods(parseInt(e),s);for(const[e,s]of Object.entries(t.players).freeze()){const t=this.players[parseInt(e)];if(t.boosts=s.boosts,void 0!==s.coord){const e=t.coord;this.grid.moveEntity(t.playerId,e,s.coord),t._setCoord(s.coord)}}}else s.reqBuffer.reject(t.rejectId,s.coord)}setTimeout(t,e,...s){return setTimeout(t,e,s)}cancelTimeout(t){clearTimeout(t)}}r=new WeakMap,i=new WeakMap,o=new WeakMap,a=new WeakSet,n=function(t,e,s,r){const i=t.players.map((t=>t.familyId===l.J.Family.Human?s.includes(t.playerId)?new e.ClientPlayer(this,t,r):new l.J(this,t):e.RobotPlayer(this,t))).freeze();return Object.freeze({players:i,client:s.map((t=>i[t])).freeze()})},Object.freeze(y),Object.freeze(y.prototype)},314:(t,e,s)=>{"use strict";s.d(e,{r:()=>l});var r,i,o=s(315),a=s(986),n=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},h=(t,e,s)=>(n(t,e,"read from private field"),s?s.call(t):e.get(t)),c=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},d=(t,e,s,r)=>(n(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s);class l extends a.J{constructor(t,e,s){super(t,e),c(this,r,void 0),c(this,i,void 0),Object.seal(this),d(this,i,s.remapFunc)}reset(t){super.reset(t),d(this,r,"")}get seqBuffer(){return h(this,r)}processKeyboardInput(t){return this.game.status!==o.l.Status.PLAYING||this.reqBuffer.isFull||(" "===t.key?this.coord!==this.prevCoord&&this.makeMovementRequest(this.game.grid.getUntAwayFrom(this.prevCoord,this.coord),a.J.MoveType.BOOST):1!==t.key.length||t.repeat||this.seqBufferAcceptKey(t.key)),this.seqBuffer}seqBufferAcceptKey(t){const e=this.game.grid.tileDestsFrom(this.reqBuffer.predictedCoord).filter((t=>!this.game.grid.isOccupied(t.coord))).freeze();if(0!==e.length)if(void 0!==t){t=h(this,i).call(this,t);for(let s=this.seqBuffer+t;s.length;s=s.substring(1)){const t=e.find((t=>t.seq.startsWith(s)));if(void 0!==t)return d(this,r,s),void(t.seq===s&&this.makeMovementRequest(t.coord,"NORMAL"))}d(this,r,"")}else e.find((t=>t.seq.startsWith(this.seqBuffer)))||d(this,r,"")}_setCoord(t){d(this,r,""),super._setCoord(t)}}r=new WeakMap,i=new WeakMap,Object.freeze(l),Object.freeze(l.prototype)},31:(t,e,s)=>{"use strict";s.d(e,{U:()=>g});var r,i,o,a,n=s(929),h=s(173),c=s(248),d=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},l=(t,e,s)=>(d(t,e,"read from private field"),s?s.call(t):e.get(t)),p=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},f=(t,e,s,r)=>(d(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s);const u=new Map,m=class extends h.Uo{constructor(t,e){super(),p(this,r,void 0),p(this,i,void 0),p(this,o,void 0),p(this,a,void 0),this.desc=m.GetDesc(t),this.csps=u.has(t)?u.get(t):(()=>{const e=Object.getPrototypeOf(this).constructor.BUILD(),s=m.CreateCspsArray(e);return u.set(t,s),s})(),f(this,r,this.csps.length),n.R.propNoWrite(this,"desc","csps");{const t=m.GetWeightScalingFn(e,this.desc.avgWeight);f(this,i,Float32Array.from(this.csps.map((e=>t(e.unscaledWt)))))}f(this,o,new Float64Array(l(this,r))),f(this,a,new Uint16Array(l(this,r)+1)),Object.seal(this)}reset(){for(let t=0;t<l(this,o).length;t++)l(this,o)[t]=Math.random()*m.RESET_NUM_HITS/this.desc.avgWeight;const t=[];l(this,o).forEach(((e,s)=>{t.push(Object.freeze({_hits:e,cspsIndex:s}))})),t.push({_hits:1/0,cspsIndex:l(this,r)}),t.seal().sort(((t,e)=>t._hits-e._hits)).freeze();{let e=l(this,a)[l(this,r)]=t[0].cspsIndex;for(let s=1;s<t.length;s++)e=l(this,a)[e]=t[s].cspsIndex}}getNonConflictingChar(t){t=t.filter((t=>t)).freeze();const e=l(this,a);for(let s=e[l(this,r)],a=l(this,r);s!==l(this,r);a=s,s=e[s]){const n=this.csps[s];if(!t.some((t=>m.EitherPrefixesOther(t,n.seq)))){l(this,o)[s]+=1/l(this,i)[s];let t=s;for(;e[t]!==l(this,r)&&l(this,o)[s]>l(this,o)[e[t]];)t=e[t];return t!==s&&(e[a]=e[s],e[s]=e[t],e[t]=s),n}}throw new Error("never")}_assertInvariants(){const t=[];for(let e=0;e<l(this,r);e++)t[e]=!1;t.seal();let e=l(this,a)[l(this,r)],s=0;for(let i=0;i<l(this,r);i++){if(l(this,o)[e]<s)throw new Error("lang hits should be ascending");s=l(this,o)[e],t[e]=!0,e=l(this,a)[e]}if(e!==l(this,r))throw new Error("lang next should end by looping back");if(t.some((t=>!1===t)))throw new Error("lang next should be an exhaustive loop")}_calcIsolatedMinOpts(){const t=[];this.csps.forEach((e=>{t[t.length-1]!==e.seq&&t.push(e.seq)})),t.freeze();const e=[];for(const s of[...t].seal().reverse().freeze())e.some((t=>t.startsWith(s)))||e.push(s);e.freeze();const s=[];for(const e of t)s.some((t=>t.startsWith(e)))||s.push(e);s.freeze();const r=new Map;return s.forEach((t=>r.set(t,0))),e.forEach((t=>{for(const e of s)if(t.startsWith(e)){r.set(e,r.get(e)+1);break}})),[...r.values()].sort(((t,e)=>t-e)).slice(0,-1).reduce(((t,e)=>t+e),0)}};let g=m;r=new WeakMap,i=new WeakMap,o=new WeakMap,a=new WeakMap,(t=>{function e(t){return c.b[t]}async function r(t){const e=c.b[t],r=await s(59)(`./${e.module}.ts`);return e.export.split(".").reduce(((t,e)=>t[e]),r[e.module])}function i(t,e){return 0===t?i.UNIFORM:1===t?i.IDENTITY:s=>Math.pow(s/e,t)}var o;function a(t){return Object.entries(t).freeze().map((([t,{seq:e,weight:s}])=>Object.freeze({char:t,seq:e,unscaledWt:s}))).seal().sort(((t,e)=>e.unscaledWt-t.unscaledWt)).freeze()}let n;t.GetDesc=e,Object.freeze(e),t.Import=r,Object.freeze(r),t.GetWeightScalingFn=i,(o=i=t.GetWeightScalingFn||(t.GetWeightScalingFn={})).UNIFORM=function(){return 1},o.IDENTITY=function(t){return t},Object.freeze(i),t.CreateCspsArray=a,Object.freeze(a),t.RESET_NUM_HITS=10,t.EitherPrefixesOther=function(t,e){return t.length>e.length?t.startsWith(e):e.startsWith(t)},(t=>{function e(t){return Object.entries(t).freeze().reduce(((t,[e,s])=>(t[e]={seq:e,weight:s},t)),{})}t.WORD_FOR_WORD=e,Object.freeze(e)})(n=t.BuildUtils||(t.BuildUtils={}))})(g||(g={})),Object.freeze(g),Object.freeze(g.prototype)},467:(t,e,s)=>{"use strict";s.d(e,{t:()=>z});var r,i=s(929),o=s(254),a=s(824);(r||(r={}))._mkExtensionProps=function(t){t.setAttribute("role","presentation"),t.translate=!1,t.spellcheck=!1;const e=i.R.html("div");e.setAttribute("role","presentation");const s=e.attachShadow({mode:"closed"});return t.classList.add(a.Z["impl-body"]),s.appendChild(t),i.R.Web.adoptStyleSheet(s,"css-common.css"),i.R.Web.adoptStyleSheet(s,"chunk/game-css.css"),Object.freeze({baseElem:e})},Object.freeze(r);var n,h,c=s(387),d=s(741),l=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},p=(t,e,s)=>(l(t,e,"read from private field"),s?s.call(t):e.get(t)),f=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},u=(t,e,s,r)=>(l(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s);const m=Object.freeze({tilePattern:"tile-pattern",spotlightGradient:"spotlight-gradient",spotlightMask:"spotlight-mask"});function g(t,e){for(const s in e)t.setAttribute(s,e[s])}const y=[[0,0],[1,0],[0,1],[1,1]].freeze();function w(t,e){const s=i.R.svg("g",[d.Z.player]);return o.s.Local.moreAnimations&&s.classList.add(d.Z["animated-entity"]),y.forEach((r=>{const a=function(t){const e=i.R.svg("g");switch(g(e,{height:1,width:1,viewBox:"0,0,1,1"}),o.s.Local.emojiFont){case"system":{const s=i.R.svg("text",[d.Z.char],{textContent:t.avatar});g(s,{x:.5,y:.5}),e.appendChild(s);break}case"twemoji":{const s=[...t.avatar].map((t=>t.codePointAt(0).toString(16))).slice(0,-1).join("-"),r=i.R.svg("image");g(r,{href:`https://twemoji.maxcdn.com/v/latest/svg/${s}.svg`,height:1,width:1,alt:t.avatar}),e.appendChild(r);break}default:throw new Error("never")}return e}(e);a.setAttribute("transform",`translate(${r[0]*t.width} ${r[1]*t.height})`),s.appendChild(a)})),s}class b extends c.K.Grid{constructor(t){super(t),f(this,n,0),f(this,h,void 0),this.moreAnimations=o.s.Local.moreAnimations;const e=t.dimensions,s="number"==typeof e._render.wrapX?e._render.wrapX:0,a="number"==typeof e._render.wrapY?e._render.wrapY:0,c=i.R.html("div");{const r=i.R.svg("svg",[d.Z.grid]);g(r,{height:2.6/((t.langCharFontScaling-1)/2+1)*e.height+"em",width:2.6/((t.langCharFontScaling-1)/2+1)*e.width+"em",viewBox:`${e.width/2-s}, ${e.height/2-a},\n\t\t\t\t\t${2*s+e.width}, ${2*a+e.height}`}),r.appendChild(function(){const t=i.R.svg("defs"),e=i.R.svg("pattern");g(e,{id:m.tilePattern,patternUnits:"userSpaceOnUse",height:"1",width:"1",viewBox:"0,0,1,1"});const s=i.R.svg("rect",[d.Z.tile]);return g(s,{height:.8,width:.8,x:.1,y:.1,rx:.1}),e.appendChild(s),t.appendChild(e),t}());{const t=i.R.svg("rect");g(t,{height:"100%",width:"100%",x:""+(e.width/2-s),y:""+(e.height/2-a),fill:`url(#${m.tilePattern})`,role:"presentation"}),r.appendChild(t)}{const s=i.R.svg("g",[d.Z.char]);{const t=[];this.forEach((r=>{const o=function(t,e){const{height:s,width:r}=e,o=[i.R.svg("text"),i.R.svg("text"),i.R.svg("text"),i.R.svg("text")].freeze();return g(o[0],{x:t.x+.5,y:t.y+.5}),g(o[1],{x:r+t.x+.5,y:t.y+.5}),g(o[2],{x:t.x+.5,y:s+t.y+.5}),g(o[3],{x:r+t.x+.5,y:s+t.y+.5}),o}(this.iacCache[r.coord],e);t.push(o),s.append(...o)})),u(this,h,t.freeze())}s.style.setProperty("--font-scaling",""+t.langCharFontScaling),r.appendChild(s)}c.appendChild(r)}{const t=c.firstElementChild.cloneNode();t.style.position="absolute",t.appendChild(function(t){const e=i.R.svg("defs");{const t=i.R.svg("radialGradient");t.id=m.spotlightGradient,t.append(...[{o:10,a:"F"},{o:40,a:"6"},{o:70,a:"1"},{o:100,a:"0"}].map((t=>{const e=i.R.svg("stop");return g(e,{offset:`${t.o}%`,"stop-color":`#000${t.a}`}),e}))),e.appendChild(t)}{const s=i.R.svg("mask");s.id=m.spotlightMask;{const e=i.R.svg("g",[d.Z.spotlight]);o.s.Local.moreAnimations&&e.classList.add(d.Z["animated-entity"]);{const s=i.R.svg("rect");g(s,{fill:"#FFF",height:""+3*t.height,width:""+3*t.width,x:""+-t.width,y:""+-t.width}),e.appendChild(s)}y.forEach((s=>{const r=i.R.svg("rect");g(r,{fill:`url(#${m.spotlightGradient})`,x:-7,y:-7,height:15,width:15}),r.setAttribute("transform",`translate(${s[0]*t.width} ${s[1]*t.height})`),e.appendChild(r)})),s.appendChild(e)}e.appendChild(s)}return e}(e));{const r=i.R.svg("rect");g(r,{fill:"var(--colour-mainBg)",mask:`url(#${m.spotlightMask})`,height:"100%",width:"100%",x:""+(e.width/2-s),y:""+(e.height/2-a)}),t.appendChild(r)}this.spotlight=t.getElementById(m.spotlightMask).getElementsByClassName(d.Z.spotlight).item(0),c.appendChild(t)}{const s=c.firstElementChild.cloneNode();s.style.position="absolute",this.players=t.players.map(w.bind(null,e)).freeze(),s.append(...this.players),c.appendChild(s)}Object.assign(this,r._mkExtensionProps(c)),Object.seal(this)}write(t,e){super.write(t,e),e.char&&p(this,h)[t].forEach((t=>t.textContent=e.char))}renderChangeOperatedPlayer(t,e,s){u(this,n,t),this.moveEntity(t,null!=s?s:0,e,!0)}moveEntity(t,e,s,r=!1){r||super.moveEntity(t,e,s);const i=this.players[t],o=this.dimensions,a=this.iacCache[e],h=this.iacCache[s],d=c.p.wrapInfo(o,a,h),l=t===p(this,n);if(this.moreAnimations&&(o._render.wrapX&&d.x||o._render.wrapY&&d.y)){const t=`translate(${a.x+o.width*d.x} ${a.y+o.height*d.y})`;i.style.transition="none",r||i.setAttribute("transform",t),l&&(this.spotlight.style.transition="none",this.spotlight.setAttribute("transform",t)),setTimeout((()=>{const t=`translate(${h.x} ${h.y})`;i.style.transition="",i.setAttribute("transform",t),l&&(this.spotlight.style.transition="",this.spotlight.setAttribute("transform",t))}),10)}else{const t=`translate(${h.x} ${h.y})`;i.setAttribute("transform",t),l&&this.spotlight.setAttribute("transform",t)}}}n=new WeakMap,h=new WeakMap,Object.freeze(b),Object.freeze(b.prototype);var v=s(817);class C extends v.v.Grid{constructor(t){super(t),Object.assign(this,r._mkExtensionProps(void 0)),Object.seal(this)}write(t,e){}}Object.freeze(C),Object.freeze(C.prototype);const O=Object.freeze({Euclid2:b,Beehive:C}),z=t=>O[t]},59:(t,e,s)=>{var r={"./Chinese.ts":[7,7,330],"./Emote.ts":[427,9,858],"./English.ts":[468,9,184],"./Japanese.ts":[855,9,410],"./Korean.ts":[55,9,227],"./Ngrams.ts":[805,9,273],"./Numpad.ts":[283,9,683],"./Shell.ts":[433,9,159],"./defs/Chinese.ts":[944,7,704],"./defs/English100.ts":[104,9,885]};function i(t){if(!s.o(r,t))return Promise.resolve().then((()=>{var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=r[t],i=e[0];return s.e(e[2]).then((()=>s.t(i,16|e[1])))}i.keys=()=>Object.keys(r),i.id=59,t.exports=i}}]);
//# sourceMappingURL=622.js.map
(self.webpackChunkcapswalk=self.webpackChunkcapswalk||[]).push([[5],{810:(t,e,s)=>{"use strict";s.d(e,{r:()=>a});var r,i=s(164),o=s(139);class a{constructor(t){Object.freeze(t),this.static=t.Grid,this.dimensions=t.dimensions,this.area=t.Grid.getArea(t.dimensions),i.R.propNoWrite(this,"static","dimensions")}reset(){this.forEach((t=>{this.write(t.coord,{occId:o.J5.Id.NULL,char:"",seq:"",health:0})}))}getAllAltDestsThan(t){return Array.from(new Set(this.tileSourcesTo(t).flatMap((t=>this.tileDestsFrom(t.coord)))))}getRandomCoord(){return this.static.getRandomCoord(this.dimensions)}static getSpawnCoords(t,e){const s=new Set;return t.map((t=>{const r=[];for(;t>0;){let i;do{i=this.getRandomCoord(e)}while(s.has(i));r.push(i),s.add(i),t--}return r.freeze()})).freeze()}}(r=a||(a={}))._Constructors={W_EUCLID2:void 0,BEEHIVE:void 0},r.getImplementation=t=>r._Constructors[t],Object.freeze(a),Object.freeze(a.prototype)},216:(t,e,s)=>{"use strict";s.d(e,{v:()=>r});var r,i=s(164),o=s(810);class a{constructor(t){this.dash=t.dash,this.bash=t.bash,Object.freeze(this)}toCoord(){}round(){const t=Math.floor(this.dash),e=Math.floor(this.bash),s=t-this.dash,r=e-this.bash;return s>2*r?new a({dash:t+1,bash:e}):s<.5*r?new a({dash:t,bash:e+1}):Math.min(s,r)>.5?new a({dash:t+1,bash:e+1}):new a({dash:t,bash:e})}add(t){return new a({dash:this.dash+t.dash,bash:this.bash+t.bash})}sub(t){return new a({dash:this.dash-t.dash,bash:this.bash-t.bash})}mul(t){return new a({dash:t*this.dash,bash:t*this.bash})}}Object.freeze(a),Object.freeze(a.prototype),function(t){const e=class extends o.r{constructor(t){super(t),this.grid=(void 0).freeze(),new.target===e&&Object.seal(this)}write(t,e){}forEach(t){let e=0;for(const s of this.grid)for(const r of s)t(r,e++)}forEachShuffled(t){}getUntToward(t,e){}getUntAwayFrom(t,e){}getAllAltDestsThan(t){return this.tileDestsFrom(t,2)}getRandomCoordAround(t,e){}dist(t,e){}tileAt(t){}tileDestsFrom(t,e=1){return[].freeze()}tileSourcesTo(t,e=1){}static getArea(t){const e=Math.min(t.fslash,t.bslash),s=Math.max(t.fslash,t.bslash),r=-1+t.dash+e;let i=2*e*(t.dash+r);return i+=(s-e-1)*r,i}static getLatticePatchDiameter(t){if(t<.25)throw new RangeError("determinant of a radical will be strictly negative.");return 1+(-3+Math.sqrt(9-12*(1-t)))/6*2}static getRandomCoord(t){return new a(void 0).toCoord()}};let s=e;s.ambiguityThreshold=18,s.SIZE_LIMITS=i.R.deepFreeze({dash:{min:10,max:50},bslash:{min:10,max:50},fslash:{min:10,max:50}}),s.sizeLimits=e.SIZE_LIMITS,t.Grid=s,i.R.protoNoEnum(s,"tileAt","tileDestsFrom","tileSourcesTo"),Object.freeze(s),Object.freeze(s.prototype)}(r||(r={})),Object.freeze(r)},33:(t,e,s)=>{"use strict";s.d(e,{K:()=>r});var r,i=s(164),o=s(810),a=s(139);class h{constructor(t,e){this.x=t,this.y=e,Object.freeze(this)}static from(t,e){return new h(e%t.width,Math.floor(e/t.width))}toCoord(t){return this.y*t.width+this.x}static distX(t,e,s){let r=Math.abs(e.x-s.x);return r<t.width/2?{dist:r,wrap:!1}:{dist:t.width-r,wrap:!0}}static distY(t,e,s){let r=Math.abs(e.y-s.y);return r<t.height/2?{dist:r,wrap:!1}:{dist:t.height-r,wrap:!0}}static oneNorm(t,e,s){const r=h.distX(t,e,s),i=h.distY(t,e,s);return{norm:r.dist+i.dist,wrapX:r.wrap,wrapY:i.wrap}}static infNorm(t,e,s){const r=h.distX(t,e,s),i=h.distY(t,e,s);return{norm:Math.max(r.dist,i.dist),wrapX:r.wrap,wrapY:i.wrap}}static axialAlignment(t,e,s){const r=h.from(t,e),i=h.from(t,s),o=h.distX(t,r,i),a=h.distY(t,r,i);return Math.abs(o.dist-a.dist)/(o.dist+a.dist)}add(t){return new h(this.x+t.x,this.y+t.y)}sub(t){return new h(this.x-t.x,this.y-t.y)}iSub(t){return this.add(this.sub(t))}mul(t){return new h(t*this.x,t*this.y)}mod(t){let{x:e,y:s}=this;for(;e<0;)e+=t.width;for(;s<0;)s+=t.height;return e%=t.width,s%=t.height,new h(e,s)}}Object.freeze(h),Object.freeze(h.prototype),function(t){const e=class extends o.r{constructor(t){super(t);const s=[];for(let t=0;t<this.dimensions.height;t++)for(let e=0;e<this.dimensions.width;e++){const r={coord:t*this.dimensions.width+e,occId:a.J5.Id.NULL,health:0,seq:""};s.push(r)}this._grid=s.seal();const r=[];for(let e=0;e<t.dimensions.height;e++)for(let s=0;s<t.dimensions.width;s++)r.push(new h(s,e));this.iacCache=r.freeze(),i.R.instNoEnum(this,"iacCache"),i.R.propNoWrite(this,"_grid","iacCache"),new.target===e&&Object.seal(this)}write(t,e){this._grid[t]=Object.freeze(Object.assign(Object.create(null),this._grid[t],e))}forEach(t){this._grid.forEach(t)}forEachShuffled(t){const e=new Array(this.area);for(let t=0;t<this.area;t++)e[t]=t;e.sort(((t,e)=>Math.random()-.5)).freeze();for(const s of e)t(this._grid[s],s)}getUntToward(t,e){const s=this.tileDestsFrom(e).filter((t=>t.occId===a.J5.Id.NULL)).map((e=>{const s=this.iacCache[e.coord],r=this.iacCache[t];return{tile:e,iac:s,infNorm:h.infNorm(this.dimensions,s,r).norm,oneNorm:h.oneNorm(this.dimensions,s,r).norm}}));if(0===s.length)return this.tileAt(e);s.sort(((t,e)=>t.infNorm-e.infNorm)),s.length=3,s.sort(((t,e)=>t.oneNorm-e.oneNorm));const r=s[0];for(let t=1;t<s.length;t++)if(s[t].infNorm>r.infNorm){s.splice(t);break}if(1===s.length)return r.tile;if(r.infNorm===r.oneNorm){if(h.axialAlignment(this.dimensions,e,t)>.5)return r.tile;s.shift()}return s[Math.floor(s.length*Math.random())].tile}getUntAwayFrom(t,e){const s=this.iacCache[t],r=this.iacCache[e].iSub(s).mod(this.dimensions);return this._grid[r.toCoord(this.dimensions)]}getAllAltDestsThan(t){return this.tileDestsFrom(t,2)}getRandomCoordAround(t,e){const s=this.iacCache[t];return new h(s.x+Math.trunc(2*e*(Math.random()-.5)),s.y+Math.trunc(2*e*(Math.random()-.5))).mod(this.dimensions).toCoord(this.dimensions)}dist(t,e){return h.infNorm(this.dimensions,this.iacCache[t],this.iacCache[e]).norm}tileAt(t){return this._grid[t]}tileDestsFrom(t,e=1){const s=this.iacCache[t];let r=!1,i=!1;const o=this.dimensions.width,a=this.dimensions.height;let h=s.y-e;h<0&&(h+=a,i=!0);let n=s.x-e;n<0&&(n+=o,r=!0);let c=s.y+e+1;c>a&&(c-=a,i=!0);let d=s.x+e+1;d>o&&(d-=o,r=!0);const l=[];if(r){const t=h*o;l.push(...this._grid.slice(t,t+d)),i&&l.push(...this._grid.slice(0,d))}const m=i?a:c,u=2*e+1;for(let t=h;t<m;t++){const e=t*o+n;l.push(...this._grid.slice(e,e+u))}if(r&&!i&&(l.length-=d),i){for(let t=0;t<c;t++){const e=t*o+n;l.push(...this._grid.slice(e,e+u))}r&&(l.length-=d)}return l.freeze()}tileSourcesTo(t,e=1){return this.tileDestsFrom(t,e)}static getArea(t){return t.height*t.width}static getLatticePatchDiameter(t){return Math.sqrt(t)}static getRandomCoord(t){const e=Math.floor(t.width*Math.random());return Math.floor(t.height*Math.random())*t.width+e}};let s=e;s.ambiguityThreshold=24,s.SIZE_LIMITS=i.R.deepFreeze({height:{min:10,max:51},width:{min:10,max:51}}),s.sizeLimits=e.SIZE_LIMITS,t.Grid=s,s.prototype.tileSourcesTo=s.prototype.tileDestsFrom,i.R.protoNoEnum(s,"tileAt","tileDestsFrom","tileSourcesTo"),Object.freeze(s),Object.freeze(s.prototype)}(r||(r={})),Object.freeze(r)},52:(t,e,s)=>{"use strict";s.d(e,{T:()=>r});var r,i,o=s(164);(i=r||(r={}))._Constructors={W_EUCLID2:void 0,BEEHIVE:void 0},i.getImplementation=t=>i._Constructors[t],i._mkExtensionProps=function(t){t.setAttribute("role","presentation"),t.translate=!1,t.spellcheck=!1;const e=o.R.html("div"),s=e.attachShadow({mode:"closed"});t.classList.add("_2N_eu47KtEpZi5d2CowzkM"),s.appendChild(t),o.R.Web.adoptStyleSheet(s,"css-common.css"),o.R.Web.adoptStyleSheet(s,"chunk/game-css.css");const r=o.R.html("div",["_2BjCVl5m4MP1W-F8Z9wQNx"]),i=o.R.html("div",["_1QzcWwOXzKGRJ08E7Atc6o"]),a=Object.freeze([r,i]);return Object.freeze({baseElem:e,spotlightElems:a})},Object.freeze(r)},61:(t,e,s)=>{"use strict";s.d(e,{Z:()=>f});var r=s(52),i=s(164),o=s(139),a=s(33);var h,n=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)};const c=.4;class d{constructor(t){this.body=i.R.svg("rect"),this._char=i.R.svg("text");const e=2.06*t.x+c,s=2.06*t.y+c;this.body.classList.add("_3bZJ4fE4oboFoXnIoxvMoC");const r=this.body.setAttributeNS.bind(this.body,null);r("x",e+"em"),r("y",s+"em"),this._char.classList.add("_1RIAliHGAPUZnmLFKbeJR0"),this._char.setAttributeNS(null,"x",e+.83+"em"),this._char.setAttributeNS(null,"y",s+.83+"em")}set occId(t){t===o.J5.Id.NULL?delete this.body.dataset.occId:this.body.dataset.occId=t.toString()}set health(t){t>0?this.body.dataset.health=t.toString():delete this.body.dataset.health}set char(t){this._char.textContent=t}}Object.freeze(d),Object.freeze(d.prototype);class l extends a.K.Grid{constructor(t){super(t),h.set(this,void 0);const e=i.R.svg("svg",["_3sIxemHPd1QgnRpmKBX9zJ"]),s=t.dimensions;e.setAttribute("height",2.06*s.height+c+"em"),e.setAttribute("width",2.06*s.width+c+"em");const o=[];var a,l;this.forEach((t=>{const s=new d(this.iacCache[t.coord]);o.push(s),e.appendChild(s.body),e.appendChild(s._char)})),l=o,n(this,a=h,"write to private field"),a.set(this,l);const m=i.R.html("div");m.appendChild(e),Object.assign(this,r.T._mkExtensionProps(m)),Object.seal(this)}write(t,e){super.write(t,e);const s=(r=this,o=h,n(r,o,"read from private field"),o.get(r))[t];var r,o;i.R.hasProp(e,"occId")&&(s.occId=e.occId),i.R.hasProp(e,"health")&&(s.health=e.health),i.R.hasProp(e,"char")&&(s.char=e.char)}}h=new WeakMap,Object.freeze(l),Object.freeze(l.prototype);var m=s(216);class u extends m.v.Grid{constructor(t){super(t),Object.assign(this,r.T._mkExtensionProps(void 0)),Object.seal(this)}write(t,e){}}Object.freeze(u),Object.freeze(u.prototype);const f=()=>{const t=r.T;Object.freeze(Object.assign(t._Constructors,{W_EUCLID2:l,BEEHIVE:u})),Object.freeze(t)}},702:(t,e,s)=>{"use strict";s.d(e,{S:()=>f});var r,i,o,a=s(164),h=s(892),n=s(139),c=s(783),d=s(56),l=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},m=(t,e,s)=>(l(t,e,"read from private field"),s?s.call(t):e.get(t)),u=(t,e,s,r)=>(l(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s);class f{constructor(t){r.set(this,void 0),i.set(this,void 0),o.set(this,void 0);const{impl:e,desc:s,operatorIds:h}=t;Object.freeze(s),Object.freeze(s.players),s.players.forEach((t=>Object.freeze(t))),Object.freeze(h);const c=e.gridClassLookup(s.coordSys);this.grid=new c({Grid:c,system:s.coordSys,dimensions:s.gridDimensions,players:s.players}),u(this,r,e.onGameBecomeOver),this.langFrontend=n.Uo.GET_FRONTEND_DESC_BY_ID(s.langId);const l=this._createPlayers(s,e,h);this.players=l.players,this.operators=l.operators;{const t=[];this.players.forEach((e=>{t[e.teamId]||(t[e.teamId]=[]),t[e.teamId].push(e)})),this.teams=t.map(((t,e)=>new d.S(e,t)))}a.R.propNoWrite(this,"grid","langFrontend","players","operators","teams"),this.players.forEach((t=>t.onTeamsBootstrapped())),this.setCurrentOperator(0)}reset(){this.grid.reset(),u(this,o,h.l.Status.PAUSED)}_createPlayers(t,e,s){const r=t.players.map((t=>t.familyId===c.J.Family.HUMAN?s.includes(t.playerId)?new e.OperatorPlayer(this,t):new c.J(this,t):e.RobotPlayer(this,t))).freeze();return Object.freeze({players:r,operators:s.map((t=>r[t])).freeze()})}deserializeResetState(t){a.R.deepFreeze(t),this.grid.forEach(((e,s)=>{this.grid.write(e.coord,t.csps[s])})),t.playerCoords.forEach(((t,e)=>{this.players[e].reset(t)}))}get currentOperator(){return m(this,i)}setCurrentOperator(t){const e=this.operators[t];if(void 0===e)throw new Error("never");this.currentOperator!==e&&u(this,i,e)}get status(){return m(this,o)}statusBecomePlaying(){if(this.status!==h.l.Status.PLAYING){if(this.status!==h.l.Status.PAUSED)throw new Error("Can only resume a game that is currently paused.");this.players.forEach((t=>{t.onGamePlaying()})),u(this,o,h.l.Status.PLAYING)}else console.info("[statusBecomePlaying]: Game is already playing")}statusBecomePaused(){this.status!==h.l.Status.PAUSED?this.status!==h.l.Status.OVER&&(this.players.forEach((t=>{t.onGamePaused()})),u(this,o,h.l.Status.PAUSED)):console.info("[statusBecomePaused]: Game is already paused")}statusBecomeOver(){this.status!==h.l.Status.OVER&&(this.players.forEach((t=>{t.onGameOver()})),u(this,o,h.l.Status.OVER),m(this,r).call(this),console.info("game is over!"))}commitTileMods(t,e,s=!0){const r=this.grid.tileAt(t);void 0!==e.seq&&s&&this.operators.forEach((t=>{this.grid.tileDestsFrom(t.coord).includes(r)&&t.seqBufferAcceptKey(void 0)})),this.grid.write(t,e)}commitStateChange(t,e){a.R.deepFreeze(t);const s=this.players[t.initiator];void 0===t.rejectId?(Object.entries(t.tiles).freeze().forEach((([t,e])=>{this.commitTileMods(parseInt(t),e)})),Object.entries(t.players).freeze().forEach((([t,e])=>{const s=this.players[parseInt(t)];s.reqBuffer.acceptOldest(),s.health=e.health,void 0!==e.coord&&(this.grid.write(s.coord,{occId:c.J.Id.NULL}),this.grid.write(e.coord,{occId:s.playerId}),s.setCoord(e.coord))}))):s.reqBuffer.reject(t.rejectId,s.coord)}}r=new WeakMap,i=new WeakMap,o=new WeakMap,a.R.protoNoEnum(f,"_createPlayers"),Object.freeze(f),Object.freeze(f.prototype)},46:(t,e,s)=>{"use strict";s.d(e,{i:()=>d});var r,i,o=s(892),a=s(783),h=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},n=(t,e,s)=>(h(t,e,"read from private field"),s?s.call(t):e.get(t)),c=(t,e,s,r)=>(h(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s);class d extends a.J{constructor(t,e){super(t,e),r.set(this,void 0),i.set(this,void 0),Object.seal(this),c(this,i,this.game.langFrontend.remapFunc)}reset(t){super.reset(t),c(this,r,"")}get seqBuffer(){return n(this,r)}processKeyboardInput(t){this.game.status!==o.l.Status.PLAYING||this.reqBuffer.isFull||(" "===t.key?this.coord!==this.prevCoord&&this.makeMovementRequest(this.game.grid.getUntAwayFrom(this.prevCoord,this.coord).coord,a.J.MoveType.BOOST):1!==t.key.length||t.repeat||this.seqBufferAcceptKey(t.key))}seqBufferAcceptKey(t){const e=this.game.grid.tileDestsFrom(this.reqBuffer.predictedCoord).filter((t=>t.occId===a.J.Id.NULL));if(0!==e.length)if(void 0!==t){t=n(this,i).call(this,t);for(let s=this.seqBuffer+t;s.length;s=s.substring(1)){const t=e.find((t=>t.seq.startsWith(s)));if(void 0!==t)return c(this,r,s),void(t.seq===s&&this.makeMovementRequest(t.coord,"NORMAL"))}c(this,r,"")}else e.find((t=>t.seq.startsWith(this.seqBuffer)))||c(this,r,"")}setCoord(t){c(this,r,""),super.setCoord(t)}}r=new WeakMap,i=new WeakMap,Object.freeze(d),Object.freeze(d.prototype)}}]);
//# sourceMappingURL=5.js.map
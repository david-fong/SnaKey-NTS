var capswalk;(self.webpackChunkcapswalk=self.webpackChunkcapswalk||[]).push([[826],{164:(e,t,s)=>{"use strict";s.d(t,{R:()=>i});const a=Object.freeze({enumerable:!1}),r=Object.freeze({writable:!1});var i;!function(e){function t(e){for(const s of Object.getOwnPropertyNames(e)){const a=e[s];null!==a&&"object"==typeof a&&t(a)}Object.freeze(e)}function s(e,t,...s){for(const a of s)Object.defineProperty(t,a,e)}let i;var n;e.deepFreeze=function(e){return t(e),e},e.hasProp=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.protoNoEnum=function(e,...t){Object.getOwnPropertyNames(e.prototype).freeze(),t.forEach((t=>{Object.defineProperty(e.prototype,t,a)}))},e.instNoEnum=s.bind(null,a),e.propNoWrite=s.bind(null,r),e.camelCaseTransforms=function(e){const t=e.replace(/[A-Z]/g,(e=>" "+e.toLowerCase()));return Object.freeze({spaceyLowercase:t,spaceyUppercase:t.toUpperCase(),spaceyCapitalized:t.split(" ").map((e=>e.charAt(0).toUpperCase()+e.substring(1))).join(" ")})},(n=i=e.Web||(e.Web={})).prependComment=function(e,t){e.parentNode.insertBefore(document.createComment(" "+t+" "),e)},n.adoptStyleSheet=function(t,s){t.appendChild(e.html("link",[],{rel:"stylesheet",href:s}))},n._makeSmartStorage=function(e,t,s){const a={};return Object.keys(s).forEach((e=>{const s=""+e;Object.defineProperty(a,e,{enumerable:!0,get:()=>{const e=t.getItem(s);return null===e?void 0:JSON.parse(e)},set:e=>{t.setItem(s,JSON.stringify(e))}})})),a},e.html=function(e,t,s){const a=document.createElement(e);try{Object.seal(a)}catch(e){}return(null==t?void 0:t.length)&&a.classList.add(...t),"button"===e?a.type="button":"a"===e&&(a.rel="noopener"),void 0!==s&&Object.assign(a,s),a},e.svg=function(e,t,s){const a=document.createElementNS("http://www.w3.org/2000/svg",e);return Object.seal(a),(null==t?void 0:t.length)&&a.classList.add(...t),void 0!==s&&Object.assign(a,s),a}}(i||(i={})),Object.freeze(i)},495:(e,t,s)=>{"use strict";s.d(t,{ZA:()=>a,oU:()=>r,m4:()=>i,JD:()=>n}),new WeakMap;class a{}var r,i,n,o;!function(e){let t;var s;let a;var r;(s=t=e.Name||(e.Name={})).REGEXP=/^(?:[a-zA-Z0-9:-]+)$/,s.MaxLength=30,(r=a=e.Passphrase||(e.Passphrase={})).REGEXP=/^(?:[a-zA-Z0-9:-]*)$/,r.MaxLength=30,e.GameServerReconnectionAttempts=2,e.DEFAULT_TTL=20}(a||(a={})),Object.freeze(a),Object.freeze(a.prototype),function(e){let t,s,a;(t=e.Create||(e.Create={})).NAME="joiner/create",function(e){let t;var s;e.NAME="joiner/exist",(s=t=e.Status||(e.Status={})).IN_LOBBY="in-lobby",s.IN_GAME="in-game",s.DELETE="delete"}(s=e.Exist||(e.Exist={})),(a=e.TryJoin||(e.TryJoin={})).NAME="joiner/try-join"}(r||(r={})),Object.freeze(r),function(e){let t;(t=e.UserInfo||(e.UserInfo={})).NAME="group/user-info-change",e.CREATE_GAME="group/create-game"}(i||(i={})),Object.freeze(i),(o=n||(n={})).RESET="game/reset",o.UNPAUSE="game/unpause",o.PAUSE="game/pause",o.IN_GAME="game/ingame",o.RETURN_TO_LOBBY="game/return-to-lobby"},139:(e,t,s)=>{"use strict";s.d(t,{Uo:()=>l,J5:()=>o});var a=s(164);const r=Object.freeze({IDENT:e=>e,LOWER:e=>e.toLowerCase()}),i={"engl-low":{module:"English",export:"Lowercase",isolatedMinOpts:25,remapFunc:r.LOWER,displayName:"English Lowercase (qwerty)",blurb:""},"engl-mix":{module:"English",export:"MixedCase",isolatedMinOpts:51,remapFunc:r.IDENT,displayName:"English Mixed-Case (Querty)",blurb:""},"japn-hir":{module:"Japanese",export:"Hiragana",isolatedMinOpts:70,remapFunc:r.LOWER,displayName:"Japanese Hiragana",blurb:""},"japn-kat":{module:"Japanese",export:"Katakana",isolatedMinOpts:68,remapFunc:r.LOWER,displayName:"Japanese Katakana",blurb:""},"kore-dub":{module:"Korean",export:"Dubeolsik",isolatedMinOpts:8690,remapFunc:r.IDENT,displayName:"Korean Dubeolsik (두벌식 키보드)",blurb:"The most common keyboard layout, and South Korea's only Hangul standard since 1969. Consonants are on the left, and vowels on the right."},"kore-sub":{module:"Korean",export:"Sebeolsik",isolatedMinOpts:10179,remapFunc:r.IDENT,displayName:"Korean Sebeolsik (세벌식 최종 키보드)",blurb:"Another Hangul keyboard layout used in South Korea, and the final Sebeolsik layout designed by Dr. Kong Byung Woo, hence the name. Syllable-initial consonants are on the right, final consonants on the left, and vowels in the middle. It is more ergonomic than the dubeolsik, but not widely used."},"kore-rom":{module:"Korean",export:"Romanization",isolatedMinOpts:3960,remapFunc:r.LOWER,displayName:"Korean Revised Romanization",blurb:"The Revised Romanization of Korean (국어의 로마자 표기법; 國語의 로마字 表記法) is the official South Korean language romanization system. It was developed by the National Academy of the Korean Language from 1995, and was released on 7 July 2000 by South Korea's Ministry of Culture and Tourism"},"engl-cell-enc":{module:"English",export:"OldCellphone.Encode",isolatedMinOpts:7,remapFunc:r.IDENT,displayName:"Old Cellphone Keyboard",blurb:""},"mors-enc":{module:"English",export:"Morse.Encode",isolatedMinOpts:10,remapFunc:e=>e,displayName:"Morse Encoder",blurb:""},"mors-dec":{module:"English",export:"Morse.Decode",isolatedMinOpts:40,remapFunc:r.LOWER,displayName:"Morse Decoder",blurb:""},ngram2:{module:"Ngrams",export:"Ngram2",isolatedMinOpts:199,remapFunc:r.LOWER,displayName:"English Bigrams",blurb:""},ngram3:{module:"Ngrams",export:"Ngram3",isolatedMinOpts:400,remapFunc:r.LOWER,displayName:"English Trigrams",blurb:""},numpad:{module:"Numpad",export:"Numpad",isolatedMinOpts:100,remapFunc:r.LOWER,displayName:"Number Pad",blurb:""}};Object.entries(i).forEach((([e,t])=>{t.id=e})),a.R.deepFreeze(i);const n=i;Object.freeze({behavior:"smooth",block:"center",inline:"center"});class o{}!function(e){let t,s;var a;let r;e.Family=Object.freeze({HUMAN:"HUMAN",CHASER:"CHASER"}),e.Family,(t=e.Id||(e.Id={})).NULL=-1,(a=s=e.Username||(e.Username={})).REGEXP=/[ a-zA-Z0-9:-]+/,a.MAX_LENGTH=15,(r=e.Avatar||(e.Avatar={})).LOREM_IPSUM="lorem-ipsum",function(e){const t=Object.values(e).filter((e=>"string"==typeof e));e.GET_RANDOM=function(){return t[Math.floor(Math.random()*t.length)]}}(r=e.Avatar||(e.Avatar={}))}(o||(o={})),Object.freeze(o);class l{}!function(e){let t,s,a;(t=e.Seq||(e.Seq={})).REGEXP=new RegExp("^[a-zA-Z0-9!@#$%^&*()-_=+;:'\"\\|,.<>/?]+$"),(s=e.CharSeqPair||(e.CharSeqPair={})).NULL=Object.freeze({char:"",seq:""}),(a=e.WeightExaggeration||(e.WeightExaggeration={})).MAX=4,e.CHAR_HIT_COUNT_SEED_CEILING=5,e.FrontendDescs=n,e.GET_FRONTEND_DESC_BY_ID=function(t){return e.FrontendDescs[t]}}(l||(l={})),Object.freeze(l),Object.freeze(l.prototype)},892:(e,t,s)=>{"use strict";var a;s.d(t,{l:()=>a}),function(e){let t;var s;(s=t=e.Status||(e.Status={})).PLAYING="PLAYING",s.PAUSED="PAUSED",s.OVER="OVER",Object.freeze(t),e.K=Object.freeze({_HEALTH_UPDATE_CHANCE:.1,AVERAGE_HEALTH_TO_SPAWN_ON_TILE:1,PORTION_OF_MOVES_THAT_ARE_BOOST:.4,_HEALTH_COST_OF_BOOST(e,t){const s=t(this.AVERAGE_HEALTH_TO_SPAWN_ON_TILE/e);return this.AVERAGE_HEALTH_TO_SPAWN_ON_TILE/s/this.PORTION_OF_MOVES_THAT_ARE_BOOST},HEALTH_EFFECT_FOR_DOWNED_PLAYER:.6,_REQUEST_BUFFER_LENGTH:5,_ROBOT_PRIORITY_MAX_REUSES:4})}(a||(a={})),Object.freeze(a)},783:(e,t,s)=>{"use strict";s.d(t,{J:()=>v});var a,r=s(164),i=s(892),n=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},o=(e,t,s,a)=>(n(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s);class l{constructor(){a.set(this,0),this.length=0}get lastRejectId(){return n(this,e=a,"read from private field"),e.get(this);var e}reset(e){o(this,a,0),this.length=0,this.predictedCoord=e}get isFull(){return this.length===i.l.K._REQUEST_BUFFER_LENGTH}signRequest(e){return this.length++,this.predictedCoord=e.moveDest,e}getNextRejectId(){return(this.lastRejectId+Math.floor(99*Math.random()))%100}reject(e,t){o(this,a,e),this.length=0,this.predictedCoord=t}acceptOldest(){this.length--}}a=new WeakMap,Object.freeze(l),Object.freeze(l.prototype);var h,c,d=s(139),p=s(56),u=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},m=(e,t,s)=>(u(e,t,"read from private field"),s?s.call(e):t.get(e)),E=(e,t,s,a)=>(u(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s);const O=class extends d.J5{constructor(e,t){super(),h.set(this,void 0),c.set(this,0),this.prevCoord=void 0,this.playerId=t.playerId,this.familyId=t.familyId,this.teamId=t.teamId,this.username=t.username,this.avatar=t.avatar,this.game=e,this.reqBuffer=new l,r.R.instNoEnum(this,"game"),r.R.propNoWrite(this,"game","playerId","familyId","teamId","username","avatar","reqBuffer"),new.target===O&&Object.seal(this)}get team(){return this.game.teams[this.teamId]}get coord(){return m(this,h)}get health(){return m(this,c)}get isDowned(){return this.health<0}isTeamedWith(e){return this.team.members.includes(e)}onTeamsBootstrapped(){}reset(e){E(this,h,e),this.prevCoord=e,this.game.grid.write(e,{occId:this.playerId}),E(this,c,0),this.reqBuffer.reset(e)}onGamePlaying(){}onGamePaused(){}onGameOver(){}makeMovementRequest(e,t){this.reqBuffer.isFull||this.game.processMoveRequest(this.reqBuffer.signRequest({initiator:this.playerId,lastRejectId:this.reqBuffer.lastRejectId,moveType:t,moveDest:e}))}setCoord(e){this.prevCoord=this.coord,E(this,h,e)}set health(e){const t=this.isDowned;if(E(this,c,e),t||!this.isDowned)return;const s=this.team,a=this.game.teams;if(s.elimOrder===p.S.ElimOrder.STANDING&&s.members.every((e=>e.isDowned))){const e=1+a.filter((e=>e.elimOrder!==p.S.ElimOrder.STANDING)).length;s.elimOrder=1+a.filter((e=>e.elimOrder!==p.S.ElimOrder.STANDING)).length,e===a.length&&this.game.statusBecomeOver()}}};let v=O;h=new WeakMap,c=new WeakMap,function(e){let t;e.MoveType=Object.freeze({NORMAL:"NORMAL",BOOST:"BOOST"}),e.MoveType,(t=e.CtorArgs||(e.CtorArgs={})).finalize=function(t){const s=t.players,a=Array.from(new Set(s.map((e=>e.teamId)))).sort(((e,t)=>e-t)).reduce(((e,t,s)=>(e[t]=s,e)),[]);t.players=s.slice().sort(((e,t)=>a[e.teamId]-a[t.teamId])).freeze().map(((t,s)=>{var r;return Object.assign({},t,{playerId:s,teamId:a[t.teamId],avatar:null!=(r=t.avatar)?r:e.Avatar.GET_RANDOM()})})).freeze()},Object.freeze(t)}(v||(v={})),r.R.protoNoEnum(v,"onGamePlaying","onGamePaused","onGameOver","onTeamsBootstrapped"),Object.freeze(v),Object.freeze(v.prototype)},56:(e,t,s)=>{"use strict";s.d(t,{S:()=>r});var a=s(164);class r{constructor(e,t){if(this.id=e,this.members=t,this.elimOrder=r.ElimOrder.STANDING,a.R.propNoWrite(this,"id","members"),Object.seal(this),0===t.length)throw new Error("Teams must have at least one member.")}reset(){this.elimOrder=r.ElimOrder.STANDING}}!function(e){let t;(t=e.ElimOrder||(e.ElimOrder={})).STANDING=0}(r||(r={})),Object.freeze(r),Object.freeze(r.prototype)},811:(e,t,s)=>{"use strict";s.r(t),s.d(t,{game:()=>Je,screen:()=>Fe,top:()=>We}),s(768);var a,r=s(164);!function(e){let t;var s;let a,r;e.ID={PUBLIC_GAME_SERVER_URLS:"public-game-hosts-list",CURRENT_HOST_GROUPS:"current-host-groups-list"},(s=t=e.General||(e.General={})).Class={TEXT_SELECT_DISABLED:"text-select-disabled",FILL_PARENT:"fill-parent",CENTER_CONTENTS:"center-contents",STACK_CONTENTS:"stack-contents",INPUT_GROUP:"sk-input-group",INPUT_GROUP_ITEM:"sk-input-group-item"},s.Dataset={COLOUR_SCHEME:"skColourScheme"},(a=e.Player||(e.Player={})).Dataset={DOWNED:{KEY:"downed",VALUES:{TEAM:"team",SELF:"self",NO:"no"}},FACE_SWATCH:"face"},function(e){let t;e.Id={ALL_SCREENS:"all-screens-container",SCREEN_TINT:"screen-tint"},e.Class={BASE:"screen",NAV_NEXT:"screen--next-button",NAV_PREV:"screen--prev-button"},e.Dataset={CURRENT:"current"},function(e){let t;(t=e.Setup||(e.Setup={})).Id={LANG_WEIGHT_EXAGGERATION_LIST:"screen-setup--lang-weight-exaggeration-list"}}(t=e.Impl||(e.Impl={}))}(r=e.Screen||(e.Screen={}))}(a||(a={})),r.R.deepFreeze(a);var i,n=s(139);!function(e){let t;e.Local=r.R.Web._makeSmartStorage("capswalk",localStorage,{musicVolume:1,sfxVolume:1,colourSchemeId:"",colourSchemeStyleLiteral:"",gamePresetId:"",username:"",avatar:""}),e.getLastUserInfo=function(){var t,s;return Object.freeze({username:null!=(t=e.Local.username)?t:"unnamed player",teamId:0,avatar:null!=(s=e.Local.avatar)?s:n.J5.Avatar.GET_RANDOM()})},e.Session=r.R.Web._makeSmartStorage("capswalk",localStorage,Object.freeze({})),function(e){let t;e.DB_NAME="capswalk_db",(t=e.UserGamePresetStore||(e.UserGamePresetStore={})).STORE_NAME="userGamePresets",Object.freeze(t)}(t=e.IDB||(e.IDB={})),Object.freeze(t)}(i||(i={})),Object.freeze(i);var o,l,h=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},c=(e,t,s)=>(h(e,t,"read from private field"),s?s.call(e):t.get(e)),d=(e,t,s,a)=>(h(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s);const p=a.Screen.Class,u=class{constructor(e,t){o.set(this,void 0),this.baseElem=r.R.html("div",[p.BASE]),l.set(this,!1),this.screenId=t,this.screenNames=r.R.camelCaseTransforms(t),this.top=e.toplevel,d(this,o,e.parentElem),this.requestGoToScreen=e.goToScreen,this.nav=Object.freeze({prev:r.R.html("button"),next:r.R.html("button")}),r.R.propNoWrite(this,"screenId","top","baseElem","nav","requestGoToScreen"),this.nav.prev.classList.add(p.NAV_PREV),this.nav.next.classList.add(p.NAV_NEXT),this.nav.prev.textContent="Back",this.nav.next.textContent="Next",this.nav.prev.onclick=e=>{const s=u.NavTree,a=s[this.screenId];s[a.prev].href===a.href?this.requestGoToScreen(u.NavTree[t].prev,{}):window.history.back()}}lazyLoad(){c(this,l)||(this._lazyLoad(),this.baseElem.setAttribute("aria-label",this.screenNames.spaceyCapitalized+" Screen"),d(this,l,!0))}async _enter(e,t){var s;if(document.title=`${this.screenNames.spaceyCapitalized} | ${this.top.defaultDocTitle}`,e===u.NavDir.FORWARD){const e=new window.URL(window.location.href),t=e.hash=u.NavTree[this.screenId].href,a=[{screenId:this.screenId},"",e.href];(null==(s=window.history.state)?void 0:s.screenId)!==t&&(u.NavTree[this.screenId].prev===this.screenId?history.replaceState(...a):history.pushState(...a))}this.lazyLoad(),await this._abstractOnBeforeEnter(e,t)}_leave(e){return!!this._abstractOnBeforeLeave(e)}_onAfterEnter(){this.baseElem.dataset[a.Screen.Dataset.CURRENT]="",c(this,o).appendChild(this.baseElem)}_onAfterLeave(){delete this.baseElem.dataset[a.Screen.Dataset.CURRENT],this.baseElem.remove()}getRecommendedFocusElem(){}async _abstractOnBeforeEnter(e,t){}_abstractOnBeforeLeave(e){return!0}};let m=u;o=new WeakMap,l=new WeakMap,function(e){let t;var s;let a;var i;(s=t=e.Id||(e.Id={})).HOME="home",s.HOW_TO_PLAY="how-to-play",s.HOW_TO_HOST="how-to-host",s.COLOUR_CTRL="colour-control",s.SETUP_OFFLINE="setup-offline",s.PLAY_OFFLINE="play-offline",s.GROUP_JOINER="group-joiner",s.SETUP_ONLINE="setup-online",s.GROUP_LOBBY="group-lobby",s.PLAY_ONLINE="play-online",Object.freeze(t),e.NavTree=r.R.deepFreeze({[t.HOME]:{prev:t.HOME,href:t.HOME},[t.HOW_TO_PLAY]:{prev:t.HOME,href:t.HOW_TO_PLAY},[t.HOW_TO_HOST]:{prev:t.HOME,href:t.HOW_TO_HOST},[t.COLOUR_CTRL]:{prev:t.HOME,href:t.COLOUR_CTRL},[t.SETUP_OFFLINE]:{prev:t.HOME,href:t.SETUP_OFFLINE},[t.PLAY_OFFLINE]:{prev:t.SETUP_OFFLINE,href:t.SETUP_OFFLINE},[t.GROUP_JOINER]:{prev:t.HOME,href:t.GROUP_JOINER},[t.GROUP_LOBBY]:{prev:t.GROUP_JOINER,href:t.GROUP_JOINER},[t.SETUP_ONLINE]:{prev:t.GROUP_LOBBY,href:t.GROUP_JOINER},[t.PLAY_ONLINE]:{prev:t.GROUP_LOBBY,href:t.GROUP_JOINER}}),(i=a=e.NavDir||(e.NavDir={})).FORWARD="forward",i.BACKWARD="backward",e.GET_NAV_DIR=function(t){const{curr:s,dest:a}=t;if(void 0===s)return e.NavDir.FORWARD;let r=s;for(;r!==e.NavTree[r].prev;)if(r=e.NavTree[r].prev,r===a)return e.NavDir.BACKWARD;return e.NavDir.FORWARD}}(m||(m={})),Object.freeze(m),Object.freeze(m.prototype);const E={this:"_2fw8LavR89kQmI-ujd84Oc",nav:"_3bXQ_T8CN61h-XuM1Q5CKO","nav--play-offline":"_27pYKLXKIhEkDPRBq7FQkG","nav--play-online":"_1cZmpRlPlHZasyAk0suiYy","nav--how-to-play":"_29Ok3ZNcVG4aBK7f28U0Vl","nav--how-to-host":"_1Me42uM4lSoh2869wVFjJD","nav--colour-scheme":"_31wBmMbr_vhgM4lM1jary6","nav--goto-repo":"_2mwhS0oLTAcnpq5YWXg7cq","nav--report-issue":"QdLSQUx8gcAov0d1PYNgJ"};class O extends m{_lazyLoad(){Object.freeze(this),this.baseElem.classList.add(a.General.Class.CENTER_CONTENTS,E.this);const e=r.R.html("div",[a.General.Class.TEXT_SELECT_DISABLED,a.General.Class.INPUT_GROUP,E.nav]);e.setAttribute("role","navigation"),e.addEventListener("pointerleave",(()=>{var t;(null==(t=document.activeElement)?void 0:t.parentElement)===e&&document.activeElement.blur()}));const t=(t,s)=>{t.classList.add(a.General.Class.CENTER_CONTENTS,a.General.Class.INPUT_GROUP_ITEM,s.cssClass),t.textContent=s.text,t.addEventListener("pointerenter",(()=>{window.requestAnimationFrame((e=>{t.focus()}))})),e.appendChild(t)};[{text:"Offline Single-player",cssClass:E["nav--play-offline"],screenId:m.Id.SETUP_OFFLINE},{text:"Online Multi-player",cssClass:E["nav--play-online"],screenId:m.Id.GROUP_JOINER},{text:"How To Play",cssClass:E["nav--how-to-play"],screenId:m.Id.HOW_TO_PLAY},{text:"How To Host",cssClass:E["nav--how-to-host"],screenId:m.Id.HOW_TO_HOST},{text:"Colour Schemes",cssClass:E["nav--colour-scheme"],screenId:m.Id.COLOUR_CTRL}].map((e=>Object.freeze(e))).forEach((e=>{const s=r.R.html("button");s.onclick=e.screenId instanceof Function?e.screenId:()=>{this.requestGoToScreen(e.screenId,{})},t(s,e)})),[{text:"Visit\nRepo",cssClass:E["nav--goto-repo"],href:new window.URL("https://github.com/david-fong/capswalk")},{text:"Report\nIssue",cssClass:E["nav--report-issue"],href:new window.URL("https://github.com/david-fong/capswalk/issues")}].map((e=>Object.freeze(e))).forEach((e=>{const s=r.R.html("a",[],{href:e.href.toString(),target:"_blank"});t(s,e)})),this.baseElem.appendChild(e)}}Object.freeze(O),Object.freeze(O.prototype);class v extends m{_lazyLoad(){Object.freeze(this)}}Object.freeze(v),Object.freeze(v.prototype);class f extends m{_lazyLoad(){Object.freeze(this)}}(f||(f={})).INSTRUCTIONS_STEPS=Object.freeze(["$ npm install 'https://github.com/david-fong/capswalk#gh-pages'","$ npm run start","send the url to your friends"]),Object.freeze(f),Object.freeze(f.prototype);const b=JSON.parse('[{"id":"default","displayName":"Default","author":"N.W."},{"id":"smooth-stone","displayName":"Smooth Stone","author":"Dav"},{"id":"murky-dive","displayName":"Murky Dive","author":"Stressed Dav"}]');var _=s.t(b,2);var g,N,S,T,y,R,I=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},L=(e,t,s)=>(I(e,t,"read from private field"),s?s.call(e):t.get(e)),w=(e,t,s,a)=>(I(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s);class C{constructor(){g.set(this,void 0),N.set(this,void 0),S.set(this,void 0);const e=r.R.html("div",["_3tt0mEYF2K12deMBmuiflg"],{tabIndex:0});e.setAttribute("role","listbox"),e.addEventListener("keydown",this._onKeyDown.bind(this)),e.addEventListener("pointerenter",(t=>{window.requestAnimationFrame((t=>{e.focus()}))})),this.baseElem=e,this.options=[]}addOption(e){this.options.push(e),this.baseElem.appendChild(e.baseElem),e.baseElem.addEventListener("pointerenter",this.hoverOpt.bind(this,e)),e.baseElem.addEventListener("click",this.selectOpt.bind(this,e,!0)),e._registerParent(this._onOptDisabledChange.bind(this))}hoverOpt(e){var t;this.hoveredOpt!==e&&(null==(t=this.hoveredOpt)||t.baseElem.setAttribute("aria-active-descendant","false"),w(this,N,e),this.hoveredOpt.baseElem.setAttribute("aria-active-descendant","true"))}selectOpt(e,t=!0){var s;if(!e)throw new Error("opt must be defined");this.hoverOpt(e),this.confirmedOpt!==e&&(null==(s=this.confirmedOpt)||s.baseElem.setAttribute("aria-selected","false"),w(this,g,e),this.confirmedOpt.baseElem.setAttribute("aria-selected","true"),t&&this._onSelectOpt(e))}get confirmedOpt(){return L(this,g)}get hoveredOpt(){return L(this,N)}_onOptDisabledChange(e){this.confirmedOpt===e&&(this._isValid=!e.disabled)}set _isValid(e){this._isValid!==e&&(this.baseElem.setAttribute("aria-invalid",e?"false":"true"),w(this,S,e))}get _isValid(){return L(this,S)}_onKeyDown(e){if(" "===e.key||"Enter"===e.key)return this.selectOpt(this.hoveredOpt),e.preventDefault(),!1;{const t=this.options.indexOf(this.hoveredOpt);if("ArrowDown"===e.key||"Down"===e.key)for(let s=t+1;s<this.options.length;s++){const t=this.options[s];if(!t.disabled)return this.hoverOpt(t),e.preventDefault(),!1}else if("ArrowUp"===e.key||"Up"===e.key)for(let s=t-1;s>=0;s--){const t=this.options[s];if(!t.disabled)return this.hoverOpt(t),e.preventDefault(),!1}}return!0}}g=new WeakMap,N=new WeakMap,S=new WeakMap,T=C||(C={}),y=new WeakMap,R=new WeakMap,T._Option=class{constructor(){y.set(this,void 0),R.set(this,void 0),(this.baseElem=r.R.html("div",["aq-ZO_N3w-UH9VTYF60rL"])).setAttribute("role","option"),w(this,y,!1)}_registerParent(e){w(this,R,e)}get disabled(){return L(this,y)}set disabled(e){this.disabled!==e&&(this.baseElem.setAttribute("aria-disabled",e?"true":"false"),w(this,y,e),L(this,R).call(this,this))}},Object.freeze(T),Object.freeze(T.prototype),Object.freeze(C),Object.freeze(C.prototype);var P,A,G=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},U=(e,t,s)=>(G(e,t,"read from private field"),s?s.call(e):t.get(e)),M=(e,t,s,a)=>(G(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s);class j extends m{_lazyLoad(){s(649)("./undefined.css"),this.baseElem.classList.add("_2usroyHG0lbElLvXa_iy5"),this.baseElem.appendChild(this.nav.prev);const e=this.sel=new j.PickOne(this.top.storage.Local,this.top.transition);r.R.propNoWrite(this,"sel"),this.baseElem.appendChild(e.baseElem);const t=this.top.storage.Local.colourSchemeId;t&&this.sel.selectOpt(this.sel.getOptById(t),!1)}}!function(e){var t,s,i;const n=class extends C{constructor(e,a){var r;super(),t.set(this,void 0),s.set(this,void 0),i.set(this,void 0),M(this,t,!0),M(this,s,e),M(this,i,a),P.Schemes.forEach((e=>{this.addOption(new n.Option(e))})),this.selectOpt(this.getOptById(null!=(r=U(this,s).colourSchemeId)?r:"default"),!1)}_onHoverOpt(e){}_onSelectOpt(e){U(this,s).colourSchemeId=e.desc.id,U(this,s).colourSchemeStyleLiteral=e.cssLiteral;const r=U(this,t);M(this,t,!1),U(this,i).do({intermediateTransitionTrigger:()=>{document.documentElement.dataset[a.General.Dataset.COLOUR_SCHEME]=e.desc.id;const t=document.documentElement.style;if(r)for(const e of P.Swatch){const s="--colour-"+e;t.setProperty(s,"")}}})}getOptById(e){return this.options.find((t=>t.desc.id===e))}};let o=n;t=new WeakMap,s=new WeakMap,i=new WeakMap,e.PickOne=o,function(e){class t extends C._Option{constructor(e){super(),this.desc=e;const s=this.baseElem;s.classList.add("_2GxiPlklote2AuXecWhETZ"),s.dataset[a.General.Dataset.COLOUR_SCHEME]=e.id;const i=r.R.html("span",["_2nPC6c6ioUh-4gkJ5-JWNj"]);i.appendChild(r.R.html("div",["_3GbE2mb1TyXrO0uwR4Wbal"],{textContent:e.displayName})),i.appendChild(r.R.html("div",["_3LTv36NFPFb2DvxJ2eWKcb"],{textContent:"by "+e.author})),s.appendChild(i);for(let e=0;e<t.NUM_PREVIEW_SLOTS-1;e++)s.appendChild(r.R.html("span"));document.body.appendChild(s);let n="";const o=window.getComputedStyle(s);for(const e of P.Swatch){const t="--colour-"+e;n+=t+":"+o.getPropertyValue(t)+";"}this.cssLiteral=n}}e.Option=t,(t=e.Option||(e.Option={})).NUM_PREVIEW_SLOTS=8,Object.freeze(t),Object.freeze(t.prototype)}(o=e.PickOne||(e.PickOne={})),Object.freeze(o),Object.freeze(o.prototype)}(j||(j={})),Object.freeze(j),Object.freeze(j.prototype),(A=P||(P={})).Swatch=Object.freeze(["mainFg","mainBg","tileFg","tileBg","tileBd","healthFg","healthBg","pFaceMe","pFaceMeOppo","pFaceTeammate","pFaceImtlTeammate","pFaceOpponent","pFaceImtlOpponent"]),A.Schemes=r.R.deepFreeze(Array.from(_)),Object.freeze(P);var k=s(783);class z extends m{constructor(){super(...arguments),this.langSel=new z.LangPickOne}_lazyLoad(){this.baseElem.classList.add("_18T-RiVnTQugnMDE5W5g2S"),this.baseElem.appendChild(this.nav.prev),this.baseElem.appendChild(this.langSel.baseElem),this._createLangWeightExaggerationInput(),r.R.propNoWrite(this,"langSel","langWeightExaggeration"),this.baseElem.appendChild(this.nav.next),this._loadLastUsedPreset()}_createLangWeightExaggerationInput(){const e=this.langWeightExaggeration=r.R.html("input",["_3vawCmM619VS6F2hL-NerD"],{type:"range",min:"0",max:n.Uo.WeightExaggeration.MAX.toString(),step:"any",value:"1"});{const e=r.R.html("datalist");e.id=a.Screen.Impl.Setup.Id.LANG_WEIGHT_EXAGGERATION_LIST,[{val:0,label:"0"},{val:1,label:"1"}].forEach((t=>{e.appendChild(r.R.html("option",[],{value:t.val.toString(),label:t.label}))})),this.baseElem.appendChild(e)}e.setAttribute("list",a.Screen.Impl.Setup.Id.LANG_WEIGHT_EXAGGERATION_LIST),this.baseElem.appendChild(e)}getRecommendedFocusElem(){return this.nav.next}_loadLastUsedPreset(){this.top.storage.Local.gamePresetId,this.top.storage.IDB.UserGamePresetStore}parseArgsFromGui(){const e=Object.assign({},z.DEFAULT_PRESET());return e.langId=this.langSel.confirmedOpt.desc.id,e.langWeightExaggeration=parseFloat(this.langWeightExaggeration.value),e}}!function(e){e.DEFAULT_PRESET=()=>({coordSys:"W_EUCLID2",gridDimensions:{height:10,width:10},averageHealthPerTile:1/45,langWeightExaggeration:1,langId:"engl-low",players:[{familyId:"CHASER",teamId:1,username:"chaser1",avatar:n.J5.Avatar.GET_RANDOM(),familyArgs:{}},{familyId:"CHASER",teamId:1,username:"chaser2",avatar:n.J5.Avatar.GET_RANDOM(),familyArgs:{fearDistance:6,bloodThirstDistance:5,healthReserve:5,keyPressesPerSecond:1.8}}]});class t extends C{constructor(){super(),this.baseElem.classList.add("_2PZpDhMzEe7lio-sMdv4SB"),Object.values(n.Uo.FrontendDescs).forEach((e=>{this.addOption(new t.Option(e))})),this.selectOpt(this.options[0])}_onHoverOpt(e){}_onSelectOpt(e){}}e.LangPickOne=t,function(e){class t extends C._Option{constructor(e){super(),this.desc=e,this.baseElem.textContent=e.displayName}}e.Option=t,Object.freeze(t),Object.freeze(t.prototype)}(t=e.LangPickOne||(e.LangPickOne={})),Object.freeze(t),Object.freeze(t.prototype)}(z||(z={})),Object.freeze(z),Object.freeze(z.prototype);class D extends z{_lazyLoad(){super._lazyLoad(),Object.freeze(this),this.nav.next.onclick=e=>{const t=this.parseArgsFromGui();this.requestGoToScreen(m.Id.PLAY_OFFLINE,[t])}}parseArgsFromGui(){const e=super.parseArgsFromGui();return e.players.splice(e.players.length,0,{familyId:"HUMAN",teamId:0,socket:void 0,username:"hello1",avatar:k.J.Avatar.LOREM_IPSUM,familyArgs:{}},{familyId:"HUMAN",teamId:1,socket:void 0,username:"hello2",avatar:k.J.Avatar.LOREM_IPSUM,familyArgs:{}}),e}}Object.freeze(D),Object.freeze(D.prototype);var x=s(892);var H,B,W,F,J=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},q=(e,t,s)=>(J(e,t,"read from private field"),s?s.call(e):t.get(e)),Y=(e,t,s,a)=>(J(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s);const V=class extends m{constructor(){super(...arguments),this.playersBar=r.R.html("div",["BDHhbE0AQjge5tlj2Z3_O"]),H.set(this,void 0),B.set(this,void 0),W.set(this,void 0),F.set(this,void 0)}_lazyLoad(){this.baseElem.classList.add(a.General.Class.CENTER_CONTENTS,"_1euFnazUyfYf-c6qSiUhez");const e=V.createGridWrapper();this.grid=Object.freeze({base:e.top,implHost:e.implHost,pauseOl:e.pauseOl}),r.R.propNoWrite(this,"grid","playersBar"),r.R.Web.prependComment(this.grid.implHost,"grid impl host"),this.grid.implHost.appendChild(document.createComment("grid impl")),this.baseElem.appendChild(e.top),e.pauseOl.addEventListener("click",(e=>{const t=this.currentGame;void 0!==t&&t.status===x.l.Status.PAUSED&&(this.grid.base.focus(),this._reqStatusPlaying())})),this._initializeControlsBar(),this._initializePlayersBar(),Y(this,B,(()=>{if(this.wantsAutoPlayPause)if(document.hidden){if(void 0===q(this,F)){const e=this.currentGame;(void 0===e||void 0!==e&&e.status!==x.l.Status.OVER)&&this._reqStatusPaused()}}else"page-hide"===q(this,F)&&this._reqStatusPlaying()})),Y(this,W,this._gridKeyDownCallback.bind(this))}async _abstractOnBeforeEnter(e,t){document.addEventListener("visibilitychange",q(this,B)),this.btn.pause.disabled=!0,this._statusBecomePaused();const s=Y(this,H,await this._createNewGame(t));await s.reset(),this.grid.implHost.appendChild(s.grid.baseElem),this.btn.pause.onclick=this._reqStatusPlaying.bind(this),this.btn.pause.disabled=!1,this.wantsAutoPlayPause&&setTimeout((()=>{document.hidden||this._reqStatusPlaying()}),500),this.grid.base.addEventListener("keydown",q(this,W),{capture:!0})}_abstractOnBeforeLeave(e){if(this.askConfirmBeforeLeave&&!this.top.confirm("Are you sure you would like to leave?"))return!1;document.removeEventListener("visibilitychange",q(this,B)),this.currentGame.statusBecomeOver();for(const e of[this.currentGame.grid.baseElem])e.textContent="",e.remove();return this.grid.base.removeEventListener("keydown",q(this,W)),Y(this,H,void 0),!0}get currentGame(){return q(this,H)}get probeCurrentGame(){return q(this,H)}_gridKeyDownCallback(e){if(e.stopPropagation(),!e.isTrusted)return!0;const t=this.currentGame;if(e.ctrlKey&&" "===e.key&&!e.repeat){const e=t.operators;t.setCurrentOperator((1+e.indexOf(t.currentOperator))%e.length)}else t.currentOperator.processKeyboardInput(e);return" "!==e.key||(e.preventDefault(),!1)}_reqStatusPlaying(){this._statusBecomePlaying()}_reqStatusPaused(){this._statusBecomePaused()}_statusBecomePlaying(){this.currentGame.statusBecomePlaying(),this.btn.pause.textContent="Pause",this.grid.pauseOl.style.visibility="hidden",Y(this,F,void 0),this.btn.pause.onclick=this._reqStatusPaused.bind(this),this.btn.reset.disabled=!0,this.grid.base.focus()}_statusBecomePaused(){var e;null==(e=this.currentGame)||e.statusBecomePaused(),this.btn.pause.textContent="Unpause",this.grid.pauseOl.style.visibility="visible",Y(this,F,document.hidden?"page-hide":"other"),this.btn.pause.onclick=this._reqStatusPlaying.bind(this),this.btn.reset.disabled=!1}_onGameBecomeOver(){this.btn.pause.disabled=!0,this.btn.reset.disabled=!1}_resetGame(){this.currentGame.reset(),this.btn.pause.disabled=!1,this.wantsAutoPlayPause&&this._reqStatusPlaying()}_initializeControlsBar(){const e=r.R.html("div",[a.General.Class.CENTER_CONTENTS,a.General.Class.INPUT_GROUP,"fLS47QhRkscn0NK-vdINf"]);function t(t,s){return(s=null!=s?s:r.R.html("button")).classList.add(a.General.Class.INPUT_GROUP_ITEM),s.textContent=t,s.addEventListener("pointerenter",(e=>{s.focus()})),e.appendChild(s),s}e.setAttribute("role","menu"),e.addEventListener("pointerleave",(e=>{this.grid.base.focus()})),t("<Back Button Text>",this.nav.prev),this.btn=Object.freeze({pause:t(""),reset:t("Reset")}),r.R.propNoWrite(this,"btn"),this.btn.reset.onclick=this._resetGame.bind(this),this.baseElem.appendChild(e)}_initializePlayersBar(){r.R.propNoWrite(this),this.baseElem.appendChild(this.playersBar)}};let K=V;H=new WeakMap,B=new WeakMap,W=new WeakMap,F=new WeakMap,(K||(K={})).createGridWrapper=function(){const e=a.General.Class,t=r.R.html("div",["_2jXbc7jisQYh8dGHBjQfoB"]);t.setAttribute("role","presentation");const s=r.R.html("div",[e.TEXT_SELECT_DISABLED,"_3RnyB-FPnRJq2VQ-jJ1Fdy"],{tabIndex:0});s.setAttribute("role","textbox"),s.setAttribute("aria-label","Game Grid");const i=r.R.html("div",["_3To0VmRGhvAChHm1UecO55"]);i.setAttribute("role","presentation");const n=r.R.html("div",[e.FILL_PARENT,e.CENTER_CONTENTS,"_3RB2_LMTHSqVD3X5arzyV"],{});return n.appendChild(r.R.html("div",[],{textContent:"(Click to Unpause)"})),i.appendChild(n),s.appendChild(i),t.appendChild(s),Object.freeze({top:t,grid:s,intersectionRoot:i,implHost:i,pauseOl:n})},r.R.protoNoEnum(K,"probeCurrentGame","_statusBecomePlaying","_statusBecomePaused"),r.R.instNoEnum(K,"createGridWrapper"),Object.freeze(K),Object.freeze(K.prototype);class X extends K{constructor(){super(...arguments),this.wantsAutoPlayPause=!0,this.askConfirmBeforeLeave=!0}_lazyLoad(){super._lazyLoad(),Object.freeze(this),this.nav.prev.innerHTML="Return To&nbsp;Setup"}async _createNewGame(e){return new((await Promise.all([s.e(5),s.e(755)]).then(s.bind(s,303))).OfflineGame)(this._onGameBecomeOver.bind(this),e[0])}}Object.freeze(X),Object.freeze(X.prototype);var Z=s(495);var Q,$=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)};class ee extends m{constructor(){super(...arguments),Q.set(this,void 0),this.groupNameDataList=r.R.html("datalist",[],{id:a.ID.CURRENT_HOST_GROUPS})}get state(){return $(this,e=Q,"read from private field"),e.get(this);var e}_lazyLoad(){this.baseElem.classList.add(a.General.Class.CENTER_CONTENTS,"_1mSAZ0WI6Dl-lgWbZngYuh");const e=this._initFormContents();this.baseElem.appendChild(this.groupNameDataList),this.nav.prev.classList.add(a.General.Class.INPUT_GROUP_ITEM),this.nav.next.classList.add(a.General.Class.INPUT_GROUP_ITEM),e.appendChild(this.nav.prev),e.appendChild(this.nav.next),this.nav.next.onclick=e=>{this.requestGoToScreen(m.Id.GROUP_LOBBY,{})},this._setFormState(te.CHOOSING_SERVER),this.baseElem.appendChild(e)}_setFormState(e){if(this.state!==e){if(this.in.passphrase.disabled=!0,e===te.IN_GROUP){if(this.state!==te.CHOOSING_GROUP)throw new Error("never");this.nav.next.disabled=!1,this.nav.next.focus()}else this.nav.next.disabled=!0,this.in.passphrase.value="",e===te.CHOOSING_SERVER?(this.in.groupName.disabled=!0,this.in.groupName.value="",this.groupNameDataList.textContent="",this.in.serverUrl.focus()):e===te.CHOOSING_GROUP&&(this.in.groupName.disabled=!1,this.in.passphrase.disabled=!1,this.in.groupName.focus());var t,s;s=e,$(this,t=Q,"write to private field"),t.set(this,s)}}_initFormContents(){const e=r.R.html("div",[a.General.Class.INPUT_GROUP,"_3PpQNPHVO6NTNpgwU79ERL"],{});function t(t,s){const i=r.R.html("input",[a.General.Class.INPUT_GROUP_ITEM,s],{type:"text",autocomplete:"off",spellcheck:!1}),n=r.R.html("label",[],{textContent:t});return n.appendChild(i),e.appendChild(n),i}this.in=Object.freeze({serverUrl:Object.assign(t("Server URL","NgHzGx-miZPI-3fgl2oSY"),{type:"url",maxLength:128,autocomplete:"on",required:!0}),groupName:Object.assign(t("Group Name","_1JfrTGHJVK3NgMBs8AnnXZ"),{pattern:Z.ZA.Name.REGEXP.source,minLength:1,maxLength:Z.ZA.Name.MaxLength,autocomplete:"on",required:!0}),passphrase:Object.assign(t("Group Passphrase","_2tjc31lyon2RB1Ww3pt47Y"),{pattern:Z.ZA.Passphrase.REGEXP.source,maxLength:Z.ZA.Passphrase.MaxLength})}),this.in.groupName.setAttribute("list",a.ID.CURRENT_HOST_GROUPS);{this.in.serverUrl.setAttribute("list",a.ID.PUBLIC_GAME_SERVER_URLS);const e=He.SiteServerTypeSuggestedGameServer[this.top.siteServerType];if(e){const t=r.R.html("option",[],{value:e.value,textContent:e.description});document.getElementById(a.ID.PUBLIC_GAME_SERVER_URLS).insertAdjacentElement("afterbegin",t),this.in.serverUrl.value=t.value}}return r.R.propNoWrite(this,"in","groupNameDataList"),e}}Q=new WeakMap,function(e){let t;var s;(s=t=e.State||(e.State={})).CHOOSING_SERVER="choosing-server",s.CHOOSING_GROUP="choosing-group",s.IN_GROUP="in-group"}(ee||(ee={}));const te=ee.State;Object.freeze(ee),Object.freeze(ee.prototype);var se,ae,re,ie=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},ne=(e,t,s)=>(ie(e,t,"read from private field"),s?s.call(e):t.get(e)),oe=(e,t,s,a)=>(ie(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s);class le extends ee{constructor(){super(...arguments),se.set(this,!1),ae.set(this,!1),re.set(this,void 0)}get isHost(){return ne(this,ae)}get ws(){return this.top.webSocket}_lazyLoad(){super._lazyLoad(),oe(this,re,(e=>{const[t,...s]=JSON.parse(e.data);switch(t){case Z.oU.Create.NAME:this._onCreateResponse(s[0]);break;case Z.oU.Exist.NAME:this._onNotifyGroupExist(s[0]);break;case Z.oU.TryJoin.NAME:this._setFormState(he.IN_GROUP);break;case Z.m4.CREATE_GAME:this.requestGoToScreen(m.Id.PLAY_ONLINE,[s[0],s[1]])}}));const e=this._initServerUrlCbs();this._initGroupNameCbs(e),this._initPassphraseCbs(),Object.seal(this)}getRecommendedFocusElem(){return void 0===this.ws?this.in.serverUrl:this.in.groupName}_initServerUrlCbs(){const e=this.top,t=this.in.serverUrl;t.addEventListener("input",(e=>{this._setFormState(he.CHOOSING_SERVER)}));const s=()=>{t.value&&t.validity.valid&&(void 0===this.ws||new URL(this.ws.url).hostname!==new URL(t.value).hostname?(this.top.setWebSocket(new WebSocket(t.value)),this.ws.addEventListener("open",(e=>{this._setFormState(he.CHOOSING_GROUP)})),this.ws.addEventListener("message",ne(this,re)),this.ws.addEventListener("close",(t=>{this.top.setWebSocket(void 0),this._setFormState(he.CHOOSING_SERVER),e.toast("You disconnected you from the server."),this.top.currentScreen!==this&&this.requestGoToScreen(m.Id.GROUP_JOINER,{})}),{once:!0})):ne(this,se)&&this._setFormState(he.CHOOSING_GROUP))};return t.addEventListener("keydown",(e=>{e.isTrusted&&"Enter"===e.key&&s()})),t.addEventListener("paste",(e=>{e.isTrusted&&window.setTimeout((()=>s()),0)})),t.addEventListener("change",(e=>{e.isTrusted&&s()})),s}_onCreateResponse(e){return e?(this.top.toast(`server accepted request to create new group "${this.in.groupName.value}".`),this.top.toast("connecting to new group..."),void this._attemptToJoinExistingGroup()):(oe(this,se,!0),void this.top.toast(`The server rejected your request to create a new group "${this.in.groupName.value}".`))}_onNotifyGroupExist(e){const t=e=>{const t=r.R.html("option",[],{value:e});for(const e of s)if(t.value.localeCompare(e.value)<0){this.groupNameDataList.insertBefore(t,e);break}return t.parentElement||this.groupNameDataList.appendChild(t),t},s=Array.from(this.groupNameDataList.children);Object.entries(e).freeze().forEach((([e,a])=>{var r;const i=null!=(r=s.find((t=>t.value===e)))?r:t(e);switch(a){case Z.oU.Exist.Status.IN_LOBBY:i.textContent="In Lobby";break;case Z.oU.Exist.Status.IN_GAME:i.textContent="In Game";break;case Z.oU.Exist.Status.DELETE:i.remove()}}))}_initGroupNameCbs(e){const t=this.in.groupName;t.addEventListener("input",(t=>{t.isTrusted&&(this.state===he.IN_GROUP&&e(),this.in.passphrase.value="",oe(this,ae,!1))}));const s=()=>{t.value&&t.validity.valid&&(this.state===he.IN_GROUP?this.nav.next.focus():this.in.passphrase.focus())};t.addEventListener("keydown",(e=>{e.isTrusted&&"Enter"===e.key&&s()})),t.addEventListener("change",(e=>{e.isTrusted&&s()}))}_initPassphraseCbs(){const e=()=>{if(!this.in.passphrase.validity.valid)return;ne(this,se)&&this._setFormState(he.IN_GROUP);const e=this.in.groupName.value;Array.from(this.groupNameDataList.children).some((t=>t.value===e))?(oe(this,ae,!1),this._attemptToJoinExistingGroup()):(oe(this,ae,!0),this.ws.send(JSON.stringify([Z.oU.Create.NAME,Object.freeze({groupName:this.in.groupName.value,passphrase:this.in.passphrase.value})])))};this.in.passphrase.addEventListener("keydown",(t=>{t.isTrusted&&"Enter"===t.key&&e()}))}_attemptToJoinExistingGroup(){this.ws.send(JSON.stringify([Z.oU.TryJoin.NAME,{groupName:this.in.groupName.value,passphrase:this.in.passphrase.value,userInfo:i.getLastUserInfo()}]))}}se=new WeakMap,ae=new WeakMap,re=new WeakMap;const he=ee.State;Object.freeze(le),Object.freeze(le.prototype);class ce extends z{_lazyLoad(){super._lazyLoad(),Object.freeze(this),this.nav.next.textContent="Start Game",this.nav.next.onclick=e=>{const t=this.parseArgsFromGui();this.top.clientIsGroupHost&&this.top.webSocket.send(JSON.stringify([Z.m4.CREATE_GAME,t]))}}}Object.freeze(ce),Object.freeze(ce.prototype);var de,pe=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},ue=(e,t,s)=>(pe(e,t,"read from private field"),s?s.call(e):t.get(e)),me=(e,t,s,a)=>(pe(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s);const Ee=class extends m{constructor(){super(...arguments),this.players=new Map,this.teamsElem=r.R.html("div",["_2eDnztFQPAJnFHoqcX6Rt8"]),this.teamElems=new Map,de.set(this,void 0)}get ws(){return this.top.webSocket}_lazyLoad(){this.baseElem.classList.add("_1RjcsAfyK_99UIm77cgsi1"),this._createInputs(),me(this,de,(e=>{const[t,...s]=JSON.parse(e.data);switch(t){case Z.m4.UserInfo.NAME:this._onUserInfoChange(s[0])}})),Object.freeze(this),this.nav.prev.textContent="Return To Joiner",this.baseElem.appendChild(this.teamsElem),r.R.propNoWrite(this,"players","teamsElem","teamElems","in");{const e=this.nav.next;e.textContent="Setup Game",e.onclick=()=>{this.requestGoToScreen(m.Id.SETUP_ONLINE,{})},this.baseElem.appendChild(e)}}_createInputs(){var e;const t=r.R.html("div",[a.General.Class.INPUT_GROUP,"_2hDNOGQoaqlmP3PIE18QwQ"]),s=r.R.html("input",[a.General.Class.INPUT_GROUP_ITEM],{type:"text",minLength:1,maxLength:n.J5.Username.MAX_LENGTH,pattern:n.J5.Username.REGEXP.source,spellcheck:!1,value:null!=(e=this.top.storage.Local.username)?e:"",onchange:this._submitInputs.bind(this)});t.appendChild(s);const i=r.R.html("input",[a.General.Class.INPUT_GROUP_ITEM],{type:"number",inputMode:"numeric",min:"0",max:"0",step:"1",value:"0",onchange:this._submitInputs.bind(this)});i.classList.add(),t.appendChild(i);const o=r.R.html("select");this.in=Object.freeze({username:s,teamId:i,avatar:o}),this.baseElem.appendChild(t)}_submitInputs(){if(!this.in.username.validity.valid||!this.in.teamId.validity.valid)return;const e=this.top.storage.Local;e.username=this.in.username.value,e.avatar=this.in.avatar.value;const t={username:this.in.username.value,teamId:parseInt(this.in.teamId.value),avatar:n.J5.Avatar.LOREM_IPSUM};this.ws.send(JSON.stringify([Z.m4.UserInfo.NAME,t]))}async _abstractOnBeforeEnter(e,t){"forward"===e&&(this.nav.next.disabled=!this.top.clientIsGroupHost,this.players.clear(),this.teamElems.clear(),this.teamsElem.textContent="",this._submitInputs(),this.ws.addEventListener("message",ue(this,de)))}getRecommendedFocusElem(){let e=this.in.username.validity.valid?this.in.teamId.validity.valid?void 0:this.in.teamId:this.in.username;return void 0===e&&(e=this.top.clientIsGroupHost?this.nav.next:this.in.teamId),e}_abstractOnBeforeLeave(e){return e===m.NavDir.BACKWARD&&this.ws.removeEventListener("message",ue(this,de)),!0}_onUserInfoChange(e){Object.freeze(Object.entries(e)).forEach((([e,t])=>{const s=this.players.get(e);if(!s||1!==this.teamElems.get(s.teamId).childElementCount||null!==t&&t.teamId===s.teamId||(this.teamElems.get(s.teamId).remove(),this.teamElems.delete(s.teamId)),t&&!this.teamElems.has(t.teamId)){const e=r.R.html("div",["_1OhAwynz14tlCVrxxglqWC"]);this.teamElems.set(t.teamId,e),e.onclick=e=>{this.in.teamId.value=t.teamId.toString()},this.teamsElem.appendChild(e)}if(null===t)s.base.remove(),this.players.delete(e);else if(void 0===s){const s=new Ee.UserInfo(t);this.players.set(e,s),this.teamElems.get(t.teamId).appendChild(s.base)}else s.update(t)})),this.in.teamId.max=Object.keys(this.players).length.toString()}};let Oe=Ee;var ve,fe,be,_e;de=new WeakMap,ve=Oe||(Oe={}),fe=new WeakMap,be=new WeakMap,_e=new WeakMap,ve.UserInfo=class{constructor(e){fe.set(this,void 0),be.set(this,void 0),_e.set(this,void 0),this.base=r.R.html("div",["_2jAbJY6xTuqckSRVnOPwG4"]);const t=()=>{const e=r.R.html("div");return this.base.appendChild(e),e};this.el=Object.freeze({username:t(),teamId:t(),avatar:t()}),this.el.username.classList.add("_3esbSTakuS113N38hp7-V4"),this.username=e.username,this.teamId=e.teamId,r.R.propNoWrite(this,"base","el")}update(e){this.username=e.username,this.teamId=e.teamId,this.avatar=e.avatar}get username(){return ue(this,fe)}set username(e){this.el.username.textContent=e,me(this,fe,e)}get teamId(){return ue(this,be)}set teamId(e){this.el.teamId.textContent=e.toString(),me(this,be,e)}get avatar(){return ue(this,_e)}set avatar(e){me(this,_e,e),this.el.avatar}},r.R.protoNoEnum(Oe,"_createInputs","_submitInputs"),Object.freeze(Oe),Object.freeze(Oe.prototype);var ge,Ne=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},Se=(e,t,s)=>(Ne(e,t,"read from private field"),s?s.call(e):t.get(e));class Te extends K{constructor(){super(...arguments),this.askConfirmBeforeLeave=!1,this.wantsAutoPlayPause=!1,ge.set(this,void 0)}get ws(){return this.top.webSocket}_lazyLoad(){var e,t;super._lazyLoad(),Object.freeze(this),this.nav.prev.innerHTML="Return To&nbsp;Lobby",t=e=>{const[t,...s]=JSON.parse(e.data);switch(t){case Z.JD.UNPAUSE:this._statusBecomePlaying();break;case Z.JD.PAUSE:this._statusBecomePaused();break;case Z.JD.RETURN_TO_LOBBY:void 0===s[0]&&this.nav.prev.click();break;default:this.currentGame.wsMessageCb(e)}},Ne(this,e=ge,"write to private field"),e.set(this,t),Object.seal(this)}_abstractOnBeforeLeave(e){const t=super._abstractOnBeforeLeave(e);return t&&void 0!==this.ws&&(this.ws.send(JSON.stringify([Z.JD.RETURN_TO_LOBBY])),this.ws.removeEventListener("message",Se(this,ge))),t}_reqStatusPlaying(){this.ws.send(JSON.stringify([Z.JD.UNPAUSE]))}_reqStatusPaused(){this.ws.send(JSON.stringify([Z.JD.PAUSE]))}async _createNewGame(e){const[t,a]=e,r=new((await Promise.all([s.e(5),s.e(775)]).then(s.bind(s,102))).OnlineGame)(this.top.webSocket,this._onGameBecomeOver.bind(this),t,a);return this.ws.addEventListener("message",Se(this,ge)),Promise.resolve(r)}}ge=new WeakMap,Object.freeze(Te),Object.freeze(Te.prototype);var ye,Re,Ie=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},Le=(e,t,s)=>(Ie(e,t,"read from private field"),s?s.call(e):t.get(e)),we=(e,t,s,a)=>(Ie(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s);class Ce{constructor(e,t){ye.set(this,void 0),Re.set(this,void 0),we(this,Re,e.transition),t.setAttribute("role","presentation");const s=m.Id,a=Object.freeze({toplevel:e,parentElem:t,goToScreen:Object.freeze(this.goToScreen.bind(this))});this.dict=Object.freeze({[s.HOME]:new O(a,s.HOME),[s.HOW_TO_PLAY]:new v(a,s.HOW_TO_PLAY),[s.HOW_TO_HOST]:new f(a,s.HOW_TO_HOST),[s.COLOUR_CTRL]:new j(a,s.COLOUR_CTRL),[s.SETUP_OFFLINE]:new D(a,s.SETUP_OFFLINE),[s.PLAY_OFFLINE]:new X(a,s.PLAY_OFFLINE),[s.GROUP_JOINER]:new le(a,s.GROUP_JOINER),[s.SETUP_ONLINE]:new ce(a,s.SETUP_ONLINE),[s.GROUP_LOBBY]:new Oe(a,s.GROUP_LOBBY),[s.PLAY_ONLINE]:new Te(a,s.PLAY_ONLINE)}),r.R.propNoWrite(this,"dict"),Object.seal(this);const i=m.NavTree[window.location.hash.slice(1)];window.setTimeout((()=>{var e;this.goToScreen(null!=(e=null==i?void 0:i.href)?e:m.Id.HOME,{})})),window.addEventListener("popstate",(e=>{this.goToScreen(window.history.state.screenId,{})}))}async goToScreen(e,t){const s=this.currentScreen,a=this.dict[e];if(s===a)throw new Error("never");we(this,ye,a);const r=m.GET_NAV_DIR({curr:null==s?void 0:s.screenId,dest:e});return!(void 0!==s&&!s._leave(r)||(await Le(this,Re).do({whileBeforeUnblur:a._enter(r,t),beforeUnblur:()=>{var t;switch(e){case m.Id.GROUP_JOINER:this.dict[m.Id.GROUP_LOBBY].lazyLoad()}null==s||s._onAfterLeave(),a._onAfterEnter(),null==(t=a.getRecommendedFocusElem())||t.focus()}}),0))}get currentScreen(){return Le(this,ye)}}ye=new WeakMap,Re=new WeakMap,Object.freeze(Ce),Object.freeze(Ce.prototype);var Pe,Ae=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},Ge=(e,t,s)=>(Ae(e,t,"read from private field"),s?s.call(e):t.get(e));class Ue{constructor(){this.baseElem=document.getElementById(a.Screen.Id.SCREEN_TINT),Pe.set(this,Promise.resolve()),this.baseElem.tabIndex=-1,this.baseElem.addEventListener("keydown",(e=>{e.preventDefault()}),{capture:!0}),r.R.propNoWrite(this,"baseElem"),Object.seal(this)}do(e){var t,s,a;return t=this,s=Pe,a=Ge(this,Pe).then((()=>this._atomicDo(e))),Ae(t,s,"write to private field"),s.set(t,a),Ge(this,Pe)}async _atomicDo(e){const t=document.activeElement;this.baseElem.focus();const s=this.baseElem.style;await this._cssTransition((function(){s.pointerEvents="all",s.opacity="1.0"})),void 0!==e.intermediateTransitionTrigger&&await this._cssTransition((()=>{e.intermediateTransitionTrigger()})),await e.whileBeforeUnblur,t instanceof HTMLElement&&t.focus(),void 0!==e.beforeUnblur&&e.beforeUnblur(),await this._cssTransition((function(){s.pointerEvents="none",s.opacity="0.0"})),this.baseElem.blur()}_cssTransition(e){return new Promise((t=>{this.baseElem.addEventListener("transitionend",(()=>t()),{once:!0}),e()}))}}Pe=new WeakMap,r.R.protoNoEnum(Ue,"_atomicDo","_cssTransition"),Object.freeze(Ue),Object.freeze(Ue.prototype);var Me,je,ke=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},ze=(e,t,s)=>(ke(e,t,"read from private field"),s?s.call(e):t.get(e)),De=(e,t,s,a)=>(ke(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s);const xe=class{constructor(){Me.set(this,void 0),je.set(this,void 0),this.defaultDocTitle=document.title,this.siteServerType=window.location.hostname.match(/github\.io/)?xe.SiteServerType.GITHUB:window.location.protocol.startsWith("file")?xe.SiteServerType.FILESYSTEM:xe.SiteServerType.DEDICATED,r.R.propNoWrite(this,"defaultDocTitle","siteServerType"),this.storage=i,De(this,je,void 0),this.transition=new Ue,r.R.propNoWrite(this,"storage","transition");const e=document.getElementById(a.Screen.Id.ALL_SCREENS);if(!e)throw new Error("never");r.R.Web.prependComment(e,"ALL SCREENS CONTAINER"),De(this,Me,new Ce(this,e)),r.R.propNoWrite(this),Object.seal(this)}get webSocket(){return ze(this,je)}setWebSocket(e){void 0!==this.webSocket&&this.webSocket.close(),De(this,je,e)}get clientIsGroupHost(){return ze(this,Me).dict["group-joiner"].isHost}toast(e){console.info(e)}confirm(e){return window.confirm(e)}get game(){var e;return null!=(e=ze(this,Me).dict["play-offline"].probeCurrentGame)?e:ze(this,Me).dict["play-online"].probeCurrentGame}get currentScreen(){return ze(this,Me).currentScreen}};let He=xe;Me=new WeakMap,je=new WeakMap,function(e){let t;var s;(s=t=e.SiteServerType||(e.SiteServerType={})).GITHUB="github",s.FILESYSTEM="filesystem",s.DEDICATED="dedicated",e.SiteServerTypeSuggestedGameServer=r.R.deepFreeze({[t.GITHUB]:void 0,[t.FILESYSTEM]:{value:"ws://localhost",description:"dev shortcut :)"},[t.DEDICATED]:{value:(()=>{const e=new URL(window.location.origin);return e.protocol="ws",e.toString()})(),description:"this page's server"}})}(He||(He={})),Object.freeze(He),Object.freeze(He.prototype),["Object","String","Number","RegExp","Date","Array","Map","Set","WeakMap","WeakSet","URL","HTMLElement","HTMLDivElement","HTMLSpanElement","HTMLPreElement","HTMLButtonElement","HTMLInputElement","HTMLSelectElement","HTMLOptionElement","HTMLScriptElement","HTMLStyleElement","HTMLLinkElement","HTMLAnchorElement","HTMLDocument","HTMLIFrameElement","HTMLCanvasElement"].forEach((e=>{Object.defineProperty(globalThis,e,{enumerable:!0,writable:!1,configurable:!1}),Object.freeze(globalThis[e]),Object.freeze(globalThis[e].prototype)}));const Be=new He,We=void 0;function Fe(){return Be.currentScreen}function Je(){return Be.game}console.info("%c🩺 welcome! 🐍","font:700 2.3em /1.5 monospace; margin:0.4em; border:0.3em solid black;padding:0.4em; color:white; background-color:#3f5e77; border-radius:0.7em; ")},649:(e,t,s)=>{var a={"./murky-dive.css":115,"./smooth-stone.css":622};function r(e){return i(e).then(s)}function i(e){return s.e(122).then((()=>{if(!s.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}))}r.keys=()=>Object.keys(a),r.resolve=i,r.id=649,e.exports=r}},0,[[811,280]]]);
//# sourceMappingURL=index.js.map